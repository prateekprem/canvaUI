const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jszip.min-BQw53GkO.js","./index-sOZnMSSk.js","./index-DnHYnMJl.css"])))=>i.map(i=>d[i]);
import{j as t,r as p,_ as ot,a as Ya}from"./index-sOZnMSSk.js";const Dt=[{key:"fontFamily",label:"Font",type:"select",default:"system-ui",options:[{value:"system-ui",label:"System UI"},{value:"Inter",label:"Inter"},{value:"Roboto",label:"Roboto"},{value:"Open Sans",label:"Open Sans"},{value:"Lato",label:"Lato"},{value:"Georgia",label:"Georgia"},{value:"serif",label:"Serif"},{value:"monospace",label:"Monospace"}]},{key:"fontSize",label:"Font size (px)",type:"number",default:16,min:8,max:72},{key:"fontWeight",label:"Font weight",type:"select",default:"normal",options:[{value:"normal",label:"Normal"},{value:"500",label:"Medium"},{value:"600",label:"Semibold"},{value:"bold",label:"Bold"}]},{key:"textColor",label:"Text color",type:"color",default:"#000000"},{key:"backgroundColor",label:"Background color",type:"colorTransparent",default:"transparent"},{key:"foregroundColor",label:"Foreground color",type:"color",default:""},{key:"borderColor",label:"Border color",type:"color",default:""},{key:"cornerRadius",label:"Corner radius (px)",type:"number",default:0,min:0},{key:"opacity",label:"Alpha / opacity",type:"range",default:1,min:0,max:100,toValue:e=>e/100,fromValue:e=>Math.round((e??1)*100)},{key:"blur",label:"Blur (px)",type:"number",default:0,min:0}],Ee=["fontFamily","fontSize","fontWeight","textColor"],ke=["backgroundColor","foregroundColor","borderColor","cornerRadius","opacity","blur"],et=["backgroundColor","borderColor","cornerRadius","opacity","blur"],wt={Text:[...Ee,...et],Button:[...Ee,...ke],List:[...Ee,...ke],ListItemContent:[...Ee,...et],Image:[...ke],View:[...ke],VStack:[...ke],HStack:[...ke],ZStack:[...ke],TextField:[...Ee,...et],Toggle:[...Ee,...ke],Slider:[...ke],Picker:[...Ee,...ke],ProgressView:[...ke],Divider:["backgroundColor","borderColor","opacity"],Spacer:[],Link:[...Ee,...ke],SecureField:[...Ee,...et]};function Ka(e){const a=wt[e];return!a||!a.length?[]:a.map(n=>Dt.find(r=>r.key===n)).filter(Boolean)}function Ft(){return Dt.reduce((e,a)=>(e[a.key]=a.default,e),{})}function kt(e){return wt[e]!=null?wt[e]:[]}const tt={fontFamily:"system-ui",fontSize:16,fontWeight:"normal",textColor:"#000000",backgroundColor:"transparent",foregroundColor:"",borderColor:"",cornerRadius:0,opacity:1,blur:0,paddingHorizontal:0,paddingVertical:0,paddingTop:0,paddingBottom:0,marginHorizontal:0,marginVertical:0,marginTop:0,marginBottom:0,marginLeft:0,marginRight:0,insetFromParentTop:0,insetFromParentLeft:0,insetFromParentBottom:0,insetFromParentRight:0},Qa="#3b82f6";function O(e,a,n){if(!e)return;const r=n||e.type,i=e[a];return a==="textColor"?i??(e.color!=null?e.color:tt.textColor):a==="backgroundColor"&&r==="Button"?i!=null&&i!==""&&String(i).trim().toLowerCase()!=="transparent"?i:Qa:a==="backgroundColor"?i??tt.backgroundColor:tt[a]!==void 0?i??tt[a]:a==="alignment"?r==="Text"?i??"start":i??"center":a==="spacing"?i??12:a==="contentMode"?i??"contain":a==="paddingTop"||a==="paddingBottom"?i??(e.paddingVertical!=null?e.paddingVertical:0):a==="marginTop"||a==="marginBottom"?i??(e.marginVertical!=null?e.marginVertical:0):a==="marginLeft"||a==="marginRight"?i??(e.marginHorizontal!=null?e.marginHorizontal:0):a==="insetFromParentTop"||a==="insetFromParentLeft"||a==="insetFromParentBottom"||a==="insetFromParentRight"?i??0:a==="placeholder"?i??"":a==="isOn"?i===!0:a==="label"?i??"":a==="value"?i??50:a==="min"?i??0:a==="max"?i??100:a==="selection"?i??"":a==="progress"?i??.5:a==="indeterminate"?i===!0:a==="axis"?i??"horizontal":a==="url"?i??"":i}const je="BottomSheet",ct="openBottomSheet",Xa=[{value:"small",label:"Small (peek)"},{value:"medium",label:"Half"},{value:"large",label:"Full"}];function qa(){return["sheetDetent","sheetDismissible","sheetShowHandle","sheetBackdropOpacity","sheetDataMapping","actionId","actionEvent"]}const en="Bottom sheet",tn="Modal sheet from bottom; has its own data mapping and can be opened by controls (e.g. Button with action Open bottom sheet).";function an(e,a){return{id:e,type:je,children:[],sheetDetent:"medium",sheetDismissible:!0,sheetShowHandle:!0,sheetBackdropOpacity:.5,sheetDataMapping:null,...a}}function Bt(){return{[je]:{children:[],sheetDetent:"medium",sheetDismissible:!0,sheetShowHandle:!0,sheetBackdropOpacity:.5,sheetDataMapping:null}}}function nn(e){if(e==null||typeof e!="object")return null;try{return JSON.parse(JSON.stringify(e))}catch{return null}}function ln(e){if(!e||typeof e!="object")return null;const a=e.id!=null?String(e.id):"",n=e.name!=null?String(e.name):"",r={id:a,name:n};if(Object.prototype.hasOwnProperty.call(e,"value")&&e.value!==void 0){const i=e.value;if(i===null||typeof i=="string"||typeof i=="number"||typeof i=="boolean")r.value=i;else if(typeof i=="object")try{r.value=JSON.parse(JSON.stringify(i))}catch{r.value=null}else r.value=String(i)}return e.boundNodeId!=null&&e.boundNodeId!==""&&(r.boundNodeId=String(e.boundNodeId)),e.boundProperty!=null&&e.boundProperty!==""&&(r.boundProperty=String(e.boundProperty)),r}function rn(e){if(!e||typeof e!="object")return null;const a=Array.isArray(e.dataModel)?e.dataModel.map(ln).filter(Boolean):[],n=Array.isArray(e.mockApiBindings)?e.mockApiBindings.map(r=>({apiPath:r&&r.apiPath!=null?String(r.apiPath):"",dataModelId:r&&r.dataModelId!=null?String(r.dataModelId):""})):[];return{apiUrl:e.apiUrl!=null&&e.apiUrl!==""?String(e.apiUrl):null,apiMethod:["GET","POST","PUT","PATCH","DELETE"].includes(e.apiMethod)?e.apiMethod:"GET",dataModel:a,mockApiJson:nn(e.mockApiJson),mockApiBindings:n,loadMorePageParamName:e.loadMorePageParamName!=null&&e.loadMorePageParamName!==""?String(e.loadMorePageParamName):null,loadMorePageParamInQuery:e.loadMorePageParamInQuery===!0,loadMoreHasNextPagePath:e.loadMoreHasNextPagePath!=null&&e.loadMoreHasNextPagePath!==""?String(e.loadMoreHasNextPagePath):null}}function sn(e,a,n){const r=Bt()[je];a.children=(e.children||[]).map(n).filter(Boolean),a.sheetDetent=e.sheetDetent!=null&&["small","medium","large"].includes(e.sheetDetent)?e.sheetDetent:r.sheetDetent,a.sheetDismissible=e.sheetDismissible!==!1,a.sheetShowHandle=e.sheetShowHandle!==!1,a.sheetBackdropOpacity=typeof e.sheetBackdropOpacity=="number"?Math.max(0,Math.min(1,e.sheetBackdropOpacity)):r.sheetBackdropOpacity;const i=e.sheetDataMapping!=null&&typeof e.sheetDataMapping=="object"?e.sheetDataMapping:null;a.sheetDataMapping=rn(i)}function on(e,a){if(e.type!==je)return;const n=Bt()[je];a.sheetDetent=e.sheetDetent!=null&&["small","medium","large"].includes(e.sheetDetent)?e.sheetDetent:n.sheetDetent,a.sheetDismissible=e.sheetDismissible!==!1,a.sheetShowHandle=e.sheetShowHandle!==!1,a.sheetBackdropOpacity=typeof e.sheetBackdropOpacity=="number"?Math.max(0,Math.min(1,e.sheetBackdropOpacity)):n.sheetBackdropOpacity,a.sheetDataMapping=e.sheetDataMapping!=null&&typeof e.sheetDataMapping=="object"?e.sheetDataMapping:null}function $e(e,a){return e==null&&a==null?!0:e==null||a==null?!1:String(e)===String(a)}function na(e,a){if(!e)return{tree:null,node:null};const n=(e.children||[]).findIndex(r=>$e(r.id,a));if(n>=0){const r=e.children[n],i=[...e.children.slice(0,n),...e.children.slice(n+1)];return{tree:{...e,children:i},node:r}}if(e.children){let r=null;const i=e.children.map(c=>{const{tree:o,node:s}=na(c,a);return s&&(r=s),o});if(r)return{tree:{...e,children:i},node:r}}return{tree:e,node:null}}function la(e,a,n,r){if($e(e.id,a)){const i=[...e.children||[]];return i.splice(Math.min(r,i.length),0,n),{...e,children:i}}return e.children?{...e,children:e.children.map(i=>la(i,a,n,r))}:e}function ra(e,a){return e?$e(e.id,a)?!0:(e.children||[]).some(n=>ra(n,a)):!1}function ze(e,a){if(!e)return null;const n=e.id!=null?String(e.id):null;if($e(n,a))return e;const r=e.children||[];for(let i=0;i<r.length;i++){const c=ze(r[i],a);if(c)return c}return null}function Ye(e,a){if(!e||!a)return null;const n=e.children||[];for(let r=0;r<n.length;r++){if($e(n[r].id,a))return e;const i=Ye(n[r],a);if(i)return i}return null}function Ot(e,a,n=[]){if(!e)return[];const r=e.type||"View",i=[...n,r];if($e(e.id,a))return i;const c=e.children||[];for(let o=0;o<c.length;o++){const s=Ot(c[o],a,i);if(s.length>0)return s}return[]}function Se(){if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();const e=new Uint8Array(16);if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function")crypto.getRandomValues(e);else for(let n=0;n<16;n++)e[n]=Math.floor(Math.random()*256);e[6]=e[6]&15|64,e[8]=e[8]&63|128;const a=[...e].map(n=>n.toString(16).padStart(2,"0")).join("");return`${a.slice(0,8)}-${a.slice(8,12)}-${a.slice(12,16)}-${a.slice(16,20)}-${a.slice(20)}`}function sa(e,a=[]){return e&&(e.type===je&&a.push(e),(e.children||[]).forEach(n=>sa(n,a))),a}function Wt({title:e,children:a}){return t.jsxs("div",{className:"mb-3",children:[e&&t.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-2",children:e}),a]})}function cn(){return{apiUrl:"",apiMethod:"GET",dataModel:[],mockApiJson:null,mockApiBindings:[],loadMorePageParamName:"",loadMorePageParamInQuery:!1,loadMoreHasNextPagePath:""}}function re(e){const a=e?.sheetDataMapping;return a!=null&&typeof a=="object"?{apiUrl:a.apiUrl!=null?String(a.apiUrl):"",apiMethod:["GET","POST","PUT","PATCH","DELETE"].includes(a.apiMethod)?a.apiMethod:"GET",dataModel:Array.isArray(a.dataModel)?a.dataModel:[],mockApiJson:a.mockApiJson!=null&&typeof a.mockApiJson=="object"?a.mockApiJson:null,mockApiBindings:Array.isArray(a.mockApiBindings)?a.mockApiBindings:[],loadMorePageParamName:a.loadMorePageParamName!=null?String(a.loadMorePageParamName):"",loadMorePageParamInQuery:a.loadMorePageParamInQuery===!0,loadMoreHasNextPagePath:a.loadMoreHasNextPagePath!=null?String(a.loadMoreHasNextPagePath):""}:cn()}function ia(e,a){if(!e||a==null)return null;let n=ze(e,a);if(!n)return null;if(n.type===je)return n;let r=Ye(e,a);for(;r;){if(r.type===je)return r;r=Ye(e,r.id)}return null}function dn({selected:e,update:a}){if(!e||e.type!==je)return null;const n=re(e),r=s=>{const u={...re(e),...s};a("sheetDataMapping",u)},i=()=>{const s=n.dataModel.slice();s.push({id:Se(),name:`field_${s.length+1}`,value:""}),r({dataModel:s})},c=(s,u)=>{const m=n.dataModel.slice();s>=0&&s<m.length&&(m[s]={...m[s],...u},r({dataModel:m}))},o=s=>{const u=n.dataModel.filter((m,l)=>l!==s);r({dataModel:u})};return t.jsxs(t.Fragment,{children:[t.jsxs(Wt,{title:"Bottom sheet",children:[t.jsx("label",{className:"block text-sm mb-1",children:"Detent"}),t.jsx("select",{value:e.sheetDetent??"medium",onChange:s=>a("sheetDetent",s.target.value),className:"w-full p-2 border rounded text-sm mb-2 bg-white",children:Xa.map(s=>t.jsx("option",{value:s.value,children:s.label},s.value))}),t.jsxs("label",{className:"flex items-center gap-2 mb-2",children:[t.jsx("input",{type:"checkbox",checked:e.sheetDismissible!==!1,onChange:s=>a("sheetDismissible",s.target.checked)}),t.jsx("span",{className:"text-sm",children:"Dismissible (drag/tap outside)"})]}),t.jsxs("label",{className:"flex items-center gap-2 mb-2",children:[t.jsx("input",{type:"checkbox",checked:e.sheetShowHandle!==!1,onChange:s=>a("sheetShowHandle",s.target.checked)}),t.jsx("span",{className:"text-sm",children:"Show handle"})]}),t.jsx("label",{className:"block text-sm mb-1",children:"Backdrop opacity (0–1)"}),t.jsx("input",{type:"number",min:0,max:1,step:.1,value:e.sheetBackdropOpacity!=null?e.sheetBackdropOpacity:.5,onChange:s=>a("sheetBackdropOpacity",Math.max(0,Math.min(1,Number(s.target.value)))),className:"w-full p-2 border rounded text-sm mb-2"})]}),t.jsxs(Wt,{title:"Sheet data mapping",children:[t.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"API and data model for this sheet only. Fetched when the sheet opens; screen data is unchanged."}),t.jsx("label",{className:"block text-sm mb-1",children:"API URL"}),t.jsx("input",{type:"text",value:n.apiUrl,onChange:s=>r({apiUrl:s.target.value}),placeholder:"https://api.example.com/sheet-data",className:"w-full p-2 border rounded text-sm mb-2 bg-white"}),t.jsx("label",{className:"block text-sm mb-1",children:"Method"}),t.jsxs("select",{value:n.apiMethod,onChange:s=>r({apiMethod:s.target.value}),className:"w-full p-2 border rounded text-sm mb-3 bg-white",children:[t.jsx("option",{value:"GET",children:"GET"}),t.jsx("option",{value:"POST",children:"POST"}),t.jsx("option",{value:"PUT",children:"PUT"}),t.jsx("option",{value:"PATCH",children:"PATCH"}),t.jsx("option",{value:"DELETE",children:"DELETE"})]}),t.jsx("h5",{className:"text-xs font-semibold text-gray-600 mb-1",children:"Data model (for binding inside sheet)"}),t.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Add fields; bind controls inside the sheet to these (e.g. Text → bound property)."}),n.dataModel.map((s,u)=>t.jsxs("div",{className:"flex gap-1 items-center mb-2 p-2 border border-gray-200 rounded bg-white",children:[t.jsx("input",{type:"text",value:s.name??"",onChange:m=>c(u,{name:m.target.value}),placeholder:"Field name",className:"flex-1 min-w-0 p-1.5 border rounded text-xs"}),t.jsx("input",{type:"text",value:s.value??"",onChange:m=>c(u,{value:m.target.value}),placeholder:"Default value",className:"w-20 p-1.5 border rounded text-xs"}),t.jsx("button",{type:"button",onClick:()=>o(u),className:"text-red-500 text-xs px-1",title:"Remove",children:"×"})]},s.id??u)),t.jsx("button",{type:"button",onClick:i,className:"text-xs text-blue-600 hover:underline mb-3",children:"+ Add field"}),t.jsx("label",{className:"block text-sm mb-1",children:"Load more: page param name (optional)"}),t.jsx("input",{type:"text",value:n.loadMorePageParamName,onChange:s=>r({loadMorePageParamName:s.target.value}),placeholder:"e.g. page",className:"w-full p-2 border rounded text-sm mb-2 bg-white"}),t.jsx("label",{className:"block text-sm mb-1",children:"Load more: has next path (optional)"}),t.jsx("input",{type:"text",value:n.loadMoreHasNextPagePath,onChange:s=>r({loadMoreHasNextPagePath:s.target.value}),placeholder:"e.g. data.hasNextPage",className:"w-full p-2 border rounded text-sm mb-2 bg-white"})]})]})}function un({tree:e,selected:a,update:n}){const r=sa(e||{});return(a?.actionEvent??"")===ct?t.jsxs("div",{className:"mb-2",children:[t.jsx("label",{className:"block text-sm mb-1",children:"Open bottom sheet"}),t.jsxs("select",{value:a?.actionId??"",onChange:c=>n("actionId",c.target.value),className:"w-full p-2 border rounded text-sm bg-white",title:"Select which bottom sheet to open",children:[t.jsx("option",{value:"",children:"— Select sheet —"}),r.map(c=>t.jsx("option",{value:c.id??"",children:c.id||"Bottom sheet"},c.id))]})]}):null}function mn({tree:e,selected:a,update:n}){const r=(a?.actionEvent??"")===ct,i=()=>{n(r?{actionEvent:""}:{actionEvent:ct,actionId:""})};return t.jsxs("div",{className:"mb-3 relative z-10",children:[t.jsxs("button",{type:"button",onClick:i,onMouseDown:c=>c.stopPropagation(),onPointerDown:c=>c.stopPropagation(),className:"flex items-center gap-2 mb-2 w-full text-left p-2.5 rounded border border-gray-300 bg-white hover:bg-gray-50 shadow-sm cursor-pointer select-none min-h-[36px] relative z-10","aria-pressed":r,children:[t.jsx("span",{className:"shrink-0 w-4 h-4 rounded border-2 flex items-center justify-center bg-white border-gray-400","aria-hidden":!0,children:r?t.jsx("span",{className:"text-blue-600 font-bold leading-none",style:{fontSize:"12px"},children:"✓"}):null}),t.jsx("span",{className:"text-sm font-medium",children:"Open bottom sheet on tap"})]}),r&&t.jsx(un,{tree:e,selected:a,update:n})]})}const Ue="application/x-ui-builder-node-id",pn=4;function Ze({parentId:e,index:a,onMove:n,layout:r="col",spacing:i,fill:c=!1,siblingCount:o=0}){const[s,u]=p.useState(!1),m=D=>{D.preventDefault(),D.stopPropagation(),D.dataTransfer.dropEffect="move",u(!0)},l=D=>{D.preventDefault(),D.stopPropagation(),u(!1)},h=D=>{D.preventDefault(),D.stopPropagation(),u(!1);const I=D.dataTransfer.getData(Ue);I&&n(I,e,a)},N=o>=0&&(a===0||a===o),v=i!=null?Math.max(Number(i)||0,pn):20,P=c||N?0:v,M=r==="row",J=6,V=c?{position:"absolute",inset:0}:N?M?{width:0,minWidth:0,paddingLeft:J,paddingRight:J,marginLeft:-J,marginRight:-J,overflow:"visible"}:{height:0,minHeight:0,paddingTop:J,paddingBottom:J,marginTop:-J,marginBottom:-J,overflow:"visible"}:M?{minWidth:P,width:P}:{minHeight:P,height:P};return t.jsx("div",{onDragOver:m,onDragLeave:l,onDrop:h,title:"Drop here to change position",className:`transition-colors flex items-center justify-center ${c?"pointer-events-auto":"flex-shrink-0"} ${s?"bg-blue-100 ring-1 ring-blue-400 rounded":""}`,style:V,"data-drop-zone":!0})}const pt=40,ht=24;function hn(e){return e?e.layoutMode==="autoResize"||e.layoutMode==="autoLayout"||e.layoutMode==="freeForm"?e.layoutMode:e.autoResize===!0?"autoResize":"autoLayout":"autoLayout"}function gn({node:e,onUpdate:a,onSelect:n,children:r,parentLayout:i,isPreview:c=!1,isSelected:o=!1}){const s=p.useRef(null),[u,m]=p.useState(!1),l=p.useRef({x:0,y:0,width:0,height:0}),h=hn(e),N=h==="autoResize",v=h==="freeForm",P=N?"100%":e.width!=null?typeof e.width=="number"?`${e.width}px`:e.width:v?"100%":void 0,M=N?"100%":e.height!=null?typeof e.height=="number"?`${e.height}px`:e.height:v?"100%":void 0,J=p.useCallback(Z=>{Z.preventDefault(),Z.stopPropagation();const se=s.current!=null?s.current.getBoundingClientRect():null;if(!se)return;const b=e.width??se.width,B=e.height??se.height;l.current={x:Z.clientX,y:Z.clientY,width:typeof b=="number"?b:se.width,height:typeof B=="number"?B:se.height},m(!0)},[e.width,e.height]),V=p.useCallback(Z=>{if(!u)return;const se=Z.clientX-l.current.x,b=Z.clientY-l.current.y,B=Math.max(pt,Math.round(l.current.width+se)),$=Math.max(ht,Math.round(l.current.height+b));a({...e,width:B,height:$,autoResize:!1,layoutMode:"autoLayout"})},[u,e,a]),D=p.useCallback(()=>{m(!1)},[]);p.useEffect(()=>{if(u)return window.addEventListener("mousemove",V),window.addEventListener("mouseup",D),()=>{window.removeEventListener("mousemove",V),window.removeEventListener("mouseup",D)}},[u,V,D]),p.useEffect(()=>{if(c||!N||!a||!s.current)return;const Z=s.current,se=new ResizeObserver(()=>{const b=Z.getBoundingClientRect(),B=Math.round(b.width),$=Math.round(b.height);B>=pt&&$>=ht&&(e.width!==B||e.height!==$)&&a({...e,width:B,height:$})});return se.observe(Z),()=>se.disconnect()},[h,N,c,e,a]);const I=p.useCallback(Z=>{Z.dataTransfer.setData(Ue,e.id),Z.dataTransfer.effectAllowed="move"},[e.id]),y=e.paddingHorizontal??0,C=e.paddingVertical??0,te=e.paddingTop??C,W=e.paddingBottom??C,L=e.marginHorizontal??0,X=e.marginVertical??0,Y=e.marginTop??X,xe=e.marginBottom??X,fe=e.marginLeft??L,de=e.marginRight??L,ae=e.insetFromParentTop??0,oe=e.insetFromParentBottom??0,R=e.insetFromParentLeft??0,f=e.insetFromParentRight??0,F=kt(e.type)??[],_=e.backgroundColor,le=_!=null&&_!==""&&String(_).trim().toLowerCase()!=="transparent",pe=le?String(_):"transparent",x=F.includes("backgroundColor")||le,k=F.includes("cornerRadius")?typeof e.cornerRadius=="number"?e.cornerRadius:e.cornerRadius!=null?Number(e.cornerRadius):0:null,H={...x&&{backgroundColor:pe},...k!=null&&{borderRadius:k}},U={paddingLeft:y,paddingRight:y,paddingTop:te,paddingBottom:W,...x&&{backgroundColor:pe},...k!=null&&{borderRadius:k},...F.includes("opacity")&&{opacity:e.opacity??1},...F.includes("blur")&&e.blur>0&&{filter:`blur(${e.blur}px)`},...F.includes("borderColor")&&e.borderColor&&{border:`1px solid ${e.borderColor}`}},ue=e.width!=null&&!N&&!v,ce=e.height!=null&&!N&&!v,he=e.type==="Spacer",q=he?"flex-1 min-w-0 min-h-0 self-stretch":v?"w-full h-full":N?"flex-1 min-w-0 min-h-0 self-stretch w-full h-full":i==="col"?ce?"flex-none w-full":"flex-1 min-w-0 min-h-0 w-full":i==="row"?ue?"flex-none":"flex-none min-w-0":"inline-block align-top",me=!c&&n?Z=>{Z.stopPropagation(),n(e)}:void 0,ee=!v&&(q.includes("flex-1")||q.includes("self-stretch")),we=ee||ce&&!v;return t.jsxs("div",{ref:s,"data-node-id":e.id??void 0,className:`relative overflow-hidden ${q} ${ee||ce&&!v?"flex flex-col min-h-0":""}`,onClick:me,style:{...P!=null&&{width:P},...M!=null&&{height:M},minWidth:N||v||he?0:pt,minHeight:N||v||he?0:ht,marginTop:v?0:Y+ae,marginBottom:v?0:xe+oe,marginLeft:v?0:fe+R,marginRight:v?0:de+f,pointerEvents:"auto",...H},children:[!c&&!u&&t.jsx("div",{className:`absolute inset-0 pointer-events-none border-2 border-solid z-[2] ${o?"border-blue-500":"border-slate-300"}`,style:k!=null?{borderRadius:k}:{borderRadius:4},"aria-hidden":!0}),t.jsx("div",{className:`box-border relative z-[1] min-h-[24px] overflow-auto ${we?"flex-1 min-h-0 w-full":"w-full h-full"} ${c?"":"cursor-grab active:cursor-grabbing"}`,draggable:!c,onDragStart:c?void 0:I,style:U,children:r}),!c&&!N&&!v&&!he&&t.jsx("div",{role:"button",tabIndex:0,"aria-label":"Resize",onMouseDown:J,onClick:Z=>Z.stopPropagation(),className:"absolute bottom-0 right-0 w-5 h-5 cursor-se-resize border-2 border-slate-400 hover:border-blue-500 bg-slate-200 hover:bg-blue-100 rounded-bl rounded-tr z-[100]",style:{touchAction:"none"}})]})}const xn={Text:"text",Button:"title",Image:"src",TextField:"text",Toggle:"label",Slider:"value",Picker:"selection",ProgressView:"progress",Link:"label",SecureField:"text",List:"items"};function bn(e,a){if(!e)return;const n=e[a];return a==="options"&&Array.isArray(n)||a==="items"&&Array.isArray(n)?n:a==="isOn"?n===!0:n??""}function oa(e,a){if(e==null||a==null||a==="")return;const n=a.replace(/\[(\d+)\]/g,".$1").split(".").filter(Boolean);let r=e;for(const i of n){if(r==null)return;const c=/^\d+$/.test(i)?parseInt(i,10):i;r=r[c]}return r}function fn(e,a){if(!a||a.type!=="List")return null;const n=(e||[]).find(i=>i&&i.boundNodeId!=null&&String(i.boundNodeId)===String(a.id)&&i.boundProperty==="items"),r=n&&n.value;return Array.isArray(r)?r:Array.isArray(a.items)?a.items:[]}function Ge(e,a){if(e==null)return"";if(a!=null&&a!==""&&typeof e=="object"&&!Array.isArray(e)){const n=a.includes(".")?oa(e,a):e[a];return n!=null?String(n):""}return typeof e=="object"&&e!==null?e.text!=null?e.text:e.title!=null?e.title:e.label!=null?e.label:JSON.stringify(e):String(e)}function gt(e){return e?e.layoutMode==="freeForm":!1}function yn(e){return e?e.type==="View"&&e.id!=="root"||e.type==="VStack"||e.type==="HStack"||e.type==="ZStack":!1}function Ve(e,a,n){return e&&a.localizationEnabled&&a.localizationDefaultValue!=null&&String(a.localizationDefaultValue).trim()!==""?a.localizationDefaultValue:n??""}function Nn(e){return e==="View"||e==="VStack"||e==="HStack"||e==="ZStack"||e==="List"||e==="ListItemContent"||e===je}function Ce({node:e,onSelect:a,onUpdate:n,onMove:r,parentLayout:i,isDragging:c=!1,isPreview:o=!1,listItemContext:s,highlightNodeId:u,selectedNodeId:m,dataModel:l,onPreviewAction:h,onPreviewOpenBottomSheet:N,previewListLoadMoreCounts:v,onPreviewLoadMore:P}){if(!e)return null;const M=x=>{o||(x.stopPropagation(),a(e))},J=e.actionEvent===ct&&e.actionId,V=x=>{o&&(x.stopPropagation(),J&&N?N(e.actionId):h&&h(e))},D=e.children||[],I=e.type==="HStack"?"row":"col",y=kt(e.type)!=null?kt(e.type):[],C={};y.includes("fontFamily")&&(C.fontFamily=e.fontFamily!=null?e.fontFamily:"system-ui"),y.includes("fontSize")&&(C.fontSize=e.fontSize!=null?e.fontSize:16),y.includes("fontWeight")&&(C.fontWeight=e.fontWeight!=null?e.fontWeight:"normal"),y.includes("textColor")&&(C.color=e.textColor!=null?e.textColor:e.color!=null?e.color:"#000000");const te=e.type==="VStack"||e.type==="HStack";e.type;const W=te?e.spacing:void 0,L=e.paddingVertical!=null?e.paddingVertical:0,X=e.paddingHorizontal!=null?e.paddingHorizontal:0,Y={paddingTop:e.paddingTop!=null?e.paddingTop:L,paddingBottom:e.paddingBottom!=null?e.paddingBottom:L,paddingLeft:X,paddingRight:X},xe=D.filter(gt),fe=()=>xe.length===0?null:t.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-visible",style:{zIndex:100,paddingTop:Y.paddingTop,paddingBottom:Y.paddingBottom,paddingLeft:Y.paddingLeft,paddingRight:Y.paddingRight},children:xe.map(x=>t.jsx("div",{className:"pointer-events-auto",style:{position:"absolute",left:x.x!=null?x.x:0,top:x.y!=null?x.y:0,width:typeof x.width=="number"||x.width!=null?x.width:100,height:typeof x.height=="number"||x.height!=null?x.height:100,minWidth:40,minHeight:24},children:t.jsx(Ce,{node:x,dataModel:l,onSelect:a,onUpdate:n,onMove:r,parentLayout:I,isDragging:c,isPreview:o,listItemContext:s,highlightNodeId:u,selectedNodeId:m,onPreviewAction:h,onPreviewOpenBottomSheet:N,previewListLoadMoreCounts:v,onPreviewLoadMore:P})},x.id))}),de=()=>t.jsxs(t.Fragment,{children:[D.map((x,k)=>t.jsxs(p.Fragment,{children:[!o&&t.jsx(Ze,{parentId:e.id,index:k,onMove:r,layout:I,spacing:W,siblingCount:D.length},`drop-${e.id}-${k}`),gt(x)?yn(e)?null:t.jsx("div",{style:{width:0,minWidth:0,height:0,minHeight:0,overflow:"visible"},"aria-hidden":!0},x.id):e.type==="HStack"&&x.fillRemainingWidth?t.jsx("div",{style:{flex:1,minWidth:0},className:"min-h-0 flex items-stretch",children:t.jsx(Ce,{node:x,dataModel:l,onSelect:a,onUpdate:n,onMove:r,parentLayout:I,isDragging:c,isPreview:o,listItemContext:s,highlightNodeId:u,selectedNodeId:m,onPreviewAction:h,onPreviewOpenBottomSheet:N,previewListLoadMoreCounts:v,onPreviewLoadMore:P})}):t.jsx(Ce,{node:x,dataModel:l,onSelect:a,onUpdate:n,onMove:r,parentLayout:I,isDragging:c,isPreview:o,listItemContext:s,highlightNodeId:u,selectedNodeId:m,onPreviewAction:h,onPreviewOpenBottomSheet:N,previewListLoadMoreCounts:v,onPreviewLoadMore:P})]},x.id)),!o&&t.jsx(Ze,{parentId:e.id,index:D.length,onMove:r,layout:I,spacing:W,siblingCount:D.length},`drop-${e.id}-${D.length}`)]}),ae=x=>{x.preventDefault(),x.stopPropagation();const k=x.dataTransfer.getData(Ue);!k||k===e.id||r(k,e.id,D.length)},oe=!o&&c&&Nn(e.type)&&e.id!=="root"&&r?t.jsx("div",{className:"absolute inset-0 z-[50] flex items-center justify-center bg-blue-50/70 rounded border-2 border-dashed border-blue-400 pointer-events-auto",onDragOver:x=>{x.preventDefault(),x.stopPropagation(),x.dataTransfer.dropEffect="move"},onDrop:ae,title:"Drop to add as child",children:t.jsx("span",{className:"text-blue-600 text-sm font-medium",children:"Drop to add as child"})}):null,R=()=>t.jsxs("div",{className:"h-full min-h-[2rem] flex flex-col items-stretch relative",style:Y,onClick:M,children:[oe,t.jsx("div",{className:"h-full min-h-0 flex flex-col items-stretch flex-1",children:de()}),fe()]});let f;switch(e.type){case"Text":{const x=e.alignment==="end"?"right":e.alignment==="center"?"center":"left",k=typeof e.numberOfLines=="number"&&e.numberOfLines>0?e.numberOfLines:void 0,H=k!=null?{display:"-webkit-box",WebkitLineClamp:k,WebkitBoxOrient:"vertical",overflow:"hidden"}:{},U=k==null?{display:"flex",alignItems:"center",justifyContent:x==="center"?"center":x==="right"?"flex-end":"flex-start"}:{};f=t.jsx("p",{onClick:M,style:{...C,textAlign:x,...H,...U},className:"h-full min-h-[1.5rem]",children:s!=null&&e.boundListItemProperty?Ge(s.listItem,e.boundListItemProperty):Ve(o,e,e.text)});break}case"Button":{const x=e.backgroundColor,k=y.includes("backgroundColor")&&x!=null&&x!==""&&String(x).trim().toLowerCase()!=="transparent"?x:"#3b82f6";f=t.jsx("button",{type:"button",onClick:H=>{o?V(H):M(H)},style:{...C,backgroundColor:k,color:(e.textColor!=null?e.textColor:e.color)||"#ffffff",borderColor:y.includes("borderColor")&&e.borderColor||"transparent",borderRadius:y.includes("cornerRadius")?e.cornerRadius!=null?e.cornerRadius:0:void 0},className:"w-full h-full min-h-[2.5rem] rounded border",children:s!=null&&e.boundListItemProperty?Ge(s.listItem,e.boundListItemProperty):Ve(o,e,e.title)});break}case"Image":{const x=e.useAsset===!0,k=x&&(e.assetImageName||e.assetBundleName)?[e.assetBundleName||"Main",e.assetImageName].filter(Boolean).join(" / "):null,H=s!=null&&e.boundListItemProperty?Ge(s.listItem,e.boundListItemProperty):e.src!=null?e.src:"";f=t.jsx("div",{onClick:M,className:"h-full min-h-[2rem] w-full flex items-center justify-center overflow-hidden",style:y.includes("cornerRadius")?{borderRadius:e.cornerRadius!=null?e.cornerRadius:0}:void 0,children:x?t.jsx("span",{style:C,className:"text-slate-500 text-center text-xs",children:k?`Asset: ${k}`:"Asset (set name)"}):H?t.jsx("img",{src:H,alt:e.alt!=null?e.alt:"Image",draggable:!1,className:"max-w-full max-h-full w-full h-full",style:{objectFit:e.contentMode!=null?e.contentMode:"contain"}}):t.jsx("span",{style:C,className:"text-slate-400",children:"No image URL"})});break}case"View":f=R();break;case"BottomSheet":f=jn(e,{dataModel:l,onSelect:a,onUpdate:n,onMove:r,isDragging:c,isPreview:o,listItemContext:s,highlightNodeId:u,selectedNodeId:m,containerDropOverlay:oe,renderChildrenWithDropZones:de});break;case"VStack":case"HStack":{const x=e.alignment!=null&&e.alignment!==""?e.alignment:"center",k=x==="start"?"flex-start":x==="end"?"flex-end":"center",H=e.spacing!=null?e.spacing:12;f=t.jsxs("div",{onClick:M,className:`h-full flex relative flex-nowrap ${e.type==="HStack"?"flex-row":"flex-col"}`,style:{gap:H,alignItems:k,...Y},children:[oe,de(),fe()]},o?void 0:`stack-${e.id}-${x}-${H}`);break}case"ZStack":{const x=e.alignment!=null?e.alignment:"center",U={display:"flex",justifyContent:x==="start"||x==="leading"?"flex-start":x==="end"||x==="trailing"?"flex-end":"center",alignItems:x==="start"?"flex-start":x==="end"?"flex-end":"center"};f=t.jsxs("div",{onClick:M,className:"absolute inset-0 min-h-[4rem]",style:Y,children:[!o&&t.jsx("div",{className:"absolute inset-0",style:{zIndex:c?9999:0,...Y},children:t.jsx("div",{className:"w-full h-full relative",children:t.jsx(Ze,{parentId:e.id,index:D.length,onMove:r,layout:"col",fill:!0})})}),D.map((ue,ce)=>gt(ue)?t.jsx(p.Fragment,{},ue.id):t.jsx("div",{className:"absolute inset-0 flex pointer-events-none",style:{zIndex:o?ce:10+ce,...U,...Y},children:t.jsx("div",{className:"pointer-events-auto flex min-w-[2rem] min-h-[2rem]",style:U,children:t.jsx(Ce,{node:ue,dataModel:l,onSelect:a,onUpdate:n,onMove:r,parentLayout:"col",isDragging:c,isPreview:o,listItemContext:s,highlightNodeId:u,selectedNodeId:m,onPreviewAction:h,onPreviewOpenBottomSheet:N,previewListLoadMoreCounts:v,onPreviewLoadMore:P})})},ue.id)),fe()]});break}case"List":{const x=e.children&&e.children[0],k=fn(l,e),H=o&&e.loadMoreEnabled&&v&&typeof v[e.id]=="number"?v[e.id]:0,U=H>0&&Array.isArray(k)&&k.length>0?k.concat(Array(H).fill(null).flatMap(()=>k)):k,ue=typeof e.listRowSpacing=="number"?Math.max(0,e.listRowSpacing):0,ce=typeof e.listSpacingAboveFirst=="number"?Math.max(0,e.listSpacingAboveFirst):0,he=typeof e.listSpacingBelowLast=="number"?Math.max(0,e.listSpacingBelowLast):0,q=o&&e.loadMoreEnabled===!0&&P;f=t.jsx(t.Fragment,{children:t.jsxs("ul",{onClick:M,className:"h-full border overflow-auto list-none pl-0 ml-0",style:{...Y,...y.includes("borderColor")&&e.borderColor?{borderColor:e.borderColor}:{}},children:[x?U.map((me,ee)=>{const we=ee===0,Z=ee===U.length-1&&!q,se={...we?{marginTop:ce}:{},...ee<U.length-1?{marginBottom:ue}:{},...Z?{marginBottom:he}:{}};return t.jsx("li",{className:"border-b border-gray-200 last:border-b-0",style:se,children:t.jsx(Ce,{node:x,dataModel:l,onSelect:a,onUpdate:n,onMove:r,parentLayout:"col",isDragging:c,isPreview:o,listItemContext:{listItem:me,listIndex:ee},highlightNodeId:u,selectedNodeId:m,onPreviewAction:h,onPreviewOpenBottomSheet:N,previewListLoadMoreCounts:v,onPreviewLoadMore:P})},ee)}):U.map((me,ee)=>{const we=ee===0,Z=ee===U.length-1&&!q,se={...C,...we?{marginTop:ce}:{},...ee<U.length-1?{marginBottom:ue}:{},...Z?{marginBottom:he}:{}};return t.jsx("li",{className:"border-b",style:se,children:Ge(me,null)},ee)}),q&&t.jsx("li",{className:"border-t border-gray-200 shrink-0",children:t.jsx("button",{type:"button",className:"w-full py-3 text-sm font-medium text-blue-600 hover:bg-blue-50 active:bg-blue-100",onClick:me=>{me.stopPropagation(),P(e.id)},children:e.loadMoreFooterLabel??"Load more"})})]})});break}case"ListItemContent":{const x=e.children||[];if(x.length>0)f=t.jsxs("div",{onClick:o?V:M,className:"relative flex flex-row flex-wrap items-center gap-2 min-h-[2rem] w-full cursor-pointer",style:Y,children:[oe,x.map((k,H)=>t.jsxs(p.Fragment,{children:[!o&&t.jsx(Ze,{parentId:e.id,index:H,onMove:r,layout:"row",spacing:8,siblingCount:x.length}),t.jsx(Ce,{node:k,dataModel:l,onSelect:a,onUpdate:n,onMove:r,parentLayout:"row",isDragging:c,isPreview:o,listItemContext:s,highlightNodeId:u,selectedNodeId:m,onPreviewAction:h,onPreviewOpenBottomSheet:N,previewListLoadMoreCounts:v,onPreviewLoadMore:P})]},k.id)),!o&&t.jsx(Ze,{parentId:e.id,index:x.length,onMove:r,layout:"row",spacing:8,siblingCount:x.length})]});else{const k=s!=null&&s.listItem!==void 0&&s.listItem!==null?typeof s.listItem=="object"?s.listItem.text!=null?s.listItem.text:s.listItem.title!=null?s.listItem.title:s.listItem.label!=null?s.listItem.label:JSON.stringify(s.listItem):String(s.listItem):"(no list context)";f=t.jsx("p",{onClick:o?V:M,style:C,className:"h-full min-h-[1.5rem] cursor-pointer",children:k})}break}case"ListItemText":{const x=s?.listItem,k=x!=null?Ge(x,e.itemProperty||null):"(list item)";f=t.jsx("span",{onClick:M,style:C,className:"min-h-[1.5rem] inline-block",children:k});break}case"TextField":f=t.jsx("input",{type:"text",onClick:M,value:e.text!=null?e.text:"",readOnly:o&&!n,onChange:n?x=>n({...e,text:x.target.value}):void 0,placeholder:Ve(o,e,e.placeholder!=null?e.placeholder:"Enter text"),className:"w-full min-h-[2rem] border border-gray-300 rounded bg-white",style:C});break;case"Toggle":f=t.jsxs("label",{onClick:M,className:"flex items-center gap-2 cursor-pointer min-h-[2rem] w-full",children:[t.jsx("input",{type:"checkbox",checked:e.isOn===!0,readOnly:o&&!n,onChange:n?x=>n({...e,isOn:x.target.checked}):void 0,className:"w-10 h-6 rounded-full border-2 border-gray-300 appearance-none bg-gray-200 checked:bg-blue-500 checked:border-blue-500 transition-colors",style:{boxSizing:"border-box"}}),t.jsx("span",{style:C,className:"text-sm",children:Ve(o,e,e.label!=null?e.label:"Toggle")||" "})]});break;case"Slider":f=t.jsxs("div",{onClick:M,className:"flex items-center gap-2 w-full min-h-[2rem]",children:[t.jsx("input",{type:"range",min:e.min!=null?e.min:0,max:e.max!=null?e.max:100,value:e.value!=null?e.value:50,readOnly:o&&!n,onChange:n?x=>n({...e,value:Number(x.target.value)}):void 0,className:"flex-1 h-2 rounded-full appearance-none bg-gray-200 accent-blue-500"}),t.jsx("span",{style:C,className:"text-sm w-10 shrink-0",children:e.value!=null?e.value:50})]});break;case"Picker":f=t.jsx("select",{onClick:M,value:e.selection!=null?e.selection:"",readOnly:o&&!n,disabled:o&&!n,onChange:n?x=>n({...e,selection:x.target.value}):void 0,className:"w-full min-h-[2.5rem] border border-gray-300 rounded bg-white",style:C,children:(Array.isArray(e.options)?e.options:["Option 1","Option 2","Option 3"]).map((x,k)=>t.jsx("option",{value:x,children:x},k))});break;case"ProgressView":f=t.jsx("div",{onClick:M,className:"w-full min-h-[2rem] flex items-center",children:e.indeterminate===!0?t.jsx("div",{className:"w-full h-2 rounded-full bg-gray-200 overflow-hidden",children:t.jsx("div",{className:"h-full w-1/3 rounded-full bg-blue-500",title:"Indeterminate progress"})}):t.jsx("div",{className:"w-full h-2 rounded-full bg-gray-200 overflow-hidden",children:t.jsx("div",{className:"h-full rounded-full bg-blue-500 transition-all",style:{width:`${Math.max(0,Math.min(100,(e.progress!=null?e.progress:.5)*100))}%`}})})});break;case"Divider":f=t.jsx("div",{onClick:M,className:`flex-shrink-0 ${(e.axis!=null?e.axis:"horizontal")==="vertical"?"w-px self-stretch min-h-[24px]":"h-px w-full min-w-[24px]"}`,style:{backgroundColor:y.includes("backgroundColor")&&e.backgroundColor?e.backgroundColor:"#d1d5db",opacity:y.includes("opacity")&&e.opacity!=null?e.opacity:1}});break;case"Spacer":f=t.jsx("div",{onClick:M,className:"flex-1 min-w-0 min-h-0 self-stretch",title:"Spacer",style:o?{}:{minHeight:24,background:"repeating-linear-gradient(-45deg, transparent, transparent 6px, rgba(148,163,184,0.15) 6px, rgba(148,163,184,0.15) 8px)"}});break;case"Link":f=t.jsx("a",{href:e.url!=null?e.url:"#",onClick:x=>{o||(x.preventDefault(),a&&a(e))},target:o?"_blank":void 0,rel:o?"noopener noreferrer":void 0,className:"min-h-[1.5rem] inline-flex items-center text-blue-600 underline hover:text-blue-800 cursor-pointer",style:C,children:Ve(o,e,e.label!=null?e.label:"Link")||" "});break;case"SecureField":f=t.jsx("input",{type:"password",onClick:M,value:e.text!=null?e.text:"",readOnly:o&&!n,onChange:n?x=>n({...e,text:x.target.value}):void 0,placeholder:Ve(o,e,e.placeholder!=null?e.placeholder:"Password"),className:"w-full min-h-[2rem] border border-gray-300 rounded bg-white",style:C});break;default:return null}if(e.id==="root")return t.jsx("div",{className:"h-full w-full flex flex-col min-h-0",children:de()});const F=!o&&m!=null&&String(e.id)===String(m),_=t.jsx(gn,{node:e,onUpdate:n,onSelect:a,parentLayout:i,isPreview:o,isSelected:F,children:f}),le=o&&(e.isHidden===!0||e.isUserInteractionEnabled===!1||e.accessibilityEnabled&&(e.accessibilityLabel||e.accessibilityIdentifier)||e.automationIdentifier||e.tag!=null)?(()=>{const x=e.isHidden===!0,k=e.isUserInteractionEnabled===!1,H=e.accessibilityEnabled&&e.accessibilityLabel?e.accessibilityLabel:void 0,U=e.accessibilityEnabled&&e.accessibilityIdentifier?e.accessibilityIdentifier:e.automationIdentifier||void 0;return t.jsx("div",{style:{display:x?"none":void 0,pointerEvents:k?"none":void 0},"aria-label":H||void 0,"data-accessibility-identifier":U||void 0,"data-tag":e.tag!=null?e.tag:void 0,children:_})})():_;return!o&&u!=null&&String(e.id)===String(u)?t.jsx("div",{className:"ring-2 ring-amber-400 ring-offset-1 rounded z-[5]",style:{boxSizing:"border-box"},title:"Data mapping highlight",children:le}):le}function jn(e,a){if(!e||e.type!==je)return null;const n=e.children||[],r=e.sheetShowHandle!==!1,i=e.paddingVertical!=null?e.paddingVertical:0,c=e.paddingHorizontal!=null?e.paddingHorizontal:0,o={paddingTop:e.paddingTop!=null?e.paddingTop:i,paddingBottom:e.paddingBottom!=null?e.paddingBottom:i,paddingLeft:c,paddingRight:c},s=m=>{a.isPreview||(m.stopPropagation(),a.onSelect(e))},u=a.containerDropOverlay!=null&&typeof a.renderChildrenWithDropZones=="function";return t.jsxs("div",{onClick:s,className:"rounded-t-lg border-2 border-dashed border-amber-400 bg-amber-50/80 min-h-[120px] flex flex-col relative",style:{...o},title:"Bottom sheet (add content as children)",children:[u&&a.containerDropOverlay,r&&t.jsx("div",{className:"flex justify-center py-1.5 mb-1",children:t.jsx("div",{className:"w-10 h-1 rounded-full bg-gray-400","aria-hidden":!0})}),t.jsx("div",{className:"flex-1 flex flex-col gap-2 min-h-0",children:u?a.renderChildrenWithDropZones():n.length===0?t.jsx("p",{className:"text-xs text-amber-700/80 italic p-2",children:"Drop content here"}):n.map(m=>t.jsx(Ce,{node:m,dataModel:a.dataModel,onSelect:a.onSelect,onUpdate:a.onUpdate,onMove:a.onMove,parentLayout:"col",isDragging:a.isDragging,isPreview:a.isPreview,listItemContext:a.listItemContext,highlightNodeId:a.highlightNodeId,selectedNodeId:a.selectedNodeId},m.id))})]})}const Rt="1.0",vn=Dt.map(e=>e.key),Sn=["paddingHorizontal","paddingVertical","paddingTop","paddingBottom","marginHorizontal","marginVertical","marginTop","marginBottom","marginLeft","marginRight","insetFromParentTop","insetFromParentLeft","insetFromParentBottom","insetFromParentRight","width","height","x","y","autoResize","layoutMode"],wn=[...vn,...Sn],Zt=Ft(),kn={paddingHorizontal:0,paddingVertical:0,paddingTop:0,paddingBottom:0,marginHorizontal:0,marginVertical:0,marginTop:0,marginBottom:0,marginLeft:0,marginRight:0,insetFromParentTop:0,insetFromParentLeft:0,insetFromParentBottom:0,insetFromParentRight:0,width:null,height:null,x:0,y:0,autoResize:!1,layoutMode:"autoLayout"};function Pn(e){const a={};for(const n of wn){let r=e[n];n==="textColor"&&r==null&&e.color!=null&&(r=e.color);const i=Zt[n]!==void 0?Zt[n]:kn[n],c=r??i;a[n]=c??null}return a}const z={View:{fitToScreen:!1,presentationStyle:"push"},VStack:{spacing:12,alignment:"center"},ZStack:{alignment:"center"},Text:{text:"",alignment:"start",numberOfLines:0,boundListItemProperty:""},Button:{title:"",boundListItemProperty:""},Image:{src:"",alt:"Image",contentMode:"contain",assetBundleName:"",assetImageName:"",boundListItemProperty:""},List:{items:[],loadMoreFooterLabel:"Load more",loadMoreLoadingLabel:"Loading...",listRowSpacing:0},ListItemText:{itemProperty:""},TextField:{placeholder:"Enter text",text:""},Toggle:{label:"Toggle"},Slider:{value:50,min:0,max:100},Picker:{selection:"Option 1",options:["Option 1","Option 2","Option 3"]},ProgressView:{progress:.5},Divider:{axis:"horizontal"},Link:{url:"https://example.com",label:"Link"},SecureField:{placeholder:"Password",text:""},...Bt()};function _e(e){if(!e||!e.type)return null;const a={type:e.type,id:e.id!=null?e.id:null,style:Pn(e)};switch(e.type){case"View":a.children=(e.children||[]).map(_e).filter(Boolean),a.fitToScreen=e.fitToScreen!=null?e.fitToScreen:z.View.fitToScreen,a.presentationStyle=e.presentationStyle!=null&&["push","present","modal"].includes(e.presentationStyle)?e.presentationStyle:z.View.presentationStyle;break;case"VStack":case"HStack":a.spacing=e.spacing!=null?e.spacing:z.VStack.spacing,a.alignment=e.alignment!=null?e.alignment:z.VStack.alignment,a.children=(e.children||[]).map(_e).filter(Boolean);break;case"ZStack":a.alignment=e.alignment!=null?e.alignment:z.ZStack.alignment,a.children=(e.children||[]).map(_e).filter(Boolean);break;case"Text":a.text=e.text!=null?e.text:z.Text.text,a.alignment=e.alignment!=null?e.alignment:z.Text.alignment,a.numberOfLines=typeof e.numberOfLines=="number"&&e.numberOfLines>=0?e.numberOfLines:z.Text.numberOfLines,a.boundListItemProperty=e.boundListItemProperty!=null?String(e.boundListItemProperty):z.Text.boundListItemProperty;break;case"Button":a.title=e.title!=null?e.title:z.Button.title,a.boundListItemProperty=e.boundListItemProperty!=null?String(e.boundListItemProperty):z.Button.boundListItemProperty;break;case"Image":a.src=e.src!=null?e.src:z.Image.src,a.alt=e.alt!=null?e.alt:z.Image.alt,a.contentMode=e.contentMode!=null?e.contentMode:z.Image.contentMode,a.useAsset=e.useAsset===!0,a.assetBundleName=e.assetBundleName!=null?e.assetBundleName:z.Image.assetBundleName,a.assetImageName=e.assetImageName!=null?e.assetImageName:z.Image.assetImageName,a.boundListItemProperty=e.boundListItemProperty!=null?String(e.boundListItemProperty):z.Image.boundListItemProperty,a.showLoadingIndicator=e.showLoadingIndicator===!0;break;case"List":a.items=Array.isArray(e.items)?e.items:z.List.items,a.children=(e.children||[]).map(_e).filter(Boolean),a.loadMoreEnabled=e.loadMoreEnabled===!0,a.loadMoreFooterLabel=e.loadMoreFooterLabel!=null?String(e.loadMoreFooterLabel):z.List.loadMoreFooterLabel,a.loadMoreLoadingLabel=e.loadMoreLoadingLabel!=null?String(e.loadMoreLoadingLabel):z.List.loadMoreLoadingLabel,a.sectionGroupingEnabled=e.sectionGroupingEnabled===!0,a.listRowSpacing=typeof e.listRowSpacing=="number"?e.listRowSpacing:z.List.listRowSpacing,a.listRowSpacingTop=typeof e.listRowSpacingTop=="number"?e.listRowSpacingTop:z.List.listRowSpacingTop,a.listRowSpacingBottom=typeof e.listRowSpacingBottom=="number"?e.listRowSpacingBottom:z.List.listRowSpacingBottom;break;case"ListItemContent":a.children=(e.children||[]).map(_e).filter(Boolean);break;case"ListItemText":a.itemProperty=e.itemProperty!=null?String(e.itemProperty):z.ListItemText.itemProperty;break;case"TextField":a.placeholder=e.placeholder!=null?e.placeholder:z.TextField.placeholder,a.text=e.text!=null?e.text:z.TextField.text;break;case"Toggle":a.isOn=e.isOn===!0,a.label=e.label!=null?e.label:z.Toggle.label;break;case"Slider":a.value=e.value!=null?e.value:z.Slider.value,a.min=e.min!=null?e.min:z.Slider.min,a.max=e.max!=null?e.max:z.Slider.max;break;case"Picker":a.selection=e.selection!=null?e.selection:Array.isArray(e.options)&&e.options[0]!=null?e.options[0]:z.Picker.selection,a.options=Array.isArray(e.options)?e.options:z.Picker.options;break;case"ProgressView":a.progress=e.progress!=null?e.progress:z.ProgressView.progress,a.indeterminate=e.indeterminate===!0;break;case"Divider":a.axis=e.axis!=null?e.axis:z.Divider.axis;break;case"Spacer":break;case"Link":a.url=e.url!=null?e.url:z.Link.url,a.label=e.label!=null?e.label:z.Link.label;break;case"SecureField":a.placeholder=e.placeholder!=null?e.placeholder:z.SecureField.placeholder,a.text=e.text!=null?e.text:z.SecureField.text;break;case"BottomSheet":sn(e,a,_e);break}a.localizationEnabled=e.localizationEnabled===!0,a.localizationKey=e.localizationKey!=null?String(e.localizationKey):"",a.localizationDefaultValue=e.localizationDefaultValue!=null?String(e.localizationDefaultValue):"",a.accessibilityEnabled=e.accessibilityEnabled===!0,a.accessibilityIdentifier=e.accessibilityIdentifier!=null?String(e.accessibilityIdentifier):"",a.accessibilityLabel=e.accessibilityLabel!=null?String(e.accessibilityLabel):"",a.tag=typeof e.tag=="number"&&!Number.isNaN(e.tag)?e.tag:0,a.isUserInteractionEnabled=e.isUserInteractionEnabled!==!1,a.isHidden=e.isHidden===!0,a.automationIdentifier=e.automationIdentifier!=null?String(e.automationIdentifier):"",a.actionId=e.actionId!=null?String(e.actionId):"",a.actionEvent=e.actionEvent!=null?String(e.actionEvent):"",a.actionBoundNodeId=e.actionBoundNodeId!=null?String(e.actionBoundNodeId):"",a.actionBoundProperty=e.actionBoundProperty!=null?String(e.actionBoundProperty):"",a.actionBoundDataModelId=e.actionBoundDataModelId!=null?String(e.actionBoundDataModelId):"",a.gestures=Array.isArray(e.gestures)?e.gestures.map(r=>({type:r&&r.type!=null?String(r.type):"tap",minDuration:typeof(r&&r.minDuration)=="number"?r.minDuration:void 0})):[];const n=e.displayFormat;return a.displayFormat=n&&typeof n=="object"&&n.type?{type:String(n.type),pattern:n.pattern!=null?String(n.pattern):void 0,locale:n.locale!=null?String(n.locale):void 0,formatterId:n.formatterId!=null?String(n.formatterId):void 0}:null,a.fillRemainingWidth=e.fillRemainingWidth===!0,a.componentName=e.componentName!=null?String(e.componentName):"",a}function Cn(e){const a=e!=null&&typeof e=="object"?e:{},r=(Array.isArray(a.dataModel)?a.dataModel:[]).map(l=>{if(!l||typeof l!="object")return null;const h=l.id!=null?String(l.id):"",N=l.name!=null?String(l.name):"",v={id:h,name:N};if(Object.prototype.hasOwnProperty.call(l,"value")&&l.value!==void 0)if(l.value===null||typeof l.value=="string"||typeof l.value=="number"||typeof l.value=="boolean")v.value=l.value;else if(typeof l.value=="object")try{v.value=JSON.parse(JSON.stringify(l.value))}catch{v.value=null}else v.value=String(l.value);return l.boundNodeId!=null&&l.boundNodeId!==""&&(v.boundNodeId=String(l.boundNodeId)),l.boundProperty!=null&&l.boundProperty!==""&&(v.boundProperty=String(l.boundProperty)),v}).filter(Boolean);let i=null;if(a.mockApiJson!=null&&typeof a.mockApiJson=="object")try{i=JSON.parse(JSON.stringify(a.mockApiJson))}catch{i=null}const c=Array.isArray(a.mockApiBindings)?a.mockApiBindings.map(l=>({apiPath:l&&l.apiPath!=null?String(l.apiPath):"",dataModelId:l&&l.dataModelId!=null?String(l.dataModelId):""})):[],o=typeof a.apiConfigMethod=="string"&&a.apiConfigMethod.trim()?a.apiConfigMethod.trim():null,s=typeof a.apiUrl=="string"&&a.apiUrl.trim()||null,u=typeof a.apiMethod=="string"&&["GET","POST","PUT","PATCH","DELETE"].includes(a.apiMethod)?a.apiMethod:null,m={dataModel:r,mockApiJson:i,mockApiBindings:c,loadMorePageParamName:typeof a.loadMorePageParamName=="string"&&a.loadMorePageParamName.trim()||null,loadMorePageParamInQuery:a.loadMorePageParamInQuery===!0,loadMoreHasNextPagePath:typeof a.loadMoreHasNextPagePath=="string"&&a.loadMoreHasNextPagePath.trim()||null};return(o||s||u)&&(m.apiConfigMethod=o,m.apiUrl=s,m.apiMethod=u,m.dataSource={type:"api",configMethod:o,url:s,method:u}),m}function ca(e,a){if(!e)return null;const n=e.children||[];let r;n.length===1?r={...n[0],fitToScreen:e.fitToScreen,presentationStyle:e.presentationStyle!=null?e.presentationStyle:"push"}:r={...e,id:"screen",children:n,presentationStyle:e.presentationStyle!=null?e.presentationStyle:"push"};const i={schemaVersion:Rt,root:_e(r)},c=a!=null&&typeof a=="object"?a:{},o=typeof e.screenId=="string"?e.screenId:c.screenId;return i.screenId=o!=null&&o!==""?o:"",i.dataMapping=Cn(a),i}function da(e){if(!e||!e.root)return null;const a=e.root,r=a.id==="screen"||a.type==="View"&&Array.isArray(a.children)&&a.children.length>1?(a.children||[]).map(Pt).filter(Boolean):[Pt(a)].filter(Boolean),i=a.presentationStyle!=null&&["push","present","modal"].includes(a.presentationStyle)?a.presentationStyle:"push";return{id:"root",type:"View",children:r,fitToScreen:a.fitToScreen===!0,screenId:typeof e.screenId=="string"?e.screenId:"",presentationStyle:i}}function Pt(e){if(!e||!e.type)return null;const a={id:e.id!=null?e.id:randomUUID(),type:e.type,...e.style||{}};(e.type==="View"||e.type==="VStack"||e.type==="HStack"||e.type==="ZStack"||e.type==="List"||e.type==="ListItemContent"||e.type==="BottomSheet")&&(a.children=(e.children||[]).map(Pt).filter(Boolean)),e.type==="View"&&(a.fitToScreen=e.fitToScreen!=null?e.fitToScreen:!1,a.presentationStyle=e.presentationStyle!=null&&["push","present","modal"].includes(e.presentationStyle)?e.presentationStyle:"push"),(e.type==="VStack"||e.type==="HStack")&&(a.spacing=e.spacing!=null?e.spacing:12,a.alignment=e.alignment!=null?e.alignment:"center"),e.type==="ZStack"&&(a.alignment=e.alignment!=null?e.alignment:"center"),e.type==="Text"&&(a.text=e.text!=null?e.text:"Hello",a.alignment=e.alignment!=null?e.alignment:"start",a.numberOfLines=typeof e.numberOfLines=="number"&&e.numberOfLines>=0?e.numberOfLines:0,a.boundListItemProperty=e.boundListItemProperty!=null?String(e.boundListItemProperty):""),e.type==="Button"&&(a.title=e.title!=null?e.title:"Tap Me",a.boundListItemProperty=e.boundListItemProperty!=null?String(e.boundListItemProperty):""),e.type==="Image"&&(a.src=e.src!=null?e.src:"",a.alt=e.alt!=null?e.alt:"Image",a.contentMode=e.contentMode!=null?e.contentMode:"contain",a.useAsset=e.useAsset===!0,a.assetBundleName=e.assetBundleName!=null?e.assetBundleName:"",a.assetImageName=e.assetImageName!=null?e.assetImageName:"",a.boundListItemProperty=e.boundListItemProperty!=null?String(e.boundListItemProperty):"",a.showLoadingIndicator=e.showLoadingIndicator===!0),e.type==="List"&&(a.items=Array.isArray(e.items)?e.items:["Item 1","Item 2","Item 3"],a.loadMoreEnabled=e.loadMoreEnabled===!0,a.loadMoreFooterLabel=e.loadMoreFooterLabel!=null?String(e.loadMoreFooterLabel):"Load more",a.loadMoreLoadingLabel=e.loadMoreLoadingLabel!=null?String(e.loadMoreLoadingLabel):"Loading...",a.sectionGroupingEnabled=e.sectionGroupingEnabled===!0,a.listRowSpacing=typeof e.listRowSpacing=="number"?e.listRowSpacing:0,a.listSpacingAboveFirst=typeof e.listSpacingAboveFirst=="number"?e.listSpacingAboveFirst:0,a.listSpacingBelowLast=typeof e.listSpacingBelowLast=="number"?e.listSpacingBelowLast:0),e.type==="ListItemText"&&(a.itemProperty=e.itemProperty!=null?String(e.itemProperty):""),e.type==="TextField"&&(a.placeholder=e.placeholder!=null?e.placeholder:"Enter text",a.text=e.text!=null?e.text:""),e.type==="Toggle"&&(a.isOn=e.isOn===!0,a.label=e.label!=null?e.label:"Toggle"),e.type==="Slider"&&(a.value=e.value!=null?e.value:50,a.min=e.min!=null?e.min:0,a.max=e.max!=null?e.max:100),e.type==="Picker"&&(a.selection=e.selection!=null?e.selection:"Option 1",a.options=Array.isArray(e.options)?e.options:["Option 1","Option 2","Option 3"]),e.type==="ProgressView"&&(a.progress=e.progress!=null?e.progress:.5,a.indeterminate=e.indeterminate===!0),e.type==="Divider"&&(a.axis=e.axis!=null?e.axis:"horizontal"),e.type,e.type==="Link"&&(a.url=e.url!=null?e.url:"https://example.com",a.label=e.label!=null?e.label:"Link"),e.type==="SecureField"&&(a.placeholder=e.placeholder!=null?e.placeholder:"Password",a.text=e.text!=null?e.text:""),e.type==="BottomSheet"&&on(e,a),a.localizationEnabled=e.localizationEnabled===!0,a.localizationKey=e.localizationKey!=null?String(e.localizationKey):"",a.localizationDefaultValue=e.localizationDefaultValue!=null?String(e.localizationDefaultValue):"",a.accessibilityEnabled=e.accessibilityEnabled===!0,a.accessibilityIdentifier=e.accessibilityIdentifier!=null?String(e.accessibilityIdentifier):"",a.accessibilityLabel=e.accessibilityLabel!=null?String(e.accessibilityLabel):"",a.tag=typeof e.tag=="number"&&!Number.isNaN(e.tag)?e.tag:0,a.isUserInteractionEnabled=e.isUserInteractionEnabled!==!1,a.isHidden=e.isHidden===!0,a.automationIdentifier=e.automationIdentifier!=null?String(e.automationIdentifier):"",a.actionId=e.actionId!=null?String(e.actionId):"",a.actionEvent=e.actionEvent!=null?String(e.actionEvent):"",a.actionBoundNodeId=e.actionBoundNodeId!=null?String(e.actionBoundNodeId):"",a.actionBoundProperty=e.actionBoundProperty!=null?String(e.actionBoundProperty):"",a.actionBoundDataModelId=e.actionBoundDataModelId!=null?String(e.actionBoundDataModelId):"",a.gestures=Array.isArray(e.gestures)?e.gestures.map(r=>({type:r&&r.type!=null?String(r.type):"tap",minDuration:typeof(r&&r.minDuration)=="number"?r.minDuration:void 0})):[];const n=e.displayFormat;return a.displayFormat=n&&typeof n=="object"&&n.type?{type:String(n.type),pattern:n.pattern!=null?String(n.pattern):void 0,locale:n.locale!=null?String(n.locale):void 0,formatterId:n.formatterId!=null?String(n.formatterId):void 0}:null,a.fillRemainingWidth=e.fillRemainingWidth===!0,a.componentName=e.componentName!=null?String(e.componentName):"",a}const Gt=Object.freeze(Object.defineProperty({__proto__:null,SCHEMA_VERSION:Rt,fromCanonicalJSON:da,toCanonicalJSON:ca},Symbol.toStringTag,{value:"Module"}));function In({currentProject:e,selectedScreenId:a,currentScreenName:n,onNewProject:r,onOpenProject:i,onSaveProject:c,onAddScreen:o,onAddScreenFromJson:s,onDeleteScreen:u,onSelectScreen:m,onOpenBoard:l,onLoadFromJson:h,onOpenFigma:N,tree:v,dataModel:P,mockApiJson:M,mockApiBindings:J,apiConfigMethod:V,apiUrl:D,apiMethod:I,loadMorePageParamName:y,loadMorePageParamInQuery:C,loadMoreHasNextPagePath:te,collapsed:W,onToggleCollapsed:L}){const X=p.useRef(null),Y=p.useRef(null),xe=p.useRef(null),[fe,de]=p.useState(!1),[ae,oe]=p.useState(""),[R,f]=p.useState(!1),[F,_]=p.useState(""),[le,pe]=p.useState(null),[x,k]=p.useState(null),[H,U]=p.useState(null),ue=()=>{r&&e?.screens?.length>0&&(v?.children?.length>0||(e.screens?.length||0)>1)?window.confirm("Start a new project? Current project and data will be cleared.")&&(oe(""),de(!0)):(oe(""),de(!0))},ce=()=>{r&&(r(ae.trim()||void 0),de(!1))},he=()=>{_(""),k(null),U(null),pe("choice")},q=()=>{pe(null),f(!1),k(null),U(null)},me=()=>{pe(null),f(!0)},ee=()=>{pe("fromJson"),k(null),U(null)},we=()=>{o&&(o(F.trim()||void 0),q())},Z=async S=>{const ne=S.target.files&&S.target.files[0];if(S.target.value="",!!ne)try{const K=await ne.text(),T=JSON.parse(K);if(!T||typeof T!="object"){alert("Invalid JSON file.");return}let Q=null,Ie=null;if(T.root!=null&&typeof T.root=="object"&&typeof T.root.type=="string"){const{fromCanonicalJSON:Ae}=await ot(async()=>{const{fromCanonicalJSON:w}=await Promise.resolve().then(()=>Gt);return{fromCanonicalJSON:w}},void 0,import.meta.url);if(Q=Ae(T),T.dataMapping!=null&&typeof T.dataMapping=="object"){const w=T.dataMapping;Ie={dataModel:Array.isArray(w.dataModel)?w.dataModel:[],mockApiJson:w.mockApiJson!=null&&typeof w.mockApiJson=="object"?w.mockApiJson:null,mockApiBindings:Array.isArray(w.mockApiBindings)?w.mockApiBindings:[],apiConfigMethod:typeof w.apiConfigMethod=="string"&&w.apiConfigMethod.trim()?w.apiConfigMethod.trim():w.dataSource&&w.dataSource.configMethod||null,apiUrl:typeof w.apiUrl=="string"?w.apiUrl.trim()||null:w.dataSource&&w.dataSource.url||null,apiMethod:typeof w.apiMethod=="string"&&["GET","POST","PUT","PATCH","DELETE"].includes(w.apiMethod)?w.apiMethod:w.dataSource&&w.dataSource.method||null,loadMorePageParamName:typeof w.loadMorePageParamName=="string"&&w.loadMorePageParamName.trim()||null,loadMorePageParamInQuery:w.loadMorePageParamInQuery===!0,loadMoreHasNextPagePath:typeof w.loadMoreHasNextPagePath=="string"&&w.loadMoreHasNextPagePath.trim()||null}}}else if(T.type==="View"&&Array.isArray(T.children))Q=T;else{alert("Not a valid UI export. Need a document with root (exported file) or a View tree.");return}Q&&(k(Q),U(Ie))}catch(K){alert("Load failed: "+(K!=null&&K.message!=null?K.message:String(K)))}},se=()=>{s&&x&&(s(F.trim()||void 0,x,H),q())},b=()=>{Y.current&&Y.current.click()},B=async S=>{const ne=S.target.files?.[0];S.target.value="",ne&&i&&await i(ne)},$=()=>{try{const S=ie=>{if(ie===void 0)return null;if(ie===null||typeof ie=="string"||typeof ie=="number"||typeof ie=="boolean")return ie;if(Array.isArray(ie))return ie.map(S);if(typeof ie=="object"){const Xe={};for(const qe of Object.keys(ie))Xe[qe]=S(ie[qe]);return Xe}return null},K={dataModel:(P||[]).map(ie=>ie&&typeof ie=="object"?{id:ie.id,name:ie.name,value:S(ie.value),boundNodeId:ie.boundNodeId??null,boundProperty:ie.boundProperty??null}:ie),mockApiJson:M!=null&&typeof M=="object"?S(M):null,mockApiBindings:J||[],apiConfigMethod:V||null,apiUrl:D||null,apiMethod:I||null,loadMorePageParamName:y||null,loadMorePageParamInQuery:C===!0,loadMoreHasNextPagePath:te||null},T=ca(v,K);if(!T||!T.root){alert("Export failed: no tree to export.");return}const Q=JSON.stringify(T,null,2),Ie=new Blob([Q],{type:"application/json"}),Ae=URL.createObjectURL(Ie),w=document.createElement("a");w.href=Ae;const Te=(n||"screen").replace(/[^a-zA-Z0-9_-]/g,"_");w.download=`${Te}-export.json`,w.click(),URL.revokeObjectURL(Ae)}catch(S){const ne=S&&S.message?S.message:String(S);alert("Export failed: "+ne),console.error("Export error",S)}},ge=()=>{X.current&&X.current.click()},E=async S=>{const ne=S.target.files&&S.target.files[0];if(!(!ne||!h)){S.target.value="";try{const K=await ne.text(),T=JSON.parse(K);if(!T||typeof T!="object"){alert("Invalid JSON file.");return}let Q=null,Ie=null;if(T.root!=null&&typeof T.root=="object"&&typeof T.root.type=="string"){const{fromCanonicalJSON:Ae}=await ot(async()=>{const{fromCanonicalJSON:w}=await Promise.resolve().then(()=>Gt);return{fromCanonicalJSON:w}},void 0,import.meta.url);if(Q=Ae(T),T.dataMapping!=null&&typeof T.dataMapping=="object"){const w=T.dataMapping;Ie={dataModel:Array.isArray(w.dataModel)?w.dataModel:[],mockApiJson:w.mockApiJson!=null&&typeof w.mockApiJson=="object"?w.mockApiJson:null,mockApiBindings:Array.isArray(w.mockApiBindings)?w.mockApiBindings:[],apiConfigMethod:typeof w.apiConfigMethod=="string"&&w.apiConfigMethod.trim()?w.apiConfigMethod.trim():w.dataSource&&w.dataSource.configMethod||null,apiUrl:typeof w.apiUrl=="string"?w.apiUrl.trim()||null:w.dataSource&&w.dataSource.url||null,apiMethod:typeof w.apiMethod=="string"&&["GET","POST","PUT","PATCH","DELETE"].includes(w.apiMethod)?w.apiMethod:w.dataSource&&w.dataSource.method||null,loadMorePageParamName:typeof w.loadMorePageParamName=="string"&&w.loadMorePageParamName.trim()||null,loadMorePageParamInQuery:w.loadMorePageParamInQuery===!0,loadMoreHasNextPagePath:typeof w.loadMoreHasNextPagePath=="string"&&w.loadMoreHasNextPagePath.trim()||null}}}else if(T.type==="View"&&Array.isArray(T.children))Q=T;else{alert("Not a valid UI export. Need a document with root (exported file) or a View tree.");return}Q&&h(Q,Ie)}catch(K){alert("Load failed: "+(K!=null&&K.message!=null?K.message:String(K)))}}};return W?t.jsx("div",{className:"w-10 shrink-0 h-full flex flex-col border-r border-gray-300 bg-gray-200",children:t.jsx("button",{type:"button",onClick:L,className:"flex-1 flex items-center justify-center text-gray-600 hover:bg-gray-300",title:"Open Project panel",children:"››"})}):t.jsxs("div",{className:"w-52 shrink-0 h-full min-h-0 bg-gray-100 border-r border-gray-300 flex flex-col overflow-hidden",children:[t.jsxs("div",{className:"shrink-0 flex items-center justify-between border-b border-gray-300 bg-gray-200 px-2 py-1.5",children:[t.jsx("span",{className:"font-semibold text-sm text-gray-800",children:"Project"}),t.jsx("button",{type:"button",onClick:L,className:"p-1 text-gray-600 hover:bg-gray-300 rounded",title:"Hide Project panel",children:"‹‹"})]}),t.jsxs("div",{className:"flex-1 min-h-0 flex flex-col overflow-hidden p-3",children:[t.jsxs("div",{className:"shrink-0 mb-3",children:[t.jsx("div",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1",children:"Current project"}),t.jsx("div",{className:"font-medium text-gray-900 truncate",title:e?.name,children:e?.name??"Untitled Project"}),t.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[t.jsx("button",{type:"button",onClick:ue,title:"New project",className:"p-1.5 rounded border border-slate-300 bg-white hover:bg-slate-50 text-slate-700 text-xs font-medium",children:"New"}),t.jsx("button",{type:"button",onClick:b,title:"Open project (.zip or project.json)",className:"p-1.5 rounded border border-slate-300 bg-white hover:bg-slate-50 text-slate-700 text-xs font-medium",children:"Open"}),t.jsx("button",{type:"button",onClick:c,title:"Save project as folder (.zip)",className:"p-1.5 rounded border border-slate-300 bg-white hover:bg-slate-50 text-slate-700 text-xs font-medium",children:"Save"})]}),t.jsx("input",{ref:Y,type:"file",accept:".zip,.json,application/zip,application/json",onChange:B,className:"hidden","aria-hidden":!0})]}),t.jsx("div",{className:"shrink-0 border-t border-gray-300 my-3"}),t.jsxs("div",{className:"shrink-0 space-y-2",children:[t.jsx("button",{type:"button",onClick:he,className:"w-full p-2 rounded border border-slate-300 bg-white hover:bg-slate-50 text-slate-700 text-sm font-medium",children:"+ New screen"}),l&&t.jsx("button",{type:"button",onClick:l,className:"w-full p-2 rounded border border-slate-400 bg-slate-100 hover:bg-slate-200 text-slate-800 text-sm font-medium",children:"Open board"})]}),t.jsxs("div",{className:"flex-1 min-h-0 flex flex-col mt-2",children:[t.jsx("div",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1 shrink-0",children:"Screens"}),t.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto border border-gray-200 rounded bg-white",style:{overflowX:"visible"},children:(e?.screens??[]).length===0?t.jsx("p",{className:"text-xs text-gray-500 p-2",children:"No screens"}):t.jsx("ul",{className:"py-1 list-none",children:(e?.screens??[]).map(S=>{const ne=S.id===a,K=(e?.screens?.length??0)>1;return t.jsxs("li",{className:"group relative flex items-center w-full",children:[t.jsx("button",{type:"button",onClick:()=>m&&m(S.id),className:`flex-1 min-w-0 text-left pl-3 pr-10 py-2 text-sm truncate ${ne?"bg-blue-100 text-blue-900":"hover:bg-gray-100 text-gray-800"}`,title:S.name,children:S.name||"Unnamed"}),u&&t.jsx("button",{type:"button",disabled:!K,onMouseDown:T=>{T.preventDefault(),T.stopPropagation(),K&&window.confirm(`Delete screen "${S.name||"Unnamed"}"?`)&&u(S.id)},onClick:T=>{T.preventDefault(),T.stopPropagation()},className:`absolute right-1 top-1/2 -translate-y-1/2 z-10 w-7 h-7 flex items-center justify-center rounded border bg-white shadow-sm opacity-0 group-hover:opacity-100 transition-opacity ${K?"border-red-300 text-red-600 hover:bg-red-100 cursor-pointer":"border-gray-200 text-gray-400 cursor-not-allowed"}`,title:K?"Delete screen":"Add another screen to enable delete","aria-label":"Delete screen",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},S.id)})})})]}),t.jsxs("div",{className:"shrink-0 pt-3 mt-3 border-t border-gray-300",children:[t.jsx("div",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Import / Export (current screen)"}),t.jsx("input",{ref:X,type:"file",accept:".json,application/json",onChange:E,className:"hidden","aria-hidden":!0}),t.jsx("button",{type:"button",onClick:ge,className:"w-full p-2 mb-2 bg-slate-600 text-white text-sm rounded shadow hover:bg-slate-500",children:"Load screen from JSON"}),N&&t.jsx("button",{type:"button",onClick:N,className:"w-full p-2 mb-2 bg-purple-600 text-white text-sm rounded shadow hover:bg-purple-500",children:"Figma"}),t.jsx("button",{type:"button",onClick:$,className:"w-full p-2 bg-slate-700 text-white text-sm rounded shadow hover:bg-slate-600",children:"Export screen JSON"}),t.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"SwiftUI & Android compatible"})]})]}),fe&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",onClick:()=>de(!1),children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-4 w-72",onClick:S=>S.stopPropagation(),children:[t.jsx("div",{className:"text-sm font-semibold text-gray-800 mb-2",children:"New project"}),t.jsx("input",{type:"text",value:ae,onChange:S=>oe(S.target.value),placeholder:"Project name",className:"w-full border border-gray-300 rounded px-2 py-1.5 text-sm mb-3",autoFocus:!0,onKeyDown:S=>S.key==="Enter"&&ce()}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{type:"button",onClick:()=>de(!1),className:"px-3 py-1.5 text-sm border border-gray-300 rounded hover:bg-gray-100",children:"Cancel"}),t.jsx("button",{type:"button",onClick:ce,className:"px-3 py-1.5 text-sm bg-blue-600 text-white rounded hover:bg-blue-500",children:"Create"})]})]})}),le==="choice"&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",onClick:q,children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-4 w-72",onClick:S=>S.stopPropagation(),children:[t.jsx("div",{className:"text-sm font-semibold text-gray-800 mb-3",children:"New screen"}),t.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Add an empty screen or load from a JSON file."}),t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("button",{type:"button",onClick:me,className:"w-full p-3 text-left rounded border border-slate-300 bg-white hover:bg-slate-50 text-slate-800 text-sm font-medium",children:"Empty screen"}),t.jsx("button",{type:"button",onClick:ee,className:"w-full p-3 text-left rounded border border-slate-300 bg-white hover:bg-slate-50 text-slate-800 text-sm font-medium",children:"From JSON"})]}),t.jsx("div",{className:"mt-3 flex justify-end",children:t.jsx("button",{type:"button",onClick:q,className:"px-3 py-1.5 text-sm border border-gray-300 rounded hover:bg-gray-100",children:"Cancel"})})]})}),le==="fromJson"&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",onClick:q,children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-4 w-80",onClick:S=>S.stopPropagation(),children:[t.jsx("div",{className:"text-sm font-semibold text-gray-800 mb-2",children:"New screen from JSON"}),t.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Screen name (label in panel)"}),t.jsx("input",{type:"text",value:F,onChange:S=>_(S.target.value),placeholder:"e.g. Detail",className:"w-full border border-gray-300 rounded px-2 py-1.5 text-sm mb-3",autoFocus:!0}),t.jsx("input",{ref:xe,type:"file",accept:".json,application/json",onChange:Z,className:"hidden","aria-hidden":!0}),t.jsx("button",{type:"button",onClick:()=>xe.current&&xe.current.click(),className:"w-full p-2 mb-3 border border-slate-400 bg-slate-100 hover:bg-slate-200 text-slate-800 text-sm rounded",children:x?"✓ JSON loaded — choose another file":"Choose JSON file"}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{type:"button",onClick:q,className:"px-3 py-1.5 text-sm border border-gray-300 rounded hover:bg-gray-100",children:"Cancel"}),t.jsx("button",{type:"button",onClick:se,disabled:!x,className:"px-3 py-1.5 text-sm bg-blue-600 text-white rounded hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Add screen"})]})]})}),R&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",onClick:()=>f(!1),children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-4 w-72",onClick:S=>S.stopPropagation(),children:[t.jsx("div",{className:"text-sm font-semibold text-gray-800 mb-2",children:"New screen (empty)"}),t.jsx("input",{type:"text",value:F,onChange:S=>_(S.target.value),placeholder:"Screen name (label in panel)",className:"w-full border border-gray-300 rounded px-2 py-1.5 text-sm mb-3",autoFocus:!0,onKeyDown:S=>S.key==="Enter"&&we()}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{type:"button",onClick:()=>f(!1),className:"px-3 py-1.5 text-sm border border-gray-300 rounded hover:bg-gray-100",children:"Cancel"}),t.jsx("button",{type:"button",onClick:we,className:"px-3 py-1.5 text-sm bg-blue-600 text-white rounded hover:bg-blue-500",children:"Add"})]})]})})]})}const ua=["View","VStack","HStack","ZStack","List","ListItemContent","BottomSheet"],ma=e=>e&&ua.includes(e.type),Ke={NavigationBar:"Navigation bar",View:"Container",VStack:"Vertical stack",HStack:"Horizontal stack",ZStack:"Z stack",Text:"Text",Button:"Button",Image:"Image",List:"List",BottomSheet:en,ListItemContent:"Table cell",ListItemText:"Item text",TextField:"Text field",Toggle:"Toggle",Slider:"Slider",Picker:"Picker",ProgressView:"Progress",Divider:"Divider",Spacer:"Spacer",Link:"Link",SecureField:"Secure field"},Ct={NavigationBar:"Full-width bar with left button, title text, and right button (exports as View tree)",View:"A box that holds other elements",VStack:"Stack items top to bottom",HStack:"Stack items left to right",ZStack:"Stack items on top of each other",Text:"A line of text",Button:"A tappable button",Image:"A picture from a URL",List:"A list of items (add a row template as child)",BottomSheet:tn,ListItemContent:"Table cell — add controls inside (Item text, Text, Button, etc.)",ListItemText:"Shows current row’s item (use inside Table cell)",TextField:"Single-line text input",Toggle:"On/off switch",Slider:"Value slider with range",Picker:"Selection from options",ProgressView:"Progress bar (determinate or indeterminate)",Divider:"Horizontal or vertical line",Spacer:"Flexible space (use inside VStack or HStack)",Link:"URL link with label",SecureField:"Password text input"};function He(e){return Ke[e]!=null?Ke[e]:e}function pa(e){return e?e.componentName&&Ke[e.componentName]!=null?Ke[e.componentName]:e.type==="Text"?(e.text||"Text").slice(0,30):e.type==="Button"?(e.title||"Button").slice(0,30):He(e.type):""}function It(e){return Ct[e]!=null?Ct[e]:""}function Mn(){return{...Ft(),...{paddingHorizontal:0,paddingVertical:0,paddingTop:0,paddingBottom:0},...{marginHorizontal:0,marginVertical:0,marginTop:0,marginBottom:0,marginLeft:0,marginRight:0},...{insetFromParentTop:0,insetFromParentLeft:0,insetFromParentBottom:0,insetFromParentRight:0},...{layoutMode:"autoLayout",x:0,y:0,autoResize:!1},...{localizationEnabled:!1,localizationKey:"",localizationDefaultValue:""},...{accessibilityEnabled:!1,accessibilityIdentifier:"",accessibilityLabel:""},...{tag:0,isUserInteractionEnabled:!0,isHidden:!1,automationIdentifier:""},...{actionId:"",actionEvent:"",actionBoundNodeId:"",actionBoundProperty:"",actionBoundDataModelId:""},...{gestures:[]},...{displayFormat:null}}}Ft();const Fe=e=>{const a=Se(),n=Mn();switch(e){case"Text":return{id:a,type:"Text",text:"Hello",alignment:"start",numberOfLines:0,color:"#111111",boundListItemProperty:"",...n};case"Button":return{id:a,type:"Button",title:"Tap Me",boundListItemProperty:"",gestures:[{type:"tap"}],...n};case"Image":return{id:a,type:"Image",src:"",alt:"Image",contentMode:"contain",useAsset:!1,assetBundleName:"",assetImageName:"",boundListItemProperty:"",showLoadingIndicator:!1,...n};case"View":return{id:a,type:"View",children:[],...n,backgroundColor:"#ffffff",presentationStyle:"push"};case"VStack":case"HStack":return{id:a,type:e,spacing:12,alignment:"center",children:[],...n,backgroundColor:"#ffffff"};case"ZStack":return{id:a,type:"ZStack",alignment:"center",children:[],...n,backgroundColor:"#ffffff"};case"List":return{id:a,type:"List",items:["Item 1","Item 2","Item 3"],children:[],loadMoreEnabled:!1,loadMoreFooterLabel:"Load more",loadMoreLoadingLabel:"Loading...",sectionGroupingEnabled:!1,listRowSpacing:0,listSpacingAboveFirst:0,listSpacingBelowLast:0,...n};case"BottomSheet":return an(a,n);case"ListItemContent":return{id:a,type:"ListItemContent",children:[],...n};case"ListItemText":return{id:a,type:"ListItemText",itemProperty:"",...n};case"TextField":return{id:a,type:"TextField",placeholder:"Enter text",text:"",...n};case"Toggle":return{id:a,type:"Toggle",isOn:!1,label:"Toggle",...n};case"Slider":return{id:a,type:"Slider",value:50,min:0,max:100,...n};case"Picker":return{id:a,type:"Picker",selection:"Option 1",options:["Option 1","Option 2","Option 3"],...n};case"ProgressView":return{id:a,type:"ProgressView",progress:.5,indeterminate:!1,...n};case"Divider":return{id:a,type:"Divider",axis:"horizontal",...n};case"Spacer":return{id:a,type:"Spacer",...n};case"Link":return{id:a,type:"Link",url:"https://example.com",label:"Link",...n};case"SecureField":return{id:a,type:"SecureField",placeholder:"Password",text:"",...n};default:return null}},Re=44;function Ln(){const e=Fe("Image");e.src="",e.alt="Left",e.width=Re,e.height=Re;const a=Fe("Button");a.title="",a.width=Re,a.height=Re;const n=Fe("ZStack");n.width=70,n.height=70,n.children=[e,a];const r=Fe("Text");r.text="Title",r.alignment="center",r.fillRemainingWidth=!0;const i=Fe("Image");i.src="",i.alt="Right",i.width=Re,i.height=Re;const c=Fe("Button");c.title="",c.width=Re,c.height=Re;const o=Fe("ZStack");o.width=70,o.height=70,o.alignment="trailing",o.children=[i,c];const s=Fe("HStack");return s.componentName="NavigationBar",s.spacing=0,s.alignment="center",s.height=70,s.children=[n,r,o],s}const Yt=["Text","Button","Image","VStack","HStack","ZStack","List",je,"ListItemContent","ListItemText","TextField","Toggle","Slider","Picker","ProgressView","Divider","Spacer","Link","SecureField"];function An({tree:e,selected:a,onAdd:n,collapsed:r,onToggleCollapsed:i}){const[c,o]=p.useState(""),s=p.useMemo(()=>{const m=(c||"").trim().toLowerCase();return m?Yt.filter(l=>He(l).toLowerCase().includes(m)||l.toLowerCase().includes(m)):Yt},[c]),u=a&&ma(a)?He(a.type):"canvas";return r?t.jsx("div",{className:"w-10 shrink-0 h-full flex flex-col border-r border-gray-300 bg-gray-200",children:t.jsx("button",{type:"button",onClick:i,className:"flex-1 flex items-center justify-center text-gray-600 hover:bg-gray-300",title:"Open Controls panel",children:"››"})}):t.jsxs("div",{className:"w-60 shrink-0 h-full min-h-0 bg-gray-100 border-r border-gray-300 flex flex-col overflow-hidden",children:[t.jsxs("div",{className:"shrink-0 flex items-center justify-between border-b border-gray-300 bg-gray-200 px-2 py-1.5",children:[t.jsx("h3",{className:"font-bold text-sm text-gray-800",children:"Add to layout"}),t.jsx("button",{type:"button",onClick:i,className:"p-1 text-gray-600 hover:bg-gray-300 rounded",title:"Hide Controls panel",children:"‹‹"})]}),t.jsxs("div",{className:"flex-1 min-h-0 flex flex-col overflow-hidden p-4",children:[t.jsxs("p",{className:"text-xs text-gray-500 mb-2 shrink-0",children:["New items go into: ",t.jsx("strong",{children:u})]}),t.jsx("div",{className:"mb-2",children:t.jsx("input",{type:"search",placeholder:"Search controls...",value:c,onChange:m=>o(m.target.value),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md bg-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-slate-400 focus:border-slate-400","aria-label":"Search controls"})}),t.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto flex flex-col gap-2 pr-1 -mr-1",children:[t.jsx("button",{type:"button",onClick:()=>n(Ln()),title:Ct.NavigationBar,className:"w-full p-2 bg-indigo-50 border border-indigo-200 rounded shadow hover:bg-indigo-100 text-left shrink-0",children:t.jsx("span",{className:"font-medium",children:Ke.NavigationBar})}),s.length===0?t.jsxs("p",{className:"text-xs text-gray-500 py-2",children:['No controls match "',c,'"']}):s.map(m=>t.jsx("button",{onClick:()=>n(Fe(m)),title:It(m),className:"w-full p-2 bg-white rounded shadow hover:bg-gray-50 text-left shrink-0",children:t.jsx("span",{className:"font-medium",children:He(m)})},m))]})]})]})}const Mt=390,ha=844,Tn=12,En=44,ga=48,xa=32,xt=Mt,bt=ha-ga-xa,at=800,ft=600;function Dn({tree:e,dataModel:a,selectedNodeId:n,onSelect:r,onUpdate:i,onMove:c,isDragging:o=!1,onOpenPreview:s,deviceType:u="mobile",onDeviceTypeChange:m,highlightNodeId:l,onUndo:h,onRedo:N,canUndo:v=!1,canRedo:P=!1}){const M=e&&e.fitToScreen===!0,J=u==="web"?{width:at,height:ft,minWidth:at,minHeight:ft}:{width:xt,height:bt,minWidth:xt,minHeight:bt},V=u==="web"?t.jsx("div",{className:"bg-white overflow-auto border-x border-b border-gray-300 relative",style:{width:at,height:ft},children:t.jsx("div",{className:`box-border ${M?"absolute inset-0":""}`,style:M?void 0:J,children:t.jsx(Ce,{node:e,dataModel:a,selectedNodeId:n,onSelect:r,onUpdate:i,onMove:c,isDragging:o,highlightNodeId:l})})}):t.jsxs("div",{className:"bg-black overflow-hidden flex flex-col",style:{width:Mt,height:ha,borderRadius:En-4},children:[t.jsx("div",{className:"shrink-0 flex items-end justify-center pb-1 bg-white",style:{height:ga},children:t.jsx("div",{className:"w-24 h-6 rounded-full bg-black",title:"Dynamic Island"})}),t.jsx("div",{className:"shrink-0 overflow-auto bg-white relative",style:{width:xt,height:bt},children:t.jsx("div",{className:`box-border ${M?"absolute inset-0 w-full h-full":""}`,style:M?void 0:J,children:t.jsx(Ce,{node:e,dataModel:a,selectedNodeId:n,onSelect:r,onUpdate:i,onMove:c,isDragging:o,highlightNodeId:l})})}),t.jsx("div",{className:"shrink-0 flex items-center justify-center bg-white",style:{height:xa},children:t.jsx("div",{className:"w-32 h-1 rounded-full bg-gray-300"})})]}),D=u==="web"?t.jsxs("div",{className:"bg-gray-200 rounded-t-lg overflow-hidden shadow-lg border border-gray-300",style:{width:at+2},children:[t.jsxs("div",{className:"h-8 px-3 flex items-center gap-2 bg-gray-100 border-b border-gray-300",children:[t.jsxs("div",{className:"flex gap-1.5",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-red-400"}),t.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-400"}),t.jsx("div",{className:"w-3 h-3 rounded-full bg-green-400"})]}),t.jsx("div",{className:"flex-1 flex justify-center",children:t.jsx("div",{className:"px-4 py-1 bg-white rounded text-xs text-gray-400 border border-gray-200 max-w-[280px] w-full truncate text-center",children:"https://example.com"})})]}),V]}):t.jsx("div",{className:"flex-shrink-0 bg-black rounded-[3rem] p-[10px] shadow-2xl",style:{width:Mt+Tn*2},children:V});return t.jsxs("div",{className:"flex-1 relative p-6 bg-gray-100 overflow-auto",children:[t.jsxs("div",{className:"absolute top-4 left-4 right-4 z-10 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"flex rounded-lg overflow-hidden border border-gray-300 bg-white shadow-sm",children:[t.jsx("button",{type:"button",onClick:h,disabled:!v,className:"px-3 py-2 text-sm font-medium border-r border-gray-200 bg-white text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",title:"Undo (Ctrl+Z)",children:"Undo"}),t.jsx("button",{type:"button",onClick:N,disabled:!P,className:"px-3 py-2 text-sm font-medium bg-white text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",title:"Redo (Ctrl+Shift+Z)",children:"Redo"})]}),t.jsxs("div",{className:"flex rounded-lg overflow-hidden border border-gray-300 bg-white shadow-sm",children:[t.jsx("button",{type:"button",onClick:()=>m&&m("mobile"),className:`px-4 py-2 text-sm font-medium ${u==="mobile"?"bg-slate-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,title:"Mobile device frame",children:"Mobile"}),t.jsx("button",{type:"button",onClick:()=>m&&m("web"),className:`px-4 py-2 text-sm font-medium ${u==="web"?"bg-slate-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,title:"Web / browser frame",children:"Web"})]})]}),t.jsx("button",{type:"button",onClick:s,className:"px-3 py-2 text-sm font-medium bg-slate-600 hover:bg-slate-700 text-white rounded shadow border border-slate-500",title:"Open preview",children:"Preview"})]}),t.jsx("div",{className:"pt-14 flex items-start justify-center min-h-full",children:D})]})}const Ht=120,zt=180,rt=390,st=600,Fn=Math.min(Ht/rt,zt/st);function Bn({tree:e,dataModel:a}){const n=e?.children??[];return t.jsx("div",{className:"bg-white overflow-hidden relative",style:{width:Ht,height:zt},children:t.jsx("div",{className:"absolute left-0 top-0 bg-white",style:{width:rt,height:st,transform:`scale(${Fn})`,transformOrigin:"top left"},children:n.length===0?t.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-300 text-xs",style:{width:rt,height:st},children:"Empty"}):t.jsx("div",{className:"bg-white",style:{width:rt,minHeight:st},children:n.map(r=>t.jsx(Ce,{node:r,dataModel:a||[],isPreview:!0},r.id))})})})}const yt=[.5,.75,1,1.25,1.5,2,2.5,3],On=2;function Rn({project:e,selectedScreenId:a,onSelectScreen:n,onClose:r,dataModel:i}){const c=e?.screens??[],[o,s]=p.useState(On),u=yt[o],m=o>0,l=o<yt.length-1;return t.jsxs("div",{className:"flex-1 flex flex-col min-h-0 bg-gray-50 relative",children:[t.jsxs("div",{className:"shrink-0 flex items-center justify-between px-4 py-2 border-b border-gray-300 bg-white",children:[t.jsx("span",{className:"font-semibold text-gray-800",children:"Board"}),t.jsx("button",{type:"button",onClick:r,className:"px-3 py-1.5 text-sm font-medium bg-slate-600 text-white rounded hover:bg-slate-500",children:"Close board"})]}),t.jsx("div",{className:"flex-1 overflow-auto p-4 min-h-0",children:t.jsx("div",{className:"flex flex-wrap gap-4 transition-transform duration-150",style:{transform:`scale(${u})`,transformOrigin:"top left"},children:c.length===0?t.jsx("p",{className:"text-gray-500 text-sm",children:"No screens. Add a screen from the Project panel."}):c.map(h=>{const N=h.id===a,v=h.tree;return t.jsxs("button",{type:"button",onClick:()=>n(h.id),className:`shrink-0 rounded-xl border-2 overflow-hidden text-left transition-colors flex flex-col ${N?"border-blue-500 bg-blue-50 ring-2 ring-blue-200":"border-gray-200 bg-white hover:border-gray-300 hover:bg-gray-50"}`,children:[t.jsx("div",{className:"shrink-0 overflow-hidden rounded-t-lg bg-gray-100",style:{width:Ht,height:zt},children:t.jsx(Bn,{tree:v,dataModel:i})}),t.jsx("div",{className:"shrink-0 px-3 py-2 border-t border-gray-100",children:t.jsx("div",{className:"font-medium text-gray-900 truncate text-sm",title:h.name,children:h.name||"Unnamed"})})]},h.id)})})}),t.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex items-center gap-0 rounded-full border border-gray-300 bg-white shadow-lg overflow-hidden",children:[t.jsx("button",{type:"button",onClick:()=>s(h=>Math.max(0,h-1)),disabled:!m,className:"w-10 h-10 flex items-center justify-center text-gray-700 hover:bg-gray-100 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-transparent",title:"Zoom out","aria-label":"Zoom out",children:t.jsx("span",{className:"text-lg font-medium leading-none",children:"−"})}),t.jsx("div",{className:"w-px bg-gray-200"}),t.jsx("button",{type:"button",onClick:()=>s(h=>Math.min(yt.length-1,h+1)),disabled:!l,className:"w-10 h-10 flex items-center justify-center text-gray-700 hover:bg-gray-100 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-transparent",title:"Zoom in","aria-label":"Zoom in",children:t.jsx("span",{className:"text-lg font-medium leading-none",children:"+"})})]})]})}function Pe(){return t.jsx("hr",{className:"my-3 border-gray-300"})}function Me({title:e,children:a}){return t.jsxs("div",{className:"mb-3",children:[e&&t.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-2",children:e}),a]})}function nt(e){if(!e||e==="transparent")return{hex6:"#000000",alpha:0};const a=String(e).trim();if(a.startsWith("#")){if(a.length===9){const r=a.slice(7,9);return{hex6:a.slice(0,7),alpha:parseInt(r,16)/255}}return{hex6:a.length>=7?a.slice(0,7):"#000000",alpha:1}}const n=a.match(/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*([\d.]+)\s*)?\)/);if(n){const r=parseInt(n[1],10),i=parseInt(n[2],10),c=parseInt(n[3],10),o=n[4]!=null?parseFloat(n[4]):1;return{hex6:"#"+[r,i,c].map(u=>Math.max(0,Math.min(255,u)).toString(16).padStart(2,"0")).join(""),alpha:o}}return{hex6:"#000000",alpha:1}}function Je(e,a,n=!1){const r=e.startsWith("#")?e:"#"+e,i=r.length>=7?r.slice(0,7):"#000000";if(a>=1)return i;if(a<=0)return n?"transparent":i+"00";const c=Math.round(a*255).toString(16).padStart(2,"0");return i+c}function Hn({def:e,value:a,onChange:n,storedValue:r}){const i=a??e.default,c=r!==void 0?r:a,o="w-full p-2 border rounded",s="block text-sm mb-1";if(e.type==="select")return t.jsxs(t.Fragment,{children:[t.jsx("label",{className:s,children:e.label}),t.jsx("select",{value:i,onChange:u=>n(u.target.value),className:o+" mb-2",children:e.options.map(u=>t.jsx("option",{value:u.value,children:u.label},u.value))})]});if(e.type==="number")return t.jsxs(t.Fragment,{children:[t.jsx("label",{className:s,children:e.label}),t.jsx("input",{type:"number",min:e.min,max:e.max,value:i,onChange:u=>n(Number(u.target.value)),className:o+" mb-2"})]});if(e.type==="color"){const{hex6:u,alpha:m}=nt(i),l=nt(c),h=Math.round(m*100),N=m<=0?1:m,v=c==null||c===""||l.alpha===0;return t.jsxs(t.Fragment,{children:[t.jsx("label",{className:s,children:e.label}),t.jsxs("div",{className:"border border-slate-300 rounded p-2 mb-2 bg-white",children:[t.jsxs("div",{className:"flex gap-2 items-center",children:[v?t.jsxs("div",{className:"relative w-10 h-8 flex-shrink-0 rounded border border-slate-300 overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 color-swatch-transparent",title:"No color"}),t.jsx("input",{type:"color",value:"#000000",onChange:P=>n(Je(P.target.value,N)),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",title:"Pick color"})]}):t.jsx("input",{type:"color",value:u,onChange:P=>n(Je(P.target.value,N)),className:"w-10 h-8 p-0 border border-slate-300 rounded cursor-pointer flex-shrink-0",title:"Pick color"}),t.jsx("input",{type:"text",value:i??"",onChange:P=>n(P.target.value),placeholder:["foregroundColor","borderColor"].includes(e.key)?"none":"#hex or #hexAA",className:"flex-1 min-w-0 p-2 border border-slate-300 rounded font-mono text-sm "+o})]}),t.jsxs("div",{className:"mt-2",children:[t.jsx("label",{className:"text-xs text-gray-600",children:"Alpha"}),t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx("input",{type:"range",min:0,max:100,value:h,onChange:P=>n(Je(u,Number(P.target.value)/100)),className:"flex-1"}),t.jsxs("span",{className:"text-xs text-gray-500 w-8",children:[h,"%"]})]})]}),i?t.jsx("button",{type:"button",onClick:()=>n(""),className:"mt-1.5 text-xs text-slate-500 hover:underline",children:"Clear color"}):t.jsx("span",{className:"mt-1.5 text-xs text-slate-500",children:"Clear color (default)"})]})]})}if(e.type==="colorTransparent"){const{hex6:u,alpha:m}=nt(i),l=nt(c??e.default),h=Math.round(m*100),N=m<=0?1:m,v=c==="transparent"||c===""||c==null||String(c||"").trim().toLowerCase()==="transparent"||l.alpha===0;return t.jsxs(t.Fragment,{children:[t.jsx("label",{className:s,children:e.label}),t.jsxs("div",{className:"border border-slate-300 rounded p-2 mb-2 bg-white",children:[t.jsxs("div",{className:"flex gap-2 items-center",children:[v?t.jsxs("div",{className:"relative w-10 h-8 flex-shrink-0 rounded border border-slate-300 overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 color-swatch-transparent",title:"Transparent"}),t.jsx("input",{type:"color",value:"#ffffff",onChange:P=>n(Je(P.target.value,N)),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",title:"Pick color"})]}):t.jsx("input",{type:"color",value:u,onChange:P=>n(Je(P.target.value,N)),className:"w-10 h-8 p-0 border border-slate-300 rounded cursor-pointer flex-shrink-0",title:"Pick color"}),t.jsx("input",{type:"text",value:i??"transparent",onChange:P=>n(P.target.value),placeholder:"transparent or #hex or #hexAA",className:"flex-1 min-w-0 p-2 border border-slate-300 rounded font-mono text-sm "+o})]}),t.jsxs("div",{className:"mt-2",children:[t.jsx("label",{className:"text-xs text-gray-600",children:"Alpha"}),t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx("input",{type:"range",min:0,max:100,value:h,onChange:P=>n(Je(v?"#ffffff":u,Number(P.target.value)/100,!0)),className:"flex-1"}),t.jsxs("span",{className:"text-xs text-gray-500 w-8",children:[h,"%"]})]})]}),v?t.jsx("span",{className:"mt-1.5 text-xs text-slate-500",children:"Clear color (default)"}):t.jsx("button",{type:"button",onClick:()=>n("transparent"),className:"mt-1.5 text-xs text-slate-500 hover:underline",children:"Clear color"})]})]})}if(e.type==="range"){const u=e.fromValue?e.fromValue(i):i,m=l=>n(e.toValue?e.toValue(Number(l.target.value)):Number(l.target.value));return t.jsxs(t.Fragment,{children:[t.jsxs("label",{className:s,children:[e.label," (0–100)"]}),t.jsx("input",{type:"range",min:e.min??0,max:e.max??100,value:u,onChange:m,className:"w-full mb-1"}),t.jsxs("span",{className:"text-xs text-gray-500",children:[u,"%"]})]})}return null}function zn(e,a){return!e||!a||a.id==="root"?!1:(e.children||[]).some(r=>(r.id!=null?String(r.id):null)===(a.id!=null?String(a.id):null))}function Le(e){return e?e.layoutMode==="autoResize"||e.layoutMode==="autoLayout"||e.layoutMode==="freeForm"?e.layoutMode:e.autoResize===!0?"autoResize":"autoLayout":"autoLayout"}function _n({tree:e,selected:a,dataModel:n,onUpdate:r,onDelete:i,screenName:c,onScreenNameChange:o}){if(!a)return t.jsx("div",{className:"w-72 min-h-full bg-gray-100 p-4",children:"No selection"});const s=(l,h)=>{const N=a?.id;N!=null&&r(typeof l=="object"&&l!==null&&h===void 0?{...a,id:String(N),...l}:{...a,id:String(N),[l]:h})},u=Ka(a.type),m=a.id==="root";return t.jsxs("div",{className:"w-72 min-h-full bg-gray-100 p-4",children:[t.jsx("h3",{className:"font-bold mb-1",children:m?"Canvas":pa(a)}),m?t.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Screen settings. Not a component — your components are listed below in the tree."}):It(a.type)?t.jsx("p",{className:"text-xs text-gray-500 mb-3",children:It(a.type)}):null,m&&o!=null&&t.jsxs(t.Fragment,{children:[t.jsxs(Me,{title:"Screen",children:[t.jsx("label",{className:"block text-sm mb-1",children:"Screen name"}),t.jsx("input",{value:c??"",onChange:l=>o(l.target.value),placeholder:"Screen name (label in panel)",className:"w-full p-2 border rounded text-sm bg-white mb-2",title:"Label shown in the left panel screen list"})]}),t.jsx(Pe,{})]}),!m&&t.jsxs(t.Fragment,{children:[t.jsx(Pe,{}),t.jsxs(Me,{title:"Identity",children:[t.jsx("label",{className:"block text-sm mb-1",children:"Object ID"}),t.jsx("input",{value:a.id??"",onChange:l=>s("id",l.target.value),placeholder:"Unique ID",className:"w-full p-2 border rounded text-xs font-mono bg-white mb-2"}),t.jsx("label",{className:"block text-sm mb-1",children:"Tag"}),t.jsx("input",{type:"number",min:0,value:a.tag??0,onChange:l=>s("tag",l.target.value===""?0:parseInt(l.target.value,10)||0),placeholder:"0",className:"w-full p-2 border rounded text-xs bg-white",title:"Numeric tag for runtime / automation"})]})]}),t.jsx(Pe,{}),t.jsxs(Me,{title:"Content",children:[a.type==="Text"&&t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"block text-sm mb-1",children:"Text"}),t.jsx("input",{value:O(a,"text","Text")??"",onChange:l=>s("text",l.target.value),className:"w-full p-2 border rounded mb-2"}),t.jsx("label",{className:"block text-sm mb-1",children:"Alignment"}),t.jsxs("select",{value:O(a,"alignment","Text")??"start",onChange:l=>s("alignment",l.target.value),className:"w-full p-2 border rounded mb-2",children:[t.jsx("option",{value:"start",children:"Leading (left)"}),t.jsx("option",{value:"center",children:"Center"}),t.jsx("option",{value:"end",children:"Trailing (right)"})]}),t.jsx("label",{className:"block text-sm mb-1",children:"Number of lines"}),t.jsx("input",{type:"number",min:0,value:O(a,"numberOfLines","Text")??0,onChange:l=>s("numberOfLines",Math.max(0,parseInt(l.target.value,10)||0)),className:"w-full p-2 border rounded mb-3",title:"0 = unlimited"}),t.jsx("p",{className:"text-xs text-gray-500 -mt-2 mb-3",children:"0 = unlimited"}),t.jsx("label",{className:"block text-sm mb-1",children:"Bind to list item property"}),t.jsx("input",{value:a.boundListItemProperty??"",onChange:l=>s("boundListItemProperty",l.target.value),placeholder:"e.g. name, title (when inside list row)",className:"w-full p-2 border rounded mb-2",title:"When inside a list row, show this property of each array item instead of Text"}),t.jsx("p",{className:"text-xs text-gray-500 -mt-2 mb-3",children:"Optional. When inside a list row, display this key from the array item."})]}),a.type==="Button"&&t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"block text-sm mb-1",children:"Title"}),t.jsx("input",{value:O(a,"title","Button")??"Tap Me",onChange:l=>s("title",l.target.value),className:"w-full p-2 border rounded mb-2"}),t.jsx("label",{className:"block text-sm mb-1",children:"Bind to list item property"}),t.jsx("input",{value:a.boundListItemProperty??"",onChange:l=>s("boundListItemProperty",l.target.value),placeholder:"e.g. title (when inside list row)",className:"w-full p-2 border rounded",title:"When inside a list row, show this property of each array item as button title"}),t.jsx("p",{className:"text-xs text-gray-500 mt-0.5 mb-2",children:"Optional. When inside a list row, use this key from the array item."})]}),a.type==="Image"&&t.jsxs(t.Fragment,{children:[t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mb-2",children:[t.jsx("input",{type:"checkbox",checked:a.useAsset===!0,onChange:l=>s("useAsset",l.target.checked),className:"w-4 h-4 rounded border-gray-300 shrink-0"}),t.jsx("span",{className:"text-sm font-medium",children:"Pick from asset"})]}),a.useAsset?t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"block text-sm mb-1",children:"Bundle name"}),t.jsx("input",{type:"text",placeholder:"Main (leave empty for main bundle)",value:O(a,"assetBundleName","Image")??"",onChange:l=>s("assetBundleName",l.target.value),className:"w-full p-2 border rounded mb-2"}),t.jsx("label",{className:"block text-sm mb-1",children:"Image name"}),t.jsx("input",{type:"text",placeholder:"e.g. my_icon",value:O(a,"assetImageName","Image")??"",onChange:l=>s("assetImageName",l.target.value),className:"w-full p-2 border rounded mb-2"})]}):t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"block text-sm mb-1",children:"Image URL"}),t.jsx("input",{type:"url",placeholder:"https://...",value:O(a,"src","Image")??"",onChange:l=>s("src",l.target.value),className:"w-full p-2 border rounded mb-2"})]}),t.jsx("label",{className:"block text-sm mb-1",children:"Alt text"}),t.jsx("input",{value:O(a,"alt","Image")??"Image",onChange:l=>s("alt",l.target.value),placeholder:"Description for accessibility",className:"w-full p-2 border rounded mb-2"}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mb-2",children:[t.jsx("input",{type:"checkbox",checked:a.showLoadingIndicator===!0,onChange:l=>s("showLoadingIndicator",l.target.checked),className:"w-4 h-4 rounded border-gray-300 shrink-0"}),t.jsx("span",{className:"text-sm font-medium",children:"Show loading indicator (ProgressView while image loads)"})]}),t.jsx("label",{className:"block text-sm mb-1",children:"Content mode"}),t.jsxs("select",{value:O(a,"contentMode","Image")??"contain",onChange:l=>s("contentMode",l.target.value),className:"w-full p-2 border rounded mb-2",children:[t.jsx("option",{value:"contain",children:"Scale to Fit"}),t.jsx("option",{value:"cover",children:"Scale to Fill"}),t.jsx("option",{value:"fill",children:"Fill"}),t.jsx("option",{value:"none",children:"None"}),t.jsx("option",{value:"scale-down",children:"Scale Down"})]}),t.jsx("label",{className:"block text-sm mb-1",children:"Bind to list item property"}),t.jsx("input",{value:a.boundListItemProperty??"",onChange:l=>s("boundListItemProperty",l.target.value),placeholder:"e.g. imageUrl (when inside list row)",className:"w-full p-2 border rounded",title:"When inside a list row, use this property of each array item as image URL"}),t.jsx("p",{className:"text-xs text-gray-500 mt-0.5 mb-2",children:"Optional. When inside a list row, use this key as the image URL."})]}),a.type==="List"&&t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"block text-sm mb-1",children:"List items (one per line)"}),t.jsx("textarea",{value:Array.isArray(a.items)?a.items.join(`
`):a.items!=null?String(a.items):"",onChange:l=>s("items",l.target.value.split(`
`).map(h=>h.trim()).filter(Boolean)),rows:4,placeholder:`Item 1
Item 2
Item 3`,className:"w-full p-2 border rounded font-mono text-sm mb-2"}),t.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:["Default rows above. To drive the list from JSON, bind this List’s ",t.jsx("strong",{children:"Items"})," to a data model path in ",t.jsx("strong",{children:"Data Mapping"}),"."]}),t.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Add one child (e.g. a Table cell) as the row template; put Item text, Text, Button, or Image inside and optionally bind to list item properties."}),t.jsxs("label",{className:"flex items-center gap-2 mb-3",children:[t.jsx("input",{type:"checkbox",checked:a.sectionGroupingEnabled===!0,onChange:l=>s("sectionGroupingEnabled",l.target.checked)}),t.jsx("span",{className:"text-sm font-medium",children:"Section grouping (Swift)"})]}),t.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"When on, list renders with section/grouped style in Swift. Off = plain list (default)."}),t.jsx("label",{className:"block text-sm mb-1",children:"Spacing between rows (px)"}),t.jsx("input",{type:"number",min:0,value:a.listRowSpacing!=null?a.listRowSpacing:0,onChange:l=>s("listRowSpacing",Math.max(0,Number(l.target.value))),className:"w-full p-1.5 border rounded text-sm mb-2",title:"Gap between list rows / table cells"}),t.jsx("label",{className:"block text-sm mb-1",children:"Space above first row (px)"}),t.jsx("input",{type:"number",min:0,value:a.listSpacingAboveFirst!=null?a.listSpacingAboveFirst:0,onChange:l=>s("listSpacingAboveFirst",Math.max(0,Number(l.target.value))),className:"w-full p-1.5 border rounded text-sm mb-2",title:"Space above the first list cell"}),t.jsx("label",{className:"block text-sm mb-1",children:"Space below last row (px)"}),t.jsx("input",{type:"number",min:0,value:a.listSpacingBelowLast!=null?a.listSpacingBelowLast:0,onChange:l=>s("listSpacingBelowLast",Math.max(0,Number(l.target.value))),className:"w-full p-1.5 border rounded text-sm mb-3",title:"Space below the last list cell"}),t.jsxs("div",{className:"border-t border-gray-200 pt-3 mt-2",children:[t.jsxs("label",{className:"flex items-center gap-2 mb-2",children:[t.jsx("input",{type:"checkbox",checked:a.loadMoreEnabled===!0,onChange:l=>s("loadMoreEnabled",l.target.checked)}),t.jsx("span",{className:"text-sm font-medium",children:"Load more"})]}),t.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:["Show a footer to load next page. Set page param in ",t.jsx("strong",{children:"Data Mapping → API & Load more"}),"."]}),t.jsx("label",{className:"block text-xs text-gray-500 mb-0.5",children:"Footer button label"}),t.jsx("input",{type:"text",value:a.loadMoreFooterLabel??"Load more",onChange:l=>s("loadMoreFooterLabel",l.target.value),className:"w-full p-1.5 border rounded text-sm mb-2"}),t.jsx("label",{className:"block text-xs text-gray-500 mb-0.5",children:"Loading label"}),t.jsx("input",{type:"text",value:a.loadMoreLoadingLabel??"Loading...",onChange:l=>s("loadMoreLoadingLabel",l.target.value),className:"w-full p-1.5 border rounded text-sm"})]})]}),a.type==="ListItemContent"&&t.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Displays the current list item when used inside a List row template. Style controls the text appearance."}),a.type==="TextField"&&t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"block text-sm mb-1",children:"Placeholder"}),t.jsx("input",{value:O(a,"placeholder","TextField")??"",onChange:l=>s("placeholder",l.target.value),className:"w-full p-2 border rounded mb-2"}),t.jsx("label",{className:"block text-sm mb-1",children:"Default text"}),t.jsx("input",{value:O(a,"text","TextField")??"",onChange:l=>s("text",l.target.value),className:"w-full p-2 border rounded"})]}),a.type==="Toggle"&&t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"block text-sm mb-1",children:"Label"}),t.jsx("input",{value:O(a,"label","Toggle")??"Toggle",onChange:l=>s("label",l.target.value),className:"w-full p-2 border rounded mb-2"}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:O(a,"isOn","Toggle")===!0,onChange:l=>s("isOn",l.target.checked),className:"w-4 h-4 rounded border-gray-300"}),t.jsx("span",{className:"text-sm",children:"On by default"})]})]}),a.type==="Slider"&&t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"block text-sm mb-1",children:"Value"}),t.jsx("input",{type:"number",value:O(a,"value","Slider")??50,onChange:l=>s("value",Number(l.target.value)),className:"w-full p-2 border rounded mb-2"}),t.jsx("label",{className:"block text-sm mb-1",children:"Min"}),t.jsx("input",{type:"number",value:O(a,"min","Slider")??0,onChange:l=>s("min",Number(l.target.value)),className:"w-full p-2 border rounded mb-2"}),t.jsx("label",{className:"block text-sm mb-1",children:"Max"}),t.jsx("input",{type:"number",value:O(a,"max","Slider")??100,onChange:l=>s("max",Number(l.target.value)),className:"w-full p-2 border rounded"})]}),a.type==="Picker"&&t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"block text-sm mb-1",children:"Selection"}),t.jsx("input",{value:O(a,"selection","Picker")??"",onChange:l=>s("selection",l.target.value),placeholder:"Selected value",className:"w-full p-2 border rounded mb-2"}),t.jsx("label",{className:"block text-sm mb-1",children:"Options (one per line)"}),t.jsx("textarea",{value:Array.isArray(a.options)?a.options.join(`
`):a.options!=null?String(a.options):`Option 1
Option 2
Option 3`,onChange:l=>s("options",l.target.value.split(`
`).map(h=>h.trim()).filter(Boolean)),rows:4,placeholder:`Option 1
Option 2`,className:"w-full p-2 border rounded font-mono text-sm"})]}),a.type==="ProgressView"&&t.jsxs(t.Fragment,{children:[t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mb-2",children:[t.jsx("input",{type:"checkbox",checked:O(a,"indeterminate","ProgressView")===!0,onChange:l=>s("indeterminate",l.target.checked),className:"w-4 h-4 rounded border-gray-300"}),t.jsx("span",{className:"text-sm",children:"Indeterminate (spinner)"})]}),!O(a,"indeterminate","ProgressView")&&t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"block text-sm mb-1",children:"Progress (0–1)"}),t.jsx("input",{type:"number",min:0,max:1,step:.1,value:O(a,"progress","ProgressView")??.5,onChange:l=>s("progress",Math.max(0,Math.min(1,Number(l.target.value)))),className:"w-full p-2 border rounded"})]})]}),a.type==="Divider"&&t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"block text-sm mb-1",children:"Axis"}),t.jsxs("select",{value:O(a,"axis","Divider")??"horizontal",onChange:l=>s("axis",l.target.value),className:"w-full p-2 border rounded",children:[t.jsx("option",{value:"horizontal",children:"Horizontal"}),t.jsx("option",{value:"vertical",children:"Vertical"})]})]}),a.type==="Spacer"&&t.jsx("p",{className:"text-sm text-gray-500",children:"Expands to fill available space in a VStack or HStack. No properties to edit."}),a.type==="Link"&&t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"block text-sm mb-1",children:"URL"}),t.jsx("input",{type:"url",value:O(a,"url","Link")??"",onChange:l=>s("url",l.target.value),placeholder:"https://...",className:"w-full p-2 border rounded mb-2"}),t.jsx("label",{className:"block text-sm mb-1",children:"Label"}),t.jsx("input",{value:O(a,"label","Link")??"Link",onChange:l=>s("label",l.target.value),className:"w-full p-2 border rounded"})]}),a.type===je&&t.jsx(dn,{selected:a,update:s}),a.type==="SecureField"&&t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"block text-sm mb-1",children:"Placeholder"}),t.jsx("input",{value:O(a,"placeholder","SecureField")??"Password",onChange:l=>s("placeholder",l.target.value),className:"w-full p-2 border rounded mb-2"}),t.jsx("label",{className:"block text-sm mb-1",children:"Default text"}),t.jsx("input",{type:"password",value:O(a,"text","SecureField")??"",onChange:l=>s("text",l.target.value),className:"w-full p-2 border rounded"})]}),!m&&(a.type==="View"||a.type==="VStack"||a.type==="HStack"||a.type==="ZStack")&&t.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[(a.children||[]).length," item(s) inside. Add more from the left panel."]}),!m&&a.type==="List"&&t.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[(a.children||[]).length," row template(s). Add a ",t.jsx("strong",{children:"Table cell"})," first, then add controls inside it (Item text, Text, Button, etc.)."]}),!m&&a.type==="ListItemContent"&&t.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[(a.children||[]).length," control(s) in this cell. Add ",t.jsx("strong",{children:"Item text"}),", Text, Button, Image, etc. from the left panel."]}),!m&&a.type==="ListItemText"&&t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Displays the current row’s item. Use inside a Table cell."}),t.jsx("label",{className:"block text-sm mb-1",children:"Item property"}),t.jsx("input",{value:a.itemProperty??"",onChange:l=>s("itemProperty",l.target.value),placeholder:"e.g. name, title, text",className:"w-full p-2 border rounded mb-2",title:"Key on each array item to display (leave empty for text/title/label or string)"}),t.jsx("p",{className:"text-xs text-gray-500 -mt-1",children:"Key from the list array item to show. Empty = auto (text/title/label or string)."})]})]}),t.jsx(Pe,{}),t.jsxs(Me,{title:"Layout",children:[a.id==="root"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"block text-sm mb-1",children:"Screen ID"}),t.jsx("input",{value:a.screenId??"",onChange:l=>s("screenId",l.target.value),placeholder:"e.g. reward_home",className:"w-full p-2 border rounded text-sm bg-white",title:"Identifies this screen for actions and formatting (single VC uses this to route)"}),t.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Used by runtime to route actions and formatters."})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"block text-sm mb-1",children:"Screen presentation"}),t.jsxs("select",{value:O(a,"presentationStyle","View")??"push",onChange:l=>s("presentationStyle",l.target.value),className:"w-full p-2 border rounded text-sm bg-white",title:"How this screen is presented when navigated to: push (nav stack), present (fullScreenCover), or modal (sheet)",children:[t.jsx("option",{value:"push",children:"Push (navigation stack)"}),t.jsx("option",{value:"present",children:"Present (full screen)"}),t.jsx("option",{value:"modal",children:"Modal (sheet)"})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Push, present, or modal when opening this screen."})]})]}),(a.id==="root"||zn(e,a))&&t.jsxs("div",{className:"mt-2 mb-2",children:[t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:(a.id==="root"?a.fitToScreen:e&&e.fitToScreen)===!0,onChange:l=>{const h=l.target.checked;a.id==="root"?s("fitToScreen",h):e&&r({...e,id:"root",fitToScreen:h})},className:"w-4 h-4 rounded border-gray-300"}),t.jsx("span",{className:"text-sm font-medium",children:"Fit to screen"})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-0.5 ml-6",children:"Root view fills the device frame (Mobile/Web)."})]}),(a.type==="VStack"||a.type==="HStack")&&t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"block text-sm mb-1",children:"Alignment"}),t.jsx("select",{value:O(a,"alignment",a.type)??"center",onChange:l=>s("alignment",l.target.value),className:"w-full p-2 border rounded mb-2",children:a.type==="VStack"?t.jsxs(t.Fragment,{children:[t.jsx("option",{value:"start",children:"Leading"}),t.jsx("option",{value:"center",children:"Center"}),t.jsx("option",{value:"end",children:"Trailing"})]}):t.jsxs(t.Fragment,{children:[t.jsx("option",{value:"start",children:"Top"}),t.jsx("option",{value:"center",children:"Center"}),t.jsx("option",{value:"end",children:"Bottom"})]})}),t.jsx("label",{className:"block text-sm mb-1",children:"Spacing between items (px)"}),t.jsx("input",{type:"number",min:0,value:O(a,"spacing",a.type)??12,onChange:l=>s("spacing",Math.max(0,Number(l.target.value))),className:"w-full p-2 border rounded",title:"Gap between child controls"})]}),a.type==="ZStack"&&t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"block text-sm mb-1",children:"Alignment"}),t.jsxs("select",{value:O(a,"alignment","ZStack")??"center",onChange:l=>s("alignment",l.target.value),className:"w-full p-2 border rounded mb-2",children:[t.jsx("option",{value:"start",children:"Leading (top-left)"}),t.jsx("option",{value:"center",children:"Center"}),t.jsx("option",{value:"end",children:"Trailing (bottom-right)"})]})]}),a.id!=="root"&&t.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-300",children:[t.jsx("h4",{className:"font-semibold text-sm mb-1",children:"Spacing from other controls"}),t.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Margin (space outside this control). Use negative to overlap."}),t.jsx("label",{className:"block text-sm mb-1",children:"Top (px)"}),t.jsx("input",{type:"number",value:O(a,"marginTop",a.type)??0,onChange:l=>s("marginTop",Number(l.target.value)),className:"w-full p-2 border rounded mb-2"}),t.jsx("label",{className:"block text-sm mb-1",children:"Bottom (px)"}),t.jsx("input",{type:"number",value:O(a,"marginBottom",a.type)??0,onChange:l=>s("marginBottom",Number(l.target.value)),className:"w-full p-2 border rounded mb-2"}),t.jsx("label",{className:"block text-sm mb-1",children:"Left (px)"}),t.jsx("input",{type:"number",value:O(a,"marginLeft",a.type)??0,onChange:l=>s("marginLeft",Number(l.target.value)),className:"w-full p-2 border rounded mb-2"}),t.jsx("label",{className:"block text-sm mb-1",children:"Right (px)"}),t.jsx("input",{type:"number",value:O(a,"marginRight",a.type)??0,onChange:l=>s("marginRight",Number(l.target.value)),className:"w-full p-2 border rounded"})]}),a.id!=="root"&&t.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-300",children:[t.jsx("h4",{className:"font-semibold text-sm mb-1",children:"Inset from parent (px)"}),t.jsx("p",{className:"text-xs text-gray-500 mb-2",children:`Distance from parent's edges. Use with Auto Resize for "fill with padding".`}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-500 mb-0.5",children:"Top"}),t.jsx("input",{type:"number",min:0,value:O(a,"insetFromParentTop",a.type)??0,onChange:l=>s("insetFromParentTop",Number(l.target.value)),className:"w-full p-2 border rounded text-sm"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-500 mb-0.5",children:"Bottom"}),t.jsx("input",{type:"number",min:0,value:O(a,"insetFromParentBottom",a.type)??0,onChange:l=>s("insetFromParentBottom",Number(l.target.value)),className:"w-full p-2 border rounded text-sm"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-500 mb-0.5",children:"Left"}),t.jsx("input",{type:"number",min:0,value:O(a,"insetFromParentLeft",a.type)??0,onChange:l=>s("insetFromParentLeft",Number(l.target.value)),className:"w-full p-2 border rounded text-sm"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-500 mb-0.5",children:"Right"}),t.jsx("input",{type:"number",min:0,value:O(a,"insetFromParentRight",a.type)??0,onChange:l=>s("insetFromParentRight",Number(l.target.value)),className:"w-full p-2 border rounded text-sm"})]})]})]}),!m&&t.jsxs("div",{className:"mt-3",children:[t.jsx("label",{className:"block text-sm mb-1",children:"Padding horizontal (px)"}),t.jsx("input",{type:"number",value:O(a,"paddingHorizontal",a.type)??0,onChange:l=>s("paddingHorizontal",Number(l.target.value)),className:"w-full p-2 border rounded mb-2"}),t.jsx("label",{className:"block text-sm mb-1",children:"Padding vertical (px)"}),t.jsx("input",{type:"number",value:O(a,"paddingVertical",a.type)??0,onChange:l=>s("paddingVertical",Number(l.target.value)),className:"w-full p-2 border rounded mb-2"}),t.jsx("label",{className:"block text-sm mb-1",children:"Padding top (px)"}),t.jsx("input",{type:"number",value:O(a,"paddingTop",a.type)??0,onChange:l=>s("paddingTop",Number(l.target.value)),className:"w-full p-2 border rounded mb-2"}),t.jsx("label",{className:"block text-sm mb-1",children:"Padding bottom (px)"}),t.jsx("input",{type:"number",value:O(a,"paddingBottom",a.type)??0,onChange:l=>s("paddingBottom",Number(l.target.value)),className:"w-full p-2 border rounded"})]}),a.id!=="root"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-300",children:[t.jsx("h4",{className:"font-semibold text-sm mb-1",children:"Layout"}),t.jsx("label",{className:"block text-sm mb-1",children:"Mode"}),t.jsxs("select",{value:Le(a),onChange:l=>{const h=l.target.value;r({...a,id:a.id!=null?String(a.id):void 0,layoutMode:h,autoResize:h==="autoResize"})},className:"w-full p-2 border rounded mb-1",children:[t.jsx("option",{value:"autoLayout",children:"Auto Layout"}),t.jsx("option",{value:"autoResize",children:"Auto Resize"}),t.jsx("option",{value:"freeForm",children:"Free Form"})]}),t.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:[Le(a)==="autoLayout"&&"Flow in parent; size by content or set width/height.",Le(a)==="autoResize"&&"Fill parent edge-to-edge; size updates automatically.",Le(a)==="freeForm"&&"Fixed position (x, y) and size; place anywhere in parent."]})]}),Le(a)==="freeForm"&&t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"block text-sm mb-1",children:"X (px)"}),t.jsx("input",{type:"number",value:a.x??0,onChange:l=>s("x",Number(l.target.value)),className:"w-full p-2 border rounded mb-2"}),t.jsx("label",{className:"block text-sm mb-1",children:"Y (px)"}),t.jsx("input",{type:"number",value:a.y??0,onChange:l=>s("y",Number(l.target.value)),className:"w-full p-2 border rounded mb-2"})]}),t.jsx("label",{className:"block text-sm mb-1",children:"Width (px)"}),t.jsx("input",{type:"number",min:Le(a)==="freeForm"?1:40,placeholder:"auto",value:a.width??"",onChange:l=>s("width",l.target.value===""?void 0:Number(l.target.value)),className:"w-full p-2 border rounded mb-2",readOnly:Le(a)==="autoResize",title:Le(a)==="autoResize"?"Driven by parent when Auto Resize is on":void 0}),t.jsx("label",{className:"block text-sm mb-1",children:"Height (px)"}),t.jsx("input",{type:"number",min:Le(a)==="freeForm"?1:24,placeholder:"auto",value:a.height??"",onChange:l=>s("height",l.target.value===""?void 0:Number(l.target.value)),className:"w-full p-2 border rounded",readOnly:Le(a)==="autoResize",title:Le(a)==="autoResize"?"Driven by parent when Auto Resize is on":void 0})]})]}),t.jsx(Pe,{}),!m&&u.length>0&&t.jsx(Me,{title:"Style",children:u.map(l=>t.jsx(Hn,{def:l,value:O(a,l.key,a.type)??l.default,storedValue:a[l.key],onChange:h=>s(l.key,h)},l.key))}),t.jsx(Pe,{}),!m&&t.jsxs(Me,{title:"Localization",children:[t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mb-2",children:[t.jsx("input",{type:"checkbox",checked:a.localizationEnabled===!0,onChange:l=>s("localizationEnabled",l.target.checked),className:"w-4 h-4 rounded border-gray-300"}),t.jsx("span",{className:"text-sm font-medium",children:"Localization on"})]}),a.localizationEnabled&&t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"block text-sm mb-1",children:"Key"}),t.jsx("input",{value:a.localizationKey??"",onChange:l=>s("localizationKey",l.target.value),placeholder:"e.g. welcome.title",className:"w-full p-2 border rounded text-sm mb-2"}),t.jsx("label",{className:"block text-sm mb-1",children:"Default value"}),t.jsx("input",{value:a.localizationDefaultValue??"",onChange:l=>s("localizationDefaultValue",l.target.value),placeholder:"Fallback text",className:"w-full p-2 border rounded text-sm"})]})]}),t.jsx(Pe,{}),!m&&t.jsxs(Me,{title:"Accessibility",children:[t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mb-2",children:[t.jsx("input",{type:"checkbox",checked:a.accessibilityEnabled===!0,onChange:l=>s("accessibilityEnabled",l.target.checked),className:"w-4 h-4 rounded border-gray-300"}),t.jsx("span",{className:"text-sm font-medium",children:"Accessibility on"})]}),a.accessibilityEnabled&&t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"block text-sm mb-1",children:"Accessibility ID"}),t.jsx("input",{value:a.accessibilityIdentifier??"",onChange:l=>s("accessibilityIdentifier",l.target.value),placeholder:"e.g. submitButton",className:"w-full p-2 border rounded text-sm mb-2"}),t.jsx("label",{className:"block text-sm mb-1",children:"Value (label)"}),t.jsx("input",{value:a.accessibilityLabel??"",onChange:l=>s("accessibilityLabel",l.target.value),placeholder:"VoiceOver / automation label",className:"w-full p-2 border rounded text-sm"})]})]}),t.jsx(Pe,{}),!m&&t.jsxs(Me,{title:"Action",children:[t.jsx(mn,{tree:e,selected:a,update:s}),t.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:["When the user taps this control, the host app receives an action. You can send a value from your API (e.g. deeplink URL) by picking a ",t.jsx("strong",{children:"separate"})," data field below — use one that holds the action value, not the field used for the control's title or text."]}),t.jsx("label",{className:"block text-sm mb-1",children:"Control ID"}),t.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Stable id so the host app knows which control was tapped (e.g. submit_btn, back_btn)."}),t.jsx("input",{value:a.actionId??"",onChange:l=>s("actionId",l.target.value),placeholder:"e.g. submit_btn",className:"w-full p-2 border rounded text-sm mb-2 bg-white"}),t.jsx("label",{className:"block text-sm mb-1",children:"Event name"}),t.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Custom event the host app can switch on for logic (e.g. form.submit, open_rewards)."}),t.jsx("input",{value:a.actionEvent??"",onChange:l=>s("actionEvent",l.target.value),placeholder:"e.g. form.submit",className:"w-full p-2 border rounded text-sm mb-2 bg-white"}),t.jsx("label",{className:"block text-sm mb-1",children:"Action value from (API / data)"}),t.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:["Data field whose ",t.jsx("strong",{children:"value"}),` is sent as the action value (e.g. deeplink URL). In Data Mapping, create a field for this (e.g. "Deeplink") and bind it from the API — do not use the same field as the control's title.`]}),t.jsxs("select",{value:a.actionBoundDataModelId??"",onChange:l=>s("actionBoundDataModelId",l.target.value),className:"w-full p-2 border rounded text-sm mb-2 bg-white",children:[t.jsx("option",{value:"",children:"None"}),(n||[]).filter(Boolean).map(l=>t.jsx("option",{value:l.id??"",children:l.name??l.id??""},l.id??""))]}),(()=>{const l=Ot(e,a?.id);return l.length>0&&l.slice(0,-1).includes("List")?t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"block text-sm mb-1",children:"List row key (overrides above)"}),t.jsx("input",{value:a.actionBoundProperty??"",onChange:N=>s("actionBoundProperty",N.target.value),placeholder:"e.g. deeplink",className:"w-full p-2 border rounded text-sm bg-white",title:"Property on each list item that holds the action value (e.g. deeplink)"})]}):null})()]}),t.jsx(Pe,{}),!m&&t.jsxs(Me,{title:"Gestures",children:[t.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Add tap or long press; runtime will fire the action handler."}),(a.gestures||[]).map((l,h)=>t.jsxs("div",{className:"flex items-center gap-2 mb-2 p-2 border border-gray-200 rounded bg-white",children:[t.jsxs("select",{value:l.type??"tap",onChange:N=>{const v=[...a.gestures||[]];v[h]={...v[h],type:N.target.value},N.target.value==="longPress"&&v[h].minDuration==null&&(v[h].minDuration=.5),s("gestures",v)},className:"flex-1 p-1.5 border rounded text-sm",children:[t.jsx("option",{value:"tap",children:"Tap"}),t.jsx("option",{value:"longPress",children:"Long press"})]}),(l.type==="longPress"||(a.gestures||[])[h]&&(a.gestures||[])[h].type==="longPress")&&t.jsx("input",{type:"number",min:.1,step:.1,value:(a.gestures||[])[h]&&(a.gestures||[])[h].minDuration!=null?(a.gestures||[])[h].minDuration:.5,onChange:N=>{const v=[...a.gestures||[]];v[h]={...v[h],minDuration:Number(N.target.value)||.5},s("gestures",v)},className:"w-16 p-1.5 border rounded text-sm",title:"Min duration (seconds)"}),t.jsx("button",{type:"button",onClick:()=>s("gestures",(a.gestures||[]).filter((N,v)=>v!==h)),className:"text-red-600 text-sm shrink-0",children:"Remove"})]},h)),t.jsx("button",{type:"button",onClick:()=>s("gestures",[...a.gestures||[],{type:"tap"}]),className:"text-sm text-blue-600 hover:underline",children:"+ Add gesture"})]}),t.jsx(Pe,{}),!m&&t.jsxs(Me,{title:"Display format",children:[t.jsx("label",{className:"block text-sm mb-1",children:"Format type"}),t.jsxs("select",{value:a.displayFormat&&a.displayFormat.type||"none",onChange:l=>{const h=l.target.value;h==="none"?s("displayFormat",null):s("displayFormat",{...a.displayFormat||{},type:h})},className:"w-full p-2 border rounded text-sm mb-2 bg-white",children:[t.jsx("option",{value:"none",children:"None"}),t.jsx("option",{value:"date",children:"Date"}),t.jsx("option",{value:"number",children:"Number"}),t.jsx("option",{value:"currency",children:"Currency"}),t.jsx("option",{value:"custom",children:"Custom (formatter ID)"})]}),a.displayFormat&&a.displayFormat.type!=="none"&&t.jsxs(t.Fragment,{children:[(a.displayFormat.type==="date"||a.displayFormat.type==="number"||a.displayFormat.type==="currency")&&t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"block text-sm mb-1",children:"Pattern"}),t.jsx("input",{value:a.displayFormat.pattern??"",onChange:l=>s("displayFormat",{...a.displayFormat,pattern:l.target.value}),placeholder:a.displayFormat.type==="date"?"MMM d, yyyy":"#,##0.00",className:"w-full p-2 border rounded text-sm mb-2 bg-white"}),t.jsx("label",{className:"block text-sm mb-1",children:"Locale"}),t.jsx("input",{value:a.displayFormat.locale??"",onChange:l=>s("displayFormat",{...a.displayFormat,locale:l.target.value}),placeholder:"e.g. en_IN",className:"w-full p-2 border rounded text-sm mb-2 bg-white"})]}),a.displayFormat.type==="custom"&&t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"block text-sm mb-1",children:"Formatter ID"}),t.jsx("input",{value:a.displayFormat.formatterId??"",onChange:l=>s("displayFormat",{...a.displayFormat,formatterId:l.target.value}),placeholder:"e.g. currencyINR",className:"w-full p-2 border rounded text-sm bg-white",title:"Host app registers formatter by this id"})]})]})]}),t.jsx(Pe,{}),!m&&t.jsxs(Me,{title:"Behavior",children:[t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mb-2",children:[t.jsx("input",{type:"checkbox",checked:a.isUserInteractionEnabled!==!1,onChange:l=>s("isUserInteractionEnabled",l.target.checked),className:"w-4 h-4 rounded border-gray-300"}),t.jsx("span",{className:"text-sm font-medium",children:"User interaction enabled"})]}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mb-2",children:[t.jsx("input",{type:"checkbox",checked:a.isHidden===!0,onChange:l=>s("isHidden",l.target.checked),className:"w-4 h-4 rounded border-gray-300"}),t.jsx("span",{className:"text-sm font-medium",children:"Hidden"})]}),t.jsx("label",{className:"block text-sm mb-1",children:"Automation ID"}),t.jsx("input",{value:a.automationIdentifier??"",onChange:l=>s("automationIdentifier",l.target.value),placeholder:"e.g. submit_button",className:"w-full p-2 border rounded text-sm",title:"Semantic / automation ID (can differ from accessibility ID)"})]}),t.jsx(Pe,{}),a.id!=="root"&&t.jsx("button",{onClick:()=>i(a.id),className:"mt-2 w-full bg-red-500 text-white py-2 rounded",children:"Delete Component"})]})}function Vn(e){return e&&ua.includes(e)}function ba({node:e,selectedId:a,onSelect:n,onMove:r,depth:i=0,parentId:c=null,index:o=0,siblingCount:s=1}){if(!e)return null;const[u,m]=p.useState(!1),l=(e.id!=null?String(e.id):null)===a,h=e.children||[],N=h.length>0,v=pa(e),P=`${i*12+8}px`,M=c!=null&&o>0,J=c!=null&&o<s-1,V=Vn(e.type),D=L=>{L.stopPropagation(),r&&M&&r(e.id,c,o-1)},I=L=>{L.stopPropagation(),r&&J&&r(e.id,c,o+1)},y=L=>{L.stopPropagation(),L.dataTransfer.setData(Ue,e.id),L.dataTransfer.effectAllowed="move"},C=L=>{L.preventDefault(),L.stopPropagation(),L.dataTransfer.dropEffect="move",m(!0)},te=L=>{L.preventDefault(),L.stopPropagation(),m(!1)},W=L=>{L.preventDefault(),L.stopPropagation(),m(!1);const X=L.dataTransfer.getData(Ue);!X||!r||X!==e.id&&(V?r(X,e.id,h.length):r(X,c,o))};return t.jsxs("div",{className:"select-none",children:[t.jsxs("div",{className:`flex items-center gap-0.5 rounded border-l-2 ${l?"bg-blue-100 border-blue-500":"border-transparent"} ${u?"ring-1 ring-blue-400 bg-blue-50":""} ${e.id!=="root"?"cursor-grab active:cursor-grabbing":""}`,style:{paddingLeft:P},draggable:e.id!=="root",onDragStart:e.id!=="root"?y:void 0,onDragOver:C,onDragLeave:te,onDrop:W,title:V?"Drag to reorder; drop here to add as child":"Drag to reorder",children:[t.jsxs("button",{type:"button",onClick:()=>n(e),className:`flex-1 min-w-0 text-left py-1.5 px-2 rounded text-sm truncate flex items-center gap-1.5 ${l?"text-blue-900":"hover:bg-gray-100"} ${e.id!=="root"?"cursor-grab":""}`,title:e.type,children:[t.jsx("span",{className:"shrink-0 text-gray-400 text-xs",children:N?"▾":"◦"}),t.jsx("span",{className:"font-medium truncate",children:v}),e.id!=="root"&&t.jsxs("span",{className:"shrink-0 text-xs text-gray-400",children:["(",e.type,")"]})]}),c!=null&&t.jsxs("span",{className:"flex shrink-0 items-center gap-0.5 pr-1",children:[t.jsx("button",{type:"button",onClick:D,disabled:!M,title:"Move up",className:"p-1 rounded text-gray-500 hover:bg-gray-200 hover:text-gray-700 disabled:opacity-40 disabled:pointer-events-none","aria-label":"Move up",children:"▲"}),t.jsx("button",{type:"button",onClick:I,disabled:!J,title:"Move down",className:"p-1 rounded text-gray-500 hover:bg-gray-200 hover:text-gray-700 disabled:opacity-40 disabled:pointer-events-none","aria-label":"Move down",children:"▼"})]})]}),N&&t.jsx("div",{className:"border-l border-gray-200 ml-2",children:h.map((L,X)=>t.jsx(ba,{node:L,selectedId:a,onSelect:n,onMove:r,depth:i+1,parentId:e.id,index:X,siblingCount:h.length},L.id))})]})}function Jn({tree:e,selectedId:a,onSelect:n,onMove:r}){const[i,c]=p.useState(!1);if(!e)return t.jsx("div",{className:"p-4 text-sm text-gray-500",children:"No tree"});const o=e.children||[],s=(a!=null?String(a):null)==="root",u=h=>{h.preventDefault(),h.stopPropagation(),h.dataTransfer.dropEffect="move",c(!0)},m=h=>{h.preventDefault(),h.stopPropagation(),c(!1)},l=h=>{h.preventDefault(),h.stopPropagation(),c(!1);const N=h.dataTransfer.getData(Ue);!N||!r||r(N,"root",o.length)};return t.jsxs("div",{className:"p-2 overflow-y-auto",children:[t.jsx("div",{className:`flex items-center gap-0.5 rounded border-l-2 py-1.5 px-2 text-sm ${s?"bg-blue-100 border-blue-500":"border-transparent hover:bg-gray-50"} ${i?"ring-1 ring-blue-400 bg-blue-50":""}`,style:{paddingLeft:"8px"},onDragOver:u,onDragLeave:m,onDrop:l,title:"Drop here to add as top-level",children:t.jsxs("button",{type:"button",onClick:()=>n(e),className:"flex-1 min-w-0 text-left truncate flex items-center gap-1.5 text-gray-600",title:"Canvas / screen settings (e.g. Fit to screen)",children:[t.jsx("span",{className:"shrink-0 text-gray-400 text-xs",children:"◇"}),t.jsx("span",{className:"font-medium truncate",children:"Canvas"})]})}),o.length===0?t.jsx("div",{className:"p-2 pl-6 text-xs text-gray-500",children:"Drop components here or add from the left."}):t.jsx("div",{className:"border-l border-gray-200 ml-2",children:o.map((h,N)=>t.jsx(ba,{node:h,selectedId:a,onSelect:n,onMove:r,depth:0,parentId:e.id,index:N,siblingCount:o.length},h.id))})]})}const Kt=390+12*2,Qt=844+10*2;function Un(e,a){const n=a?.id!=null?String(a.id):null;if(!n||!e)return e;const r=ze(e,n);if(!r)return e;const i={...r,...a,id:n};a.children===void 0&&r.children&&(i.children=r.children);const c=o=>o.id!=null&&String(o.id)===n?{...i}:{...o,children:(o.children||[]).map(c)};return c(e)}const it=390,fa=844,Nt=44,ya=48,Na=32,jt=it,vt=fa-ya-Na;function $n({tree:e,dataModel:a,onClose:n}){const[r,i]=p.useState(e),[c,o]=p.useState(null),[s,u]=p.useState(null),[m,l]=p.useState({}),[h,N]=p.useState(1),v=p.useRef(null);p.useEffect(()=>{i(e)},[e]),p.useEffect(()=>{const I=v.current;if(!I)return;const y=()=>{const te=I.clientWidth,W=I.clientHeight,L=Math.min(te/Kt,W/Qt,1);N(L)};y();const C=new ResizeObserver(y);return C.observe(I),()=>C.disconnect()},[]),p.useEffect(()=>{if(!c)return;const I=setTimeout(()=>o(null),2e3);return()=>clearTimeout(I)},[c]);const P=I=>{I?.id!=null&&i(y=>Un(y,I))},M=I=>{const y=I?.title??I?.text??"Button";o(typeof y=="string"?y:"Tapped")},J=I=>{u(I)},V=I=>{l(y=>({...y,[I]:(y[I]||0)+1}))},D=s?ze(r,s):null;return e?t.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-black/40",onClick:n,children:t.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl flex flex-col max-h-[90vh] w-full max-w-4xl overflow-hidden",onClick:I=>I.stopPropagation(),children:[t.jsxs("div",{className:"shrink-0 flex items-center justify-between px-4 py-2 border-b border-gray-200 bg-gray-100",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Preview — iPhone"}),t.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 text-sm font-medium bg-gray-200 hover:bg-gray-300 rounded border border-gray-300",children:"Close"})]}),t.jsx("div",{ref:v,className:"flex-1 min-h-0 overflow-hidden p-4 bg-gray-50 flex items-center justify-center",children:t.jsx("div",{className:"flex-shrink-0 bg-black rounded-[3rem] p-[10px] shadow-2xl",style:{width:Kt,height:Qt,transform:`scale(${h})`,transformOrigin:"center center"},children:t.jsxs("div",{className:"relative bg-black overflow-hidden flex flex-col",style:{width:it,height:fa,borderRadius:Nt-4},children:[t.jsx("div",{className:"shrink-0 flex items-end justify-center pb-1 bg-white",style:{height:ya},children:t.jsx("div",{className:"w-24 h-6 rounded-full bg-black",title:"Dynamic Island"})}),t.jsx("div",{className:"shrink-0 overflow-hidden bg-white",style:{width:jt,height:vt},children:t.jsx("div",{className:`overflow-auto flex flex-col min-h-0 ${r.fitToScreen?"w-full h-full":""}`,style:r.fitToScreen?{width:"100%",height:"100%"}:{width:jt,height:vt,minWidth:jt,minHeight:vt},children:(r.children||[]).length===0?t.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400 text-sm",children:"Empty screen"}):(r.children||[]).map(I=>t.jsx(Ce,{node:I,dataModel:a,isPreview:!0,onUpdate:P,onPreviewAction:M,onPreviewOpenBottomSheet:J,previewListLoadMoreCounts:m,onPreviewLoadMore:V},I.id))})}),t.jsx("div",{className:"shrink-0 flex items-center justify-center bg-white",style:{height:Na},children:t.jsx("div",{className:"w-32 h-1 rounded-full bg-gray-300"})}),c&&t.jsxs("div",{className:"absolute bottom-16 left-1/2 -translate-x-1/2 px-3 py-1.5 rounded-lg bg-gray-900 text-white text-xs shadow-lg z-10",style:{maxWidth:it-32},children:["Tapped: ",c]}),D&&t.jsx("div",{className:"absolute inset-0 z-20 flex flex-col justify-end bg-black/40",style:{borderRadius:`0 0 ${Nt-4}px ${Nt-4}px`},onClick:()=>u(null),role:"presentation",children:t.jsxs("div",{className:"bg-white rounded-t-2xl shadow-2xl overflow-hidden flex flex-col",style:{maxHeight:"80%",width:it},onClick:I=>I.stopPropagation(),role:"dialog","aria-label":"Bottom sheet",children:[t.jsx("div",{className:"shrink-0 flex justify-center py-2 border-b border-gray-200",children:t.jsx("div",{className:"w-10 h-1 rounded-full bg-gray-300","aria-hidden":!0})}),t.jsx("div",{className:"flex-1 min-h-0 overflow-auto p-4",children:(D.children||[]).length===0?t.jsx("p",{className:"text-sm text-gray-500",children:"Empty sheet"}):(D.children||[]).map(I=>t.jsx(Ce,{node:I,dataModel:a,isPreview:!0,onUpdate:P,onPreviewAction:M,onPreviewOpenBottomSheet:J,previewListLoadMoreCounts:m,onPreviewLoadMore:V},I.id))})]})})]})})})]})}):t.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/40",onClick:n,children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 max-w-md w-full mx-4",onClick:I=>I.stopPropagation(),children:[t.jsx("p",{className:"text-gray-500 mb-4",children:"No content to preview"}),t.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded",children:"Close"})]})})}const Xt="data-node-id";function ja({value:e,pathPrefix:a="",expanded:n,onToggle:r,onSelectPath:i,depth:c=0}){if(e==null||typeof e!="object")return null;const o=Array.isArray(e)?e.map((s,u)=>[String(u),s]):Object.entries(e);return t.jsx("div",{className:"flex flex-col",children:o.map(([s,u])=>{const m=a?`${a}.${s}`:s,l=u!=null&&typeof u=="object",h=n.has(m),N=Array.isArray(u);return t.jsxs("div",{className:"flex flex-col",style:{marginLeft:c*10},children:[t.jsxs("div",{className:"flex items-center gap-0.5 py-0.5 px-1 rounded hover:bg-gray-100 cursor-pointer text-xs font-mono min-w-0",onClick:()=>{l?r(m):i(m)},children:[l?t.jsx("span",{className:"shrink-0 w-3 text-gray-500","aria-hidden":!0,children:h?"▼":"▶"}):t.jsx("span",{className:"shrink-0 w-3"}),t.jsx("span",{className:"text-amber-700 truncate",children:s}),l&&t.jsx("span",{className:"shrink-0 text-gray-400 ml-0.5",children:N?`[${u.length}]`:"{}"}),!l&&u!==null&&u!==void 0&&t.jsx("span",{className:"shrink-0 text-gray-500 truncate max-w-[100px]",title:String(u),children:typeof u=="string"?` "${String(u).slice(0,12)}${String(u).length>12?"…":""}"`:` ${String(u)}`})]}),l&&h&&t.jsx(ja,{value:u,pathPrefix:m,expanded:n,onToggle:r,onSelectPath:i,depth:c+1})]},m)})})}function qt(e){if(!e)return null;const a=e.closest&&e.closest(`[${Xt}]`);return a&&a.getAttribute(Xt)||null}function Wn({tree:e,selectedId:a,dataModel:n,onDataModelChange:r,mockApiJson:i,apiConfigMethod:c,onApiConfigMethodChange:o,apiUrl:s,onApiUrlChange:u,apiMethod:m,onApiMethodChange:l,loadMorePageParamName:h,onLoadMorePageParamNameChange:N,loadMorePageParamInQuery:v,onLoadMorePageParamInQueryChange:P,loadMoreHasNextPagePath:M,onLoadMoreHasNextPagePathChange:J,onUpdateNode:V,collapsed:D,onToggleCollapsed:I,onHighlightNode:y}){const[C,te]=p.useState(null),W=p.useRef(null),[L,X]=p.useState(!0),[Y,xe]=p.useState(!1),[fe,de]=p.useState(()=>new Set),[ae,oe]=p.useState("screen"),R=ia(e,a),f=ae==="sheet"&&R!=null,F=f?re(R).dataModel||[]:n||[],_=f?b=>{const B=re(R).dataModel||[],$=typeof b=="function"?b(B):b;V({id:R.id,sheetDataMapping:{...re(R),dataModel:$}})}:r,le=f?re(R).apiUrl:s,pe=f?b=>V({id:R.id,sheetDataMapping:{...re(R),apiUrl:b}}):u,x=f?re(R).apiMethod:m,k=f?b=>V({id:R.id,sheetDataMapping:{...re(R),apiMethod:b}}):l,H=f?re(R).loadMorePageParamName:h,U=f?b=>V({id:R.id,sheetDataMapping:{...re(R),loadMorePageParamName:b}}):N,ue=f?re(R).loadMorePageParamInQuery:v,ce=f?b=>V({id:R.id,sheetDataMapping:{...re(R),loadMorePageParamInQuery:b}}):P,he=f?re(R).loadMoreHasNextPagePath:M,q=f?b=>V({id:R.id,sheetDataMapping:{...re(R),loadMoreHasNextPagePath:b}}):J,me=f?re(R).mockApiJson:i;p.useEffect(()=>{if(!C)return;const b=B=>{te(E=>E?{...E,x:B.clientX,y:B.clientY}:null);const $=document.elementFromPoint(B.clientX,B.clientY),ge=qt($);ge&&ge!=="root"?y&&y(ge):y&&y(null)};return window.addEventListener("mousemove",b),()=>{window.removeEventListener("mousemove",b)}},[C!=null,y]),p.useEffect(()=>{const b=B=>{const $=W.current;if(!$)return;W.current=null,te(null),y&&y(null);const ge=document.elementFromPoint(B.clientX,B.clientY),E=qt(ge);if(E&&E!=="root"){let S=ze($.tree,E),ne=S&&xn[S.type],K=E;if(S&&!ne){let T=E,Q=Ye($.tree,T);for(;Q;){if(Q.type==="List"){S=Q,ne="items",K=Q.id;break}T=Q.id,Q=Ye($.tree,T)}}ne&&$.onDataModelChange(T=>{const Q=T||[];if(Q.some(Te=>Te.boundNodeId===K&&Te.boundProperty===ne)){const Te=S&&He(S.type)?He(S.type):S&&S.type!=null?S.type:"Control",ie={id:Se(),name:`Deeplink_${Te}_${String(K).slice(0,8)}`,value:"",boundNodeId:null,boundProperty:null};return[...Q,ie]}const Ae={id:Se(),name:`${S.type}_${ne}_${String(K).slice(0,8)}`,value:bn(S,ne),boundNodeId:K,boundProperty:ne};return[...Q.filter(Te=>Te.boundNodeId!==K),Ae]})}};return window.addEventListener("mouseup",b,!0),()=>window.removeEventListener("mouseup",b,!0)},[]),p.useEffect(()=>{C?W.current={...C,tree:e,onDataModelChange:_,onHighlightNode:y}:W.current=null},[C,e,_,y]);const ee=(b,B)=>{const $=(F||[]).map(E=>E.id===b?{...E,value:B}:E);_($);const ge=$.find(E=>E.id===b);ge&&ge.boundNodeId&&ge.boundProperty!=null&&V&&V({id:ge.boundNodeId,[ge.boundProperty]:B})},we=b=>{_((F||[]).filter(B=>B.id!==b))},Z=F||[];if(D)return t.jsx("div",{className:"w-10 shrink-0 h-full flex flex-col border-l border-gray-300 bg-gray-200",children:t.jsx("button",{type:"button",onClick:I,className:"flex-1 flex items-center justify-center text-gray-600 hover:bg-gray-300",title:"Open Data Mapping",children:"‹‹"})});const se=C&&typeof document<"u"&&Ya.createPortal(t.jsx("div",{className:"fixed inset-0 pointer-events-none z-[9999]","aria-hidden":!0,children:t.jsx("svg",{className:"absolute inset-0 w-full h-full",viewBox:`0 0 ${typeof window<"u"?window.innerWidth:800} ${typeof window<"u"?window.innerHeight:600}`,preserveAspectRatio:"none",children:t.jsx("line",{x1:C.startX,y1:C.startY,x2:C.x,y2:C.y,stroke:"#3b82f6",strokeWidth:2,strokeDasharray:"8 4"})})}),document.body);return t.jsxs(t.Fragment,{children:[se,t.jsxs("aside",{className:"w-80 shrink-0 h-full flex flex-col border-l border-gray-300 bg-gray-100 overflow-hidden",children:[t.jsxs("div",{className:"shrink-0 flex items-center justify-between border-b border-gray-300 bg-gray-200 px-2 py-1.5",children:[t.jsx("span",{className:"font-semibold text-sm text-gray-800",children:"Data Mapping"}),t.jsx("button",{type:"button",onClick:I,className:"p-1 text-gray-600 hover:bg-gray-300 rounded",title:"Hide panel",children:"››"})]}),t.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto",children:[R&&t.jsxs("div",{className:"flex border-b border-gray-300 bg-gray-200/80",children:[t.jsx("button",{type:"button",onClick:()=>oe("screen"),className:`flex-1 py-1.5 text-xs font-medium ${ae==="screen"?"bg-gray-100 text-gray-900":"text-gray-600"}`,title:"Screen data mapping",children:"Screen"}),t.jsx("button",{type:"button",onClick:()=>oe("sheet"),className:`flex-1 py-1.5 text-xs font-medium ${ae==="sheet"?"bg-gray-100 text-gray-900":"text-gray-600"}`,title:"Bottom sheet data mapping",children:"Sheet"})]}),t.jsxs("div",{className:"border-b border-gray-300",children:[t.jsxs("button",{type:"button",onClick:()=>X(b=>!b),className:"w-full px-2 py-1.5 flex items-center justify-between text-left text-xs font-medium text-gray-700 bg-gray-200 hover:bg-gray-300",children:[t.jsx("span",{className:"uppercase tracking-wide",children:"Data model"}),t.jsx("span",{className:"text-gray-400",children:L?"▼ Hide":"▶ Show"})]}),L&&t.jsxs("div",{className:"p-2 space-y-2",children:[t.jsx("p",{className:"text-xs text-gray-500 mb-2",children:f?"Bind to controls inside this sheet. Drag to a control in the sheet.":"Drag to a control on canvas to bind it. Release to add to data model."}),t.jsx("button",{type:"button",onMouseDown:b=>{b.button===0&&(b.preventDefault(),te({startX:b.clientX,startY:b.clientY,x:b.clientX,y:b.clientY}))},className:"w-full py-2 border-2 border-dashed border-slate-400 rounded text-sm text-slate-700 bg-slate-50 hover:bg-slate-100 hover:border-slate-500 mb-1 select-none",children:"+ Add field — drag to canvas"}),t.jsx("button",{type:"button",onClick:()=>_([...Z,{id:Se(),name:`field_${Z.length+1}`,value:"",boundNodeId:null,boundProperty:null}]),className:"text-xs text-slate-500 hover:text-slate-700 underline mb-2",children:"+ Add empty field"}),Z.map(b=>t.jsxs("div",{className:"bg-white border border-gray-200 rounded p-2 text-sm",children:[t.jsxs("div",{className:"flex items-center justify-between gap-1 mb-1",children:[t.jsx("span",{className:"font-mono text-xs text-slate-600 truncate",title:b.name,children:b.name}),t.jsx("button",{type:"button",onClick:()=>we(b.id),className:"text-red-500 hover:bg-red-50 rounded px-1 text-xs",title:"Remove",children:"×"})]}),b.boundNodeId&&(()=>{const B=ze(e,b.boundNodeId),$=B?Ot(e,b.boundNodeId):[],ge=$.length>1?$.slice(1).join(" › "):B?He(B.type):"";return B?t.jsxs("div",{className:"text-xs text-gray-500 mb-1 cursor-default",title:"Hover a control below to highlight it on canvas",children:["→ ",He(B.type),".",b.boundProperty,ge?` · ${ge}`:""," (bound)"]}):null})(),b.boundProperty==="options"||b.boundProperty==="items"?t.jsx("textarea",{value:Array.isArray(b.value)?b.value.join(`
`):String(b.value||""),onChange:B=>{const $=B.target.value.split(`
`).map(ge=>ge.trim()).filter(Boolean);ee(b.id,$)},rows:2,className:"w-full p-1.5 border rounded text-xs font-mono"}):b.boundProperty==="isOn"?t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:b.value===!0,onChange:B=>ee(b.id,B.target.checked)}),t.jsx("span",{className:"text-xs",children:"On"})]}):t.jsx("input",{type:"text",value:typeof b.value=="number"?b.value:b.value??"",onChange:B=>{const $=B.target.value;ee(b.id,b.boundProperty==="value"||b.boundProperty==="progress"?parseFloat($,10)||0:$)},className:"w-full p-1.5 border rounded text-xs"})]},b.id))]})]}),t.jsxs("div",{className:"border-t border-gray-300",children:[t.jsxs("button",{type:"button",onClick:()=>xe(b=>!b),className:"w-full px-2 py-1.5 flex items-center justify-between text-left text-xs font-medium text-gray-700 bg-gray-200 hover:bg-gray-300",children:[t.jsx("span",{className:"uppercase tracking-wide",children:"API URL & config"}),t.jsx("span",{className:"text-gray-400",children:Y?"▼ Hide":"▶ Show"})]}),Y&&t.jsxs("div",{className:"px-2 pb-2 pt-1 space-y-2 bg-white border-t border-gray-200",children:[t.jsx("div",{className:"text-xs text-gray-500",children:f?"When sheet opens":"On screen load (frontend)"}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-500 mb-0.5",children:"API URL (optional)"}),t.jsx("input",{type:"text",value:le??"",onChange:b=>pe&&pe(b.target.value.trim()||null),placeholder:"https://api.example.com/data",className:"w-full p-1.5 border border-gray-300 rounded text-xs font-mono"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-500 mb-0.5",children:"Method (optional)"}),t.jsxs("select",{value:x??"",onChange:b=>k&&k(b.target.value||null),className:"w-full p-1.5 border border-gray-300 rounded text-xs",children:[t.jsx("option",{value:"",children:"—"}),t.jsx("option",{value:"GET",children:"GET"}),t.jsx("option",{value:"POST",children:"POST"}),t.jsx("option",{value:"PUT",children:"PUT"}),t.jsx("option",{value:"PATCH",children:"PATCH"}),t.jsx("option",{value:"DELETE",children:"DELETE"})]})]}),!f&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-500 mb-0.5",children:"Config method (required for load)"}),t.jsx("input",{type:"text",value:c??"",onChange:b=>o&&o(b.target.value.trim()||null),placeholder:"e.g. getScreenApiConfig",className:"w-full p-1.5 border border-gray-300 rounded text-xs font-mono"})]}),t.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:[t.jsx("strong",{children:"If URL is set:"})," method returns ",t.jsx("code",{className:"bg-gray-100 px-0.5",children:"headers"}),", ",t.jsx("code",{className:"bg-gray-100 px-0.5",children:"body"})," only; app fetches URL with them.",t.jsx("br",{}),t.jsx("strong",{children:"If URL is empty:"})," method returns ",t.jsx("code",{className:"bg-gray-100 px-0.5",children:"response"})," (the JSON); app applies it to the data model."]})]}),t.jsxs("div",{className:"border-t border-gray-200 pt-2 mt-2",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1.5",children:"Load more (pagination)"}),t.jsxs("div",{className:"mb-1.5",children:[t.jsx("label",{className:"block text-xs text-gray-500 mb-0.5",children:"Page param name"}),t.jsx("input",{type:"text",value:H??"",onChange:b=>U&&U(b.target.value.trim()||null),placeholder:"e.g. pageNumber, page",className:"w-full p-1.5 border border-gray-300 rounded text-xs font-mono"})]}),t.jsxs("label",{className:"flex items-center gap-2 mb-1.5",children:[t.jsx("input",{type:"checkbox",checked:ue===!0,onChange:b=>ce&&ce(b.target.checked)}),t.jsx("span",{className:"text-xs",children:"Send page param in query (else in body)"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-500 mb-0.5",children:"Has next page path (optional)"}),t.jsx("input",{type:"text",value:he??"",onChange:b=>q&&q(b.target.value.trim()||null),placeholder:"e.g. data.hasNextPage",className:"w-full p-1.5 border border-gray-300 rounded text-xs font-mono mb-1"}),me!=null&&typeof me=="object"&&t.jsxs("div",{className:"border border-gray-200 rounded bg-white",children:[t.jsx("div",{className:"px-1.5 py-0.5 text-xs font-medium text-gray-600 border-b border-gray-100",children:"Pick from mock — click a path"}),t.jsx("div",{className:"max-h-32 overflow-y-auto p-1",children:t.jsx(ja,{value:me,pathPrefix:"",expanded:fe,onToggle:b=>{de(B=>{const $=new Set(B);return $.has(b)?$.delete(b):$.add(b),$})},onSelectPath:b=>q&&q(b)})})]})]})]})]})]})]})]})]})}function va({path:e,value:a,onSelectPath:n,selectedPath:r}){const i=e.split(".").pop()??"",c=r===e,o=a!==null&&typeof a=="object"&&!Array.isArray(a),s=Array.isArray(a);if(o||s){const u=s?a.map((l,h)=>({k:String(h),v:l})):Object.entries(a).map(([l,h])=>({k:l,v:h})),m=e==="";return t.jsxs("div",{className:m?"":"pl-2 border-l border-gray-200 ml-1",children:[!m&&t.jsxs("button",{type:"button",onClick:()=>n(e),className:`text-left w-full py-0.5 px-1 rounded text-sm ${c?"bg-blue-100":"hover:bg-gray-100"}`,children:[t.jsx("span",{className:"text-amber-700 font-mono",children:i}),t.jsx("span",{className:"text-gray-400 ml-1",children:s?`[${a.length}]`:"{}"})]}),u.map(({k:l,v:h})=>{const N=e?`${e}.${l}`:l;return t.jsx(va,{path:N,value:h,onSelectPath:n,selectedPath:r},N)})]})}return t.jsxs("button",{type:"button",onClick:()=>n(e),className:`text-left w-full py-0.5 px-1 rounded text-sm flex items-baseline gap-1 ${c?"bg-blue-100":"hover:bg-gray-100"}`,children:[t.jsx("span",{className:"text-amber-700 font-mono shrink-0",children:i}),t.jsx("span",{className:"text-gray-600 truncate",children:typeof a=="string"?`"${a}"`:String(a)})]})}function Zn({initialJson:e,onSave:a,onClose:n}){const[r,i]=p.useState(()=>typeof e=="object"&&e!==null?JSON.stringify(e,null,2):`{
  
}`),[c,o]=p.useState(null),s=()=>{o(null);try{const u=JSON.parse(r);a(u),n()}catch(u){o(u.message||"Invalid JSON")}};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] flex flex-col",children:[t.jsx("div",{className:"p-3 border-b border-gray-200 font-semibold",children:"Edit Mock API JSON"}),t.jsx("textarea",{value:r,onChange:u=>i(u.target.value),className:"flex-1 min-h-[200px] p-3 font-mono text-sm border-0 resize-none focus:ring-0",spellCheck:!1,placeholder:'{ "user": { "name": "John" } }'}),c&&t.jsx("div",{className:"px-3 py-1 text-sm text-red-600 bg-red-50",children:c}),t.jsxs("div",{className:"p-3 border-t border-gray-200 flex justify-end gap-2",children:[t.jsx("button",{type:"button",onClick:n,className:"px-3 py-1.5 border rounded text-sm",children:"Cancel"}),t.jsx("button",{type:"button",onClick:s,className:"px-3 py-1.5 bg-slate-600 text-white rounded text-sm",children:"Save"})]})]})})}function Gn({tree:e,selectedId:a,dataModel:n,onDataModelChange:r,mockApiJson:i,onMockApiJsonChange:c,mockApiBindings:o,onMockApiBindingsChange:s,onUpdateNode:u,onUpdateNodes:m,collapsed:l,onToggleCollapsed:h}){const[N,v]=p.useState(!1),[P,M]=p.useState(null),[J,V]=p.useState(""),[D,I]=p.useState("screen"),y=ia(e,a),C=D==="sheet"&&y!=null,te=C?re(y).dataModel||[]:n||[],W=C?re(y).mockApiJson:i,L=C?re(y).mockApiBindings||[]:o||[],X=C?f=>u({id:y.id,sheetDataMapping:{...re(y),mockApiJson:f}}):c,Y=C?f=>{const F=re(y).mockApiBindings||[],_=typeof f=="function"?f(F):f;u({id:y.id,sheetDataMapping:{...re(y),mockApiBindings:_}})}:s,xe=C?f=>{const F=re(y).dataModel||[],_=typeof f=="function"?f(F):f;u({id:y.id,sheetDataMapping:{...re(y),dataModel:_}})}:r,fe=te,de=L,ae=()=>{if(!P||!J)return;const f=L;f.some(F=>F.apiPath===P&&F.dataModelId===J)||(Y([...f,{apiPath:P,dataModelId:J}]),M(null),V(""))},oe=(f,F)=>{Y(L.filter(_=>!(_.apiPath===f&&_.dataModelId===F)))},R=()=>{if(!(!W||typeof W!="object"))try{const f=[...te],F=[];let _=!1;if(de.forEach(({apiPath:le,dataModelId:pe})=>{const x=oa(W,le);if(x===void 0)return;const k=f.findIndex(U=>U.id===pe);if(k<0)return;f[k]={...f[k],value:x},_=!0;const H=f[k];if(H.boundNodeId&&H.boundProperty!=null){const U=H.boundProperty==="text"&&typeof x!="string"?String(x):x;F.push({id:H.boundNodeId,[H.boundProperty]:U})}}),!_)return;if(C&&y!=null&&typeof m=="function"){const le=re(y);F.unshift({id:y.id,sheetDataMapping:{...le,dataModel:f}}),m(F)}else F.forEach(le=>u?.(le)),xe(f)}catch(f){console.error("Apply mock data to canvas failed:",f)}};return l?t.jsx("div",{className:"w-10 shrink-0 h-full flex flex-col border-l border-gray-300 bg-gray-200",children:t.jsx("button",{type:"button",onClick:h,className:"flex-1 flex items-center justify-center text-gray-600 hover:bg-gray-300",title:"Open Mock response",children:"‹‹"})}):t.jsxs(t.Fragment,{children:[t.jsxs("aside",{className:"w-80 shrink-0 h-full flex flex-col border-l border-gray-300 bg-gray-100 overflow-hidden",children:[t.jsxs("div",{className:"shrink-0 flex items-center justify-between border-b border-gray-300 bg-gray-200 px-2 py-1.5",children:[t.jsx("span",{className:"font-semibold text-sm text-gray-800",children:"Mock response & outlet"}),t.jsx("button",{type:"button",onClick:h,className:"p-1 text-gray-600 hover:bg-gray-300 rounded",title:"Hide panel",children:"››"})]}),t.jsxs("div",{className:"flex-1 min-h-0 flex flex-col overflow-hidden",children:[y&&t.jsxs("div",{className:"flex border-b border-gray-300 bg-gray-200/80",children:[t.jsx("button",{type:"button",onClick:()=>I("screen"),className:`flex-1 py-1.5 text-xs font-medium ${D==="screen"?"bg-gray-100 text-gray-900":"text-gray-600"}`,title:"Screen mock",children:"Screen"}),t.jsx("button",{type:"button",onClick:()=>I("sheet"),className:`flex-1 py-1.5 text-xs font-medium ${D==="sheet"?"bg-gray-100 text-gray-900":"text-gray-600"}`,title:"Sheet mock",children:"Sheet"})]}),t.jsxs("div",{className:"shrink-0 px-2 py-1.5 bg-gray-200 font-medium text-xs text-gray-700 uppercase tracking-wide flex items-center justify-between",children:[t.jsx("span",{children:C?"Sheet mock JSON":"Mock API JSON"}),t.jsx("button",{type:"button",onClick:()=>v(!0),className:"px-2 py-0.5 bg-white border border-gray-300 rounded text-xs hover:bg-gray-50",children:"Edit JSON"})]}),t.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto p-2 flex flex-col gap-2",children:[W!=null&&typeof W=="object"&&Object.keys(W).length>0?t.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto border border-gray-200 rounded bg-white p-1",children:t.jsx(va,{path:"",value:W,onSelectPath:M,selectedPath:P})}):t.jsx("p",{className:"text-xs text-gray-500",children:'No mock data. Click "Edit JSON" to paste JSON.'}),t.jsxs("div",{className:"shrink-0 space-y-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-700",children:"Connect (IBOutlet-style)"}),t.jsx("p",{className:"text-xs text-gray-500",children:"Select a path above, then pick a data model field and Connect."}),t.jsxs("div",{className:"flex gap-1 flex-wrap items-center",children:[t.jsxs("select",{value:J,onChange:f=>V(f.target.value),className:"p-1.5 border rounded text-xs max-w-[140px]",children:[t.jsx("option",{value:"",children:"Select field"}),fe.map(f=>t.jsx("option",{value:f.id,children:f.name},f.id))]}),t.jsx("button",{type:"button",onClick:ae,disabled:!P||!J,className:"px-2 py-1 bg-slate-600 text-white rounded text-xs disabled:opacity-50 disabled:cursor-not-allowed",children:"Connect"})]}),P&&t.jsxs("div",{className:"text-xs text-gray-500",children:["Path: ",t.jsx("code",{className:"bg-gray-100 px-1",children:P})]}),de.length>0&&t.jsx("ul",{className:"text-xs space-y-0.5 mt-1",children:de.map(f=>t.jsxs("li",{className:"flex items-center justify-between gap-1 bg-white border rounded px-2 py-1",children:[t.jsxs("span",{children:[t.jsx("code",{className:"text-amber-700",children:f.apiPath})," → ",(()=>{const F=fe.find(_=>_.id===f.dataModelId);return F&&F.name!=null?F.name:f.dataModelId})()]}),t.jsx("button",{type:"button",onClick:()=>oe(f.apiPath,f.dataModelId),className:"text-red-500 hover:bg-red-50 rounded",children:"×"})]},`${f.apiPath}-${f.dataModelId}`))}),t.jsx("button",{type:"button",onClick:R,disabled:de.length===0,className:"w-full mt-1 px-2 py-1.5 bg-emerald-600 text-white rounded text-xs disabled:opacity-50 disabled:cursor-not-allowed",children:"Apply mock data to canvas"})]})]})]})]}),N&&t.jsx(Zn,{initialJson:W,onSave:X,onClose:()=>v(!1)})]})}const Sa={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1},Lt="https://api.figma.com/v1";function ea(e){if(!e||typeof e!="string")return null;const n=e.trim().match(/figma\.com\/(?:file|design|proto)\/([a-zA-Z0-9]+)/);return n?n[1]:null}function Yn(e){if(!e||typeof e!="string")return null;const a=new URL(e.trim(),"https://figma.com"),n=a.searchParams.get("node-id")||a.searchParams.get("node_id");return n?n.replace(/^node-/,"").trim():null}async function Kn(e,a,n){const r=a||typeof import.meta<"u"&&Sa&&void 0;if(!r)throw new Error("Figma access token required. Set VITE_FIGMA_ACCESS_TOKEN in .env or pass token.");const i=n?encodeURIComponent(wa(n)):null,c=i?`${Lt}/files/${e}?ids=${i}`:`${Lt}/files/${e}`,o=await fetch(c,{method:"GET",headers:{"X-Figma-Token":r}});if(!o.ok){const s=await o.text();throw new Error(`Figma API error ${o.status}: ${s||o.statusText}`)}return o.json()}async function ta(e,a,n,r={}){const i=n||typeof import.meta<"u"&&Sa&&void 0;if(!i)throw new Error("Figma access token required.");const c=Array.isArray(a)?a:[a],o=r.format||"png",s=r.scale||2,u=new URLSearchParams({ids:c.join(","),format:o,scale:String(s)}),m=await fetch(`${Lt}/images/${e}?${u}`,{method:"GET",headers:{"X-Figma-Token":i}});if(!m.ok){const h=await m.text();throw new Error(`Figma Images API error ${m.status}: ${h||m.statusText}`)}return{images:(await m.json()).images||{}}}function wa(e){return String(e).replace(/%2D/gi,"-").trim().replace(/-/g,":")}function Qn(e,a){const n=e&&e.document;if(!n||!n.children||n.children.length===0)return null;if(a){const c=wa(a),o=ka(n,c);if(o)return{node:o,nodeId:o.id}}const r=n.children[0];if(!r.children||r.children.length===0)return null;const i=r.children[0];return{node:i,nodeId:i.id}}function ka(e,a){if(!e)return null;if(String(e.id)===String(a))return e;const n=e.children;if(!n)return null;for(const r of n){const i=ka(r,a);if(i)return i}return null}function ye(e,a){return e??a}function Xn(e={}){return{...{width:null,height:null,x:0,y:0,paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0,marginTop:0,marginBottom:0,marginLeft:0,marginRight:0,backgroundColor:null,textColor:"#000000",fontSize:16,fontWeight:"normal",fontFamily:"system-ui",cornerRadius:0,opacity:1,layoutMode:"autoLayout",autoResize:!1},...e}}function Pa(e){if(!e||e.type!=="SOLID"||!e.color)return null;const{r:a,g:n,b:r,a:i=1}=e.color,c=Math.round(ye(a,0)*255),o=Math.round(ye(n,0)*255),s=Math.round(ye(r,0)*255),u=[c,o,s].map(l=>l.toString(16).padStart(2,"0")).join("");if(i>=1)return`#${u}`;const m=Math.round(ye(i,1)*255).toString(16).padStart(2,"0");return`#${u}${m}`}function qn(e){const a=e.fills;if(!Array.isArray(a)||a.length===0)return null;const n=a.find(r=>r.visible!==!1&&r.type==="SOLID");return n?Pa(n):null}function At(e,a){const n=e.absoluteBoundingBox||e.absoluteRenderBounds;if(!n||n.width==null||n.height==null)return null;const r=a||{x:0,y:0};return{x:ye(n.x,0)-r.x,y:ye(n.y,0)-r.y,width:n.width,height:n.height}}function el(e){const a=e.layoutMode;return e.primaryAxisAlignItems,a==="VERTICAL"?"VStack":a==="HORIZONTAL"?"HStack":"View"}function _t(e,a,n={}){if(!e||!e.id)return null;const r=At(e,a),i=e.id.replace(/[^a-zA-Z0-9-]/g,"_").slice(0,36)||Se(),c=Xn(r?{x:r.x,y:r.y,width:r.width,height:r.height,layoutMode:"autoLayout",backgroundColor:qn(e),cornerRadius:ye(e.cornerRadius,0),opacity:e.opacity!=null?e.opacity:1}:{});switch(e.type){case"TEXT":{const o=ye(e.characters,""),s=e.style||{},u=ye(s.fontSize,16),m=ye(s.fontFamily,"system-ui"),l=s.fontWeight===700?"bold":s.fontWeight===600?"600":"normal",h=e.fills&&Array.isArray(e.fills)&&e.fills[0]?Pa(e.fills[0]):"#000000";return{type:"Text",id:i,style:{...c,fontSize:u,fontFamily:m,fontWeight:l,textColor:h||c.textColor},text:o,alignment:"start",localizationEnabled:!1,localizationKey:"",localizationDefaultValue:"",accessibilityEnabled:!1,accessibilityIdentifier:"",accessibilityLabel:"",tag:0,isUserInteractionEnabled:!0,isHidden:!1,automationIdentifier:"",actionId:"",actionEvent:"",actionBoundNodeId:"",actionBoundProperty:"",actionBoundDataModelId:"",gestures:[],displayFormat:null}}case"RECTANGLE":case"ELLIPSE":{const o=n[e.id];return o?{type:"Image",id:i,style:c,src:o,alt:e.name||"Image",contentMode:"contain",localizationEnabled:!1,localizationKey:"",localizationDefaultValue:"",accessibilityEnabled:!1,accessibilityIdentifier:"",accessibilityLabel:"",tag:0,isUserInteractionEnabled:!0,isHidden:!1,automationIdentifier:"",actionId:"",actionEvent:"",actionBoundNodeId:"",actionBoundProperty:"",actionBoundDataModelId:"",gestures:[],displayFormat:null}:lt("View",i,c,e,a,n)}case"FRAME":{const o=el(e);return lt(o,i,c,e,a,n)}case"GROUP":if(e.children&&e.children.length===1){const o=At(e,a)||{x:0,y:0},s=_t(e.children[0],o,n);return s&&s.style&&(s.style.x=ye(o.x,0)+ye(s.style.x,0),s.style.y=ye(o.y,0)+ye(s.style.y,0)),s}return lt("View",i,c,e,a,n);case"COMPONENT":case"INSTANCE":default:return lt("View",i,c,e,a,n)}}function lt(e,a,n,r,i,c){const o=(r.children||[]).map(u=>_t(u,At(r,i),c)).filter(Boolean),s={type:e,id:a,style:n,localizationEnabled:!1,localizationKey:"",localizationDefaultValue:"",accessibilityEnabled:!1,accessibilityIdentifier:"",accessibilityLabel:"",tag:0,isUserInteractionEnabled:!0,isHidden:!1,automationIdentifier:"",actionId:"",actionEvent:"",actionBoundNodeId:"",actionBoundProperty:"",actionBoundDataModelId:"",gestures:[],displayFormat:null};return e==="View"?(s.children=o,s.fitToScreen=!1):e==="VStack"||e==="HStack"?(s.children=o,s.spacing=ye(r.itemSpacing,12),s.alignment="center"):s.children=o,s}function tl(e,a={}){if(!e)return null;const n=_t(e,null,a);return n?(n.style&&(n.style.x=0,n.style.y=0),{schemaVersion:Rt,root:n,screenId:"",dataMapping:{dataModel:[],mockApiBindings:[]}}):null}const aa="ui-builder-figma-token";function Ca(e,a=[],n=0){return e&&(a.push({id:e.id,name:e.name||e.type||"?",type:e.type,bounds:e.absoluteBoundingBox||e.absoluteRenderBounds,depth:n}),(e.children||[]).forEach(r=>Ca(r,a,n+1))),a}function Ia(e,a=[]){return!e||!e.id||(a.push(e.id),(e.children||[]).forEach(n=>Ia(n,a))),a}function al({onImport:e,onClose:a}){const[n,r]=p.useState(""),[i,c]=p.useState(()=>localStorage.getItem(aa)||""),[o,s]=p.useState(!1),[u,m]=p.useState(null),[l,h]=p.useState(null),[N,v]=p.useState(null),[P,M]=p.useState(null),J=p.useCallback(async()=>{m(null),h(null),v(null),M(null);const y=ea(n);if(!y){m("Invalid Figma URL. Use figma.com/file/... or figma.com/design/...");return}const C=i.trim();if(!C){m("Figma access token required. Get one from Figma → Settings → Personal access tokens.");return}s(!0);try{const te=Yn(n),W=await Kn(y,C,te),L=Qn(W,te);if(!L){m("No frame found in file."),s(!1);return}h({fileResponse:W,rootNode:L.node,rootNodeId:L.nodeId});const{images:X}=await ta(y,[L.nodeId],C,{scale:2}),Y=X[L.nodeId];v(Y||null)}catch(te){m(te.message||String(te))}finally{s(!1)}},[n,i]),V=p.useCallback(async()=>{if(!(!l||!l.rootNode||!n.trim()||!i.trim())){m(null),s(!0);try{const y=ea(n),C=Ia(l.rootNode),te=i.trim();let W={};if(y&&C.length>0)try{for(let Y=0;Y<C.length;Y+=50){const xe=C.slice(Y,Y+50),{images:fe}=await ta(y,xe,te,{scale:2,format:"png"});W={...W,...fe}}}catch(X){console.warn("Figma image export (optional):",X.message)}const L=tl(l.rootNode,W);M(L)}catch(y){m(y.message||String(y))}finally{s(!1)}}},[l,n,i]),D=p.useCallback(()=>{if(!(!P||!e))try{const y=da(P),C=P.dataMapping&&typeof P.dataMapping=="object"?P.dataMapping:null;e(y,C),a&&a()}catch(y){m(y.message||String(y))}},[P,e,a]),I=l&&l.rootNode?Ca(l.rootNode):[];return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col",children:[t.jsxs("div",{className:"shrink-0 flex items-center justify-between border-b border-gray-200 px-4 py-3",children:[t.jsx("h2",{className:"font-semibold text-lg",children:"Import from Figma"}),t.jsx("button",{type:"button",onClick:a,className:"p-1.5 text-gray-500 hover:bg-gray-100 rounded","aria-label":"Close",children:"×"})]}),t.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto p-4 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Figma file URL"}),t.jsx("input",{type:"url",value:n,onChange:y=>r(y.target.value),placeholder:"https://figma.com/file/...",className:"w-full p-2 border border-gray-300 rounded text-sm"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Figma access token"}),t.jsx("input",{type:"password",value:i,onChange:y=>{c(y.target.value);try{localStorage.setItem(aa,y.target.value)}catch{}},placeholder:"Paste token from Figma → Settings → Personal access tokens",className:"w-full p-2 border border-gray-300 rounded text-sm"})]}),u&&t.jsx("div",{className:"p-2 rounded bg-red-50 text-red-700 text-sm",children:u}),t.jsx("button",{type:"button",onClick:J,disabled:o,className:"w-full py-2 px-3 bg-slate-600 text-white text-sm font-medium rounded shadow hover:bg-slate-500 disabled:opacity-50",children:o?"Loading…":"Load Figma file"}),l&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Preview"}),N?t.jsx("img",{src:N,alt:"Figma preview",className:"max-w-full max-h-48 object-contain border border-gray-200 rounded"}):t.jsx("p",{className:"text-sm text-gray-500",children:"No preview image (optional)"})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Properties (nodes)"}),t.jsxs("ul",{className:"border border-gray-200 rounded overflow-hidden max-h-32 overflow-y-auto text-xs",children:[I.slice(0,50).map(y=>t.jsxs("li",{className:"px-2 py-1 border-b border-gray-100 last:border-0 flex gap-2",style:{paddingLeft:8+y.depth*12},children:[t.jsx("span",{className:"font-mono text-amber-700",children:y.type}),t.jsx("span",{className:"truncate",children:y.name}),y.bounds&&t.jsxs("span",{className:"text-gray-400 shrink-0",children:[Math.round(y.bounds.width),"×",Math.round(y.bounds.height)]})]},y.id)),I.length>50&&t.jsxs("li",{className:"px-2 py-1 text-gray-400",children:["… and ",I.length-50," more"]})]})]}),t.jsx("button",{type:"button",onClick:V,className:"w-full py-2 px-3 bg-blue-600 text-white text-sm font-medium rounded shadow hover:bg-blue-500",children:"Figma to Canvas JSON"})]}),P&&t.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[t.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"JSON created. Import to replace current canvas."}),t.jsx("button",{type:"button",onClick:D,className:"w-full py-2 px-3 bg-green-600 text-white text-sm font-medium rounded shadow hover:bg-green-500",children:"Import to Canvas"})]})]})]})})}function nl(e){return{tree:e.tree,dataModel:e.dataModel,mockApiJson:e.mockApiJson,mockApiBindings:e.mockApiBindings,apiConfigMethod:e.apiConfigMethod,apiUrl:e.apiUrl,apiMethod:e.apiMethod,loadMorePageParamName:e.loadMorePageParamName,loadMorePageParamInQuery:e.loadMorePageParamInQuery,loadMoreHasNextPagePath:e.loadMoreHasNextPagePath}}function St(e){return{tree:JSON.parse(JSON.stringify(e.tree)),dataModel:e.dataModel?[...e.dataModel]:[],mockApiJson:e.mockApiJson!=null&&typeof e.mockApiJson=="object"?JSON.parse(JSON.stringify(e.mockApiJson)):null,mockApiBindings:e.mockApiBindings?[...e.mockApiBindings]:[],apiConfigMethod:e.apiConfigMethod,apiUrl:e.apiUrl,apiMethod:e.apiMethod,loadMorePageParamName:e.loadMorePageParamName,loadMorePageParamInQuery:e.loadMorePageParamInQuery,loadMoreHasNextPagePath:e.loadMoreHasNextPagePath}}function ll(e,a){const n=p.useRef([]),r=p.useRef([]),[i,c]=p.useState(!1),[o,s]=p.useState(!1),u=p.useCallback(()=>{c(n.current.length>0),s(r.current.length>0)},[]),m=p.useCallback(()=>{const N=e(),v=St(N);n.current=[...n.current.slice(-49),v],r.current=[],u()},[e,u]),l=p.useCallback(()=>{if(n.current.length===0)return;const N=n.current.pop();r.current=[...r.current,St(e())],a(N),u()},[e,a,u]),h=p.useCallback(()=>{if(r.current.length===0)return;const N=r.current.pop();n.current=[...n.current,St(e())],a(N),u()},[e,a,u]);return{pushSnapshot:m,undo:l,redo:h,canUndo:i,canRedo:o}}const rl=["View","VStack","HStack","ZStack","BottomSheet"];function Vt(e){if(!e||typeof e!="object")return null;const a={...e};return typeof a.id!="string"&&(a.id=a.id!=null?String(a.id):"root"),typeof a.type!="string"?null:(rl.includes(a.type)&&(a.children=Array.isArray(a.children)?a.children.map(Vt).filter(Boolean):[]),a)}function Qe(){return{id:"root",type:"View",children:[],screenId:"",presentationStyle:"push"}}function dt(e=Se(),a="Screen",n=null){return{id:e,name:a,tree:n?Vt(n):Qe(),presentationStyle:"push",order:0}}function Tt(e){const a=dt(Se(),"Screen 1");return{id:Se(),name:typeof e=="string"&&e.trim()?e.trim():"Untitled Project",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),screens:[a]}}function Ma(e){return!e||!Array.isArray(e.screens)?null:{id:e.id,name:e.name,createdAt:e.createdAt,updatedAt:e.updatedAt,screens:e.screens.map(a=>({id:a.id,name:a.name,presentationStyle:a.presentationStyle!=null?a.presentationStyle:"push",order:a.order!=null?a.order:0}))}}function La(e){if(!e||typeof e!="object"||!e.id)return null;const a=Array.isArray(e.screens)?e.screens:[],n={id:String(e.id),name:typeof e.name=="string"?e.name:"Untitled Project",createdAt:typeof e.createdAt=="string"?e.createdAt:new Date().toISOString(),updatedAt:typeof e.updatedAt=="string"?e.updatedAt:new Date().toISOString(),screens:a.map((r,i)=>{const c=r.tree&&typeof r.tree=="object"?Vt(r.tree):Qe();return c&&c.id!=="root"&&(c.id="root"),{id:r.id!=null?String(r.id):Se(),name:typeof r.name=="string"?r.name:`Screen ${i+1}`,tree:c||Qe(),presentationStyle:r.presentationStyle&&["push","present","modal"].includes(r.presentationStyle)?r.presentationStyle:"push",order:typeof r.order=="number"?r.order:i}})};return n.screens.length===0&&n.screens.push(dt(Se(),"Screen 1")),n}const Aa="project.json",sl="screens";function il(e,a=null){if(!e||!Array.isArray(e.screens))return null;const r={...Ma(e),screens:e.screens.map(i=>({id:i.id,name:i.name,presentationStyle:i.presentationStyle,order:i.order,tree:i.tree}))};return a!=null&&typeof a=="object"&&(r.dataMapping=a),r}function Ta(e){if(!e||typeof e!="object")return null;const a=Array.isArray(e.screens)?e.screens:[];return La({id:e.id,name:e.name,createdAt:e.createdAt,updatedAt:e.updatedAt,screens:a.map(r=>({id:r.id,name:r.name,tree:r.tree,presentationStyle:r.presentationStyle,order:r.order}))})}function Ea(e){if(!e||typeof e!="object"||!e.dataMapping)return null;const a=e.dataMapping;return{dataModel:Array.isArray(a.dataModel)?a.dataModel:[],mockApiJson:a.mockApiJson!=null&&typeof a.mockApiJson=="object"?a.mockApiJson:null,mockApiBindings:Array.isArray(a.mockApiBindings)?a.mockApiBindings:[],apiConfigMethod:a.apiConfigMethod,apiUrl:a.apiUrl,apiMethod:a.apiMethod,loadMorePageParamName:a.loadMorePageParamName,loadMorePageParamInQuery:a.loadMorePageParamInQuery===!0,loadMoreHasNextPagePath:a.loadMoreHasNextPagePath}}async function ol(e,a=null){const n=(await ot(()=>import("./jszip.min-BQw53GkO.js").then(o=>o.j),__vite__mapDeps([0,1,2]),import.meta.url)).default,r=new n;Ma(e);const i=il(e,a);r.file(Aa,JSON.stringify(i,null,2));const c=r.folder(sl);for(const o of e.screens)o.id&&o.tree&&c.file(`${o.id}.json`,JSON.stringify({id:o.id,name:o.name,presentationStyle:o.presentationStyle,order:o.order,tree:o.tree},null,2));return r.generateAsync({type:"blob"})}async function cl(e){const r=(await(await ot(()=>import("./jszip.min-BQw53GkO.js").then(u=>u.j),__vite__mapDeps([0,1,2]),import.meta.url)).default.loadAsync(e)).file(Aa);if(!r)return null;const i=await r.async("string");let c;try{c=JSON.parse(i)}catch{return null}const o=Ta(c);if(!o)return null;const s=Ea(c);return{project:o,dataMapping:s}}async function dl(e,a=null,n=null){const r=await ol(e,a),i=(n||(e.name||"project").replace(/[^\w\s-]/g,"").trim()||"project")+".uibuilder.zip",c=URL.createObjectURL(r),o=document.createElement("a");o.href=c,o.download=i,o.click(),URL.revokeObjectURL(c)}const ut="ui-builder-project",Et="ui-builder-data-mapping",ul=["View","VStack","HStack","ZStack",je];function mt(e){if(!e||typeof e!="object")return null;const a={...e};return typeof a.id!="string"&&(a.id=a.id!=null?String(a.id):"root"),typeof a.type!="string"?null:(ul.includes(a.type)&&(a.children=Array.isArray(a.children)?a.children.map(mt).filter(Boolean):[]),a)}function ml(){try{const e=localStorage.getItem("ui-builder-tree");if(!e)return null;const a=JSON.parse(e);if(!a||typeof a!="object"||a.type!=="View")return null;const n=mt(a);return n&&n.id==="root"?n:null}catch{return null}}function pl(){try{const e=localStorage.getItem(ut);if(e){const n=JSON.parse(e);return La(n)}const a=ml();if(a){const n=Tt();n.screens[0].tree=a;try{localStorage.removeItem("ui-builder-tree"),localStorage.setItem(ut,JSON.stringify(n))}catch{}return n}return null}catch{return null}}function De(){try{const e=localStorage.getItem(Et);if(!e)return null;const a=JSON.parse(e);return!a||typeof a!="object"?null:{dataModel:Array.isArray(a.dataModel)?a.dataModel:[],mockApiJson:a.mockApiJson!=null&&typeof a.mockApiJson=="object"?a.mockApiJson:null,mockApiBindings:Array.isArray(a.mockApiBindings)?a.mockApiBindings:[],apiConfigMethod:typeof a.apiConfigMethod=="string"&&a.apiConfigMethod.trim()?a.apiConfigMethod.trim():null,apiUrl:typeof a.apiUrl=="string"&&a.apiUrl.trim()||null,apiMethod:typeof a.apiMethod=="string"&&["GET","POST","PUT","PATCH","DELETE"].includes(a.apiMethod)?a.apiMethod:null,loadMorePageParamName:typeof a.loadMorePageParamName=="string"&&a.loadMorePageParamName.trim()||null,loadMorePageParamInQuery:a.loadMorePageParamInQuery===!0,loadMoreHasNextPagePath:typeof a.loadMoreHasNextPagePath=="string"&&a.loadMoreHasNextPagePath.trim()||null}}catch{return null}}function gl(){const[e,a]=p.useState(()=>pl()||Tt()),[n,r]=p.useState(null),[i,c]=p.useState(null),[o,s]=p.useState(!0),[u,m]=p.useState(!0),[l,h]=p.useState(!1),[N,v]=p.useState(!1),[P,M]=p.useState("mobile"),[J,V]=p.useState(!0),[D,I]=p.useState(!1),[y,C]=p.useState(!1),[te,W]=p.useState(!1),[L,X]=p.useState(!1),[Y,xe]=p.useState(!1),[fe,de]=p.useState(!1),[ae,oe]=p.useState(()=>{const d=De();return d&&d.dataModel!=null?d.dataModel:[]}),[R,f]=p.useState(()=>{const d=De();return d&&d.mockApiJson!=null?d.mockApiJson:null}),[F,_]=p.useState(()=>{const d=De();return d&&d.mockApiBindings!=null?d.mockApiBindings:[]}),[le,pe]=p.useState(()=>{const d=De();return d&&d.apiConfigMethod!=null?d.apiConfigMethod:null}),[x,k]=p.useState(()=>{const d=De();return d&&d.apiUrl!=null?d.apiUrl:null}),[H,U]=p.useState(()=>{const d=De();return d&&d.apiMethod!=null?d.apiMethod:null}),[ue,ce]=p.useState(()=>{const d=De();return d&&d.loadMorePageParamName!=null?d.loadMorePageParamName:null}),[he,q]=p.useState(()=>{const d=De();return d&&d.loadMorePageParamInQuery===!0}),[me,ee]=p.useState(()=>{const d=De();return d&&d.loadMoreHasNextPagePath!=null?d.loadMoreHasNextPagePath:null}),[we,Z]=p.useState(null),se=e?.screens?.find(d=>d.id===n),b=se?.tree??Qe(),B=p.useCallback(d=>{a(g=>{if(!g?.screens?.length)return g;const j=typeof d=="function"?d(se?.tree??Qe()):d;return{...g,updatedAt:new Date().toISOString(),screens:g.screens.map(A=>A.id===n?{...A,tree:j}:A)}})},[n,se?.tree]),$=p.useCallback(()=>nl({tree:b,dataModel:ae,mockApiJson:R,mockApiBindings:F,apiConfigMethod:le,apiUrl:x,apiMethod:H,loadMorePageParamName:ue,loadMorePageParamInQuery:he,loadMoreHasNextPagePath:me}),[b,ae,R,F,le,x,H,ue,he,me]),ge=p.useCallback(d=>{d.tree&&a(g=>{if(!g?.screens?.length)return g;const j=n||g.screens[0]?.id;return{...g,screens:g.screens.map(A=>A.id===j?{...A,tree:d.tree}:A)}}),oe(d.dataModel),f(d.mockApiJson),_(d.mockApiBindings),pe(d.apiConfigMethod),k(d.apiUrl),U(d.apiMethod),ce(d.loadMorePageParamName),q(d.loadMorePageParamInQuery),ee(d.loadMoreHasNextPagePath)},[n,oe,f,_,pe,k,U,ce,q,ee]),{pushSnapshot:E,undo:S,redo:ne,canUndo:K,canRedo:T}=ll($,ge),Q=p.useCallback(d=>{E(),B(d)},[E]),Ie=p.useCallback(d=>{E(),oe(d)},[E]),Ae=p.useCallback(d=>{E(),f(d)},[E]),w=p.useCallback(d=>{E(),_(d)},[E]),Te=p.useCallback(d=>{E(),pe(d)},[E]),ie=p.useCallback(d=>{E(),k(d)},[E]),Xe=p.useCallback(d=>{E(),U(d)},[E]),qe=p.useCallback(d=>{E(),ce(d)},[E]),Da=p.useCallback(d=>{E(),q(d)},[E]),Fa=p.useCallback(d=>{E(),ee(d)},[E]),Be=i!=null?ze(b,i):null;p.useEffect(()=>{if(!e?.screens?.length)return;n&&e.screens.some(g=>g.id===n)||r(e.screens[0].id)},[e,n]),p.useEffect(()=>{try{e?.id&&localStorage.setItem(ut,JSON.stringify(e))}catch{}},[e]);const Ba=function d(g){if(!g||!g.type)return"";let j=String(g.id??"");return j+=":"+(g.alignment??"")+":"+(g.spacing??""),j+=":"+(g.width??"")+":"+(g.height??"")+":"+(g.x??"")+":"+(g.y??""),j+=":"+(g.layoutMode??"")+":"+(g.autoResize??""),j+=":"+(g.marginTop??"")+":"+(g.marginBottom??"")+":"+(g.marginLeft??"")+":"+(g.marginRight??""),j+=":"+(g.insetFromParentTop??"")+":"+(g.insetFromParentLeft??"")+":"+(g.insetFromParentBottom??"")+":"+(g.insetFromParentRight??""),j+=":"+(g.paddingTop??"")+":"+(g.paddingBottom??"")+":"+(g.paddingHorizontal??"")+":"+(g.paddingVertical??""),(g.children||[]).forEach(A=>{j+="|"+d(A)}),j}(b);p.useEffect(()=>{try{localStorage.setItem(Et,JSON.stringify({dataModel:ae,mockApiJson:R,mockApiBindings:F,apiConfigMethod:le,apiUrl:x,apiMethod:H,loadMorePageParamName:ue,loadMorePageParamInQuery:he,loadMoreHasNextPagePath:me}))}catch{}},[ae,R,F,le,x,H,ue,he,me]),p.useEffect(()=>{i!=null&&Be==null&&c(null)},[i,Be]),p.useEffect(()=>{const d=()=>h(!0),g=()=>h(!1);return document.addEventListener("dragstart",d),document.addEventListener("dragend",g),()=>{document.removeEventListener("dragstart",d),document.removeEventListener("dragend",g)}},[]),p.useEffect(()=>{const d=g=>{const j=g.metaKey||g.ctrlKey;g.key==="z"&&j&&!g.shiftKey?(g.preventDefault(),K&&S()):(g.key==="z"&&j&&g.shiftKey||g.key==="y"&&j)&&(g.preventDefault(),T&&ne())};return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[K,T,S,ne]);const Jt=(d,g,j)=>{const{tree:A,node:G}=na(b,d);G&&G.id!==g&&(ra(G,g)||Q(la(A,g,G,j)))},Oa=d=>{Be&&ma(Be)?We({...Be,children:[...Be.children||[],d]}):Q(g=>({...g,children:[...g.children||[],d]}))},Ra=["backgroundColor","textColor","color","fontFamily","fontSize","fontWeight","cornerRadius","borderColor","opacity","blur","foregroundColor","width","height","x","y","paddingHorizontal","paddingVertical","paddingTop","paddingBottom","marginHorizontal","marginVertical","marginTop","marginBottom","marginLeft","marginRight","insetFromParentTop","insetFromParentLeft","insetFromParentBottom","insetFromParentRight","alignment","spacing","text","numberOfLines","title","src","alt","contentMode","useAsset","assetBundleName","assetImageName","showLoadingIndicator","items","loadMoreEnabled","loadMoreFooterLabel","loadMoreLoadingLabel","sectionGroupingEnabled","listRowSpacing","listSpacingAboveFirst","listSpacingBelowLast","placeholder","isOn","label","value","min","max","selection","options","progress","indeterminate","axis","url","fitToScreen","autoResize","layoutMode","localizationEnabled","localizationKey","localizationDefaultValue","accessibilityEnabled","accessibilityIdentifier","accessibilityLabel","tag","isUserInteractionEnabled","isHidden","automationIdentifier","actionId","actionEvent","actionBoundNodeId","actionBoundProperty","actionBoundDataModelId","gestures","displayFormat","screenId","presentationStyle","componentName","fillRemainingWidth",...qa()],Ut=(d,g)=>{const j=g.id!=null?String(g.id):null;if(j==null)return d;const A=ze(d,j);if(!A)return d;const G={...A,id:j};Array.isArray(g.children)?G.children=g.children:Array.isArray(A.children)&&(G.children=A.children);for(const ve of Ra)ve==="width"||ve==="height"?ve in g&&(G[ve]=g[ve]):g[ve]!==void 0&&(G[ve]=g[ve]);g.alignment!==void 0&&(G.alignment=g.alignment),g.spacing!==void 0&&(G.spacing=g.spacing);let Ne=!1;const be=ve=>{const Ga=ve.id!=null?String(ve.id):null;return!Ne&&Ga===j?(Ne=!0,{...G}):{...ve,children:(ve.children||[]).map(be)}};return be(d)},We=d=>{d?.id!=null&&Q(g=>Ut(g,d))},Ha=d=>{!Array.isArray(d)||d.length===0||Q(g=>d.reduce((j,A)=>Ut(j,A),g))},Oe=p.useCallback(()=>{oe([]),f(null),_([]),pe(null),k(null),U(null),ce(null),q(!1),ee(null)},[]);p.useCallback(()=>{E(),Oe()},[E,Oe]);const za=p.useCallback(d=>{try{localStorage.removeItem(ut),localStorage.removeItem(Et)}catch{}E();const g=Tt(d);a(g),r(g.screens[0]?.id??null),c(null),Z(null),Oe()},[E,Oe]),_a=p.useCallback(d=>{const g=typeof d=="string"&&d.trim()?d.trim():`Screen ${(e?.screens?.length||0)+1}`,j=dt(Se(),g);a(A=>A?.screens?{...A,updatedAt:new Date().toISOString(),screens:[...A.screens,{...j,order:A.screens.length}]}:A),r(j.id),c(null)},[e?.screens?.length]),Va=p.useCallback((d,g,j)=>{if(!g||typeof g!="object"||g.type!=="View")return;const A=mt(g);if(!A)return;A.id!=="root"&&(A.id="root");const G=typeof d=="string"&&d.trim()?d.trim():`Screen ${(e?.screens?.length||0)+1}`,Ne=dt(Se(),G,A);a(be=>be?.screens?{...be,updatedAt:new Date().toISOString(),screens:[...be.screens,{...Ne,order:be.screens.length}]}:be),r(Ne.id),c(null),Z(null),j!=null&&typeof j=="object"&&(oe(Array.isArray(j.dataModel)?j.dataModel:[]),f(j.mockApiJson!=null&&typeof j.mockApiJson=="object"?j.mockApiJson:null),_(Array.isArray(j.mockApiBindings)?j.mockApiBindings:[]),pe(typeof j.apiConfigMethod=="string"&&j.apiConfigMethod.trim()?j.apiConfigMethod.trim():null),k(typeof j.apiUrl=="string"&&j.apiUrl.trim()||null),U(typeof j.apiMethod=="string"&&["GET","POST","PUT","PATCH","DELETE"].includes(j.apiMethod)?j.apiMethod:null),ce(typeof j.loadMorePageParamName=="string"&&j.loadMorePageParamName.trim()||null),q(j.loadMorePageParamInQuery===!0),ee(typeof j.loadMoreHasNextPagePath=="string"&&j.loadMoreHasNextPagePath.trim()||null))},[e?.screens?.length]),Ja=p.useCallback(d=>{const g=d!=null?String(d):null;g&&(a(j=>{const A=j?.screens??[];if(A.length<=1)return j;const G=A.filter(Ne=>(Ne.id!=null?String(Ne.id):null)!==g);return G.length===A.length?j:{...j,updatedAt:new Date().toISOString(),screens:G.map((Ne,be)=>({...Ne,order:be}))}}),r(j=>j!=null&&String(j)===g?null:j),c(null))},[]),Ua=p.useCallback((d,g)=>{d&&a(j=>j?.screens?{...j,updatedAt:new Date().toISOString(),screens:j.screens.map(A=>A.id===d?{...A,name:g!=null?String(g).trim():A.name}:A)}:j)},[]),$a=p.useCallback(async d=>{if(!d)return;const g=d.name.toLowerCase().endsWith(".zip");try{const j=await d.arrayBuffer();let A=null,G=null;if(g){const Ne=new Blob([j],{type:"application/zip"}),be=await cl(Ne);if(!be)return;A=be.project,G=be.dataMapping}else{const Ne=new TextDecoder().decode(j),be=JSON.parse(Ne);A=Ta(be),G=Ea(be)}if(!A?.screens?.length)return;E(),a(A),r(A.screens[0].id),c(null),Z(null),G?(oe(G.dataModel??[]),f(G.mockApiJson??null),_(G.mockApiBindings??[]),pe(G.apiConfigMethod??null),k(G.apiUrl??null),U(G.apiMethod??null),ce(G.loadMorePageParamName??null),q(G.loadMorePageParamInQuery??!1),ee(G.loadMoreHasNextPagePath??null)):Oe()}catch(j){console.error("Open project failed",j)}},[E,Oe]),Wa=p.useCallback(async()=>{await dl(e,{dataModel:ae,mockApiJson:R,mockApiBindings:F,apiConfigMethod:le,apiUrl:x,apiMethod:H,loadMorePageParamName:ue,loadMorePageParamInQuery:he,loadMoreHasNextPagePath:me})},[e,ae,R,F,le,x,H,ue,he,me]),$t=p.useCallback((d,g)=>{if(!d||typeof d!="object"||d.type!=="View")return;const j=mt(d);j&&(j.id!=="root"&&(j.id="root"),E(),B(j),c(null),Z(null),g!=null&&typeof g=="object"?(oe(Array.isArray(g.dataModel)?g.dataModel:[]),f(g.mockApiJson!=null&&typeof g.mockApiJson=="object"?g.mockApiJson:null),_(Array.isArray(g.mockApiBindings)?g.mockApiBindings:[]),pe(typeof g.apiConfigMethod=="string"&&g.apiConfigMethod.trim()?g.apiConfigMethod.trim():null),k(typeof g.apiUrl=="string"&&g.apiUrl.trim()||null),U(typeof g.apiMethod=="string"&&["GET","POST","PUT","PATCH","DELETE"].includes(g.apiMethod)?g.apiMethod:null),ce(typeof g.loadMorePageParamName=="string"&&g.loadMorePageParamName.trim()||null),q(g.loadMorePageParamInQuery===!0),ee(typeof g.loadMoreHasNextPagePath=="string"&&g.loadMoreHasNextPagePath.trim()||null)):Oe())},[E,Oe]),Za=p.useCallback(d=>{const g=d!=null?String(d):null,j=A=>({...A,children:(A.children||[]).filter(G=>(G.id!=null?String(G.id):null)!==g).map(j)});Q(j(b)),c(null)},[b,Q]);return t.jsxs("div",{className:"flex h-screen overflow-hidden",children:[t.jsx(In,{currentProject:e,selectedScreenId:n,currentScreenName:se?.name,onNewProject:za,onOpenProject:$a,onSaveProject:Wa,onAddScreen:_a,onAddScreenFromJson:Va,onDeleteScreen:Ja,onSelectScreen:r,onOpenBoard:()=>xe(!0),onLoadFromJson:$t,onOpenFigma:()=>de(!0),tree:b,dataModel:ae,mockApiJson:R,mockApiBindings:F,apiConfigMethod:le,apiUrl:x,apiMethod:H,loadMorePageParamName:ue,loadMorePageParamInQuery:he,loadMoreHasNextPagePath:me,collapsed:te,onToggleCollapsed:()=>W(d=>!d)}),t.jsx(An,{tree:b,selected:Be,onAdd:Oa,collapsed:L,onToggleCollapsed:()=>X(d=>!d)}),Y?t.jsx(Rn,{project:e,selectedScreenId:n,onSelectScreen:r,onClose:()=>xe(!1),dataModel:ae}):t.jsxs(t.Fragment,{children:[t.jsx(Dn,{tree:b,dataModel:ae,selectedNodeId:i,onSelect:d=>c(d!=null&&d.id!=null?d.id:null),onUpdate:We,onMove:Jt,isDragging:l,onOpenPreview:()=>v(!0),deviceType:P,onDeviceTypeChange:M,highlightNodeId:we,onUndo:S,onRedo:ne,canUndo:K,canRedo:T},Ba),N&&t.jsx($n,{tree:b,dataModel:ae,onClose:()=>v(!1)}),D?t.jsx("div",{className:"w-10 shrink-0 h-full flex flex-col border-l border-gray-300 bg-gray-200",children:t.jsx("button",{type:"button",onClick:()=>I(!1),className:"flex-1 flex items-center justify-center text-gray-600 hover:bg-gray-300",title:"Open Inspector & Tree",children:"‹‹"})}):t.jsxs("aside",{className:"shrink-0 h-full flex flex-col w-72 bg-gray-100 border-l border-gray-300 overflow-hidden relative z-20",children:[t.jsxs("div",{className:"shrink-0 flex border-b border-gray-300 bg-gray-200",children:[t.jsxs("button",{type:"button",onClick:()=>s(d=>!d),className:`flex-1 py-2 px-3 text-sm font-medium ${o?"bg-gray-100 text-gray-900":"text-gray-600 hover:bg-gray-50"}`,title:o?"Hide Inspector":"Show Inspector",children:["Inspector ",o?"▾":"▸"]}),t.jsxs("button",{type:"button",onClick:()=>m(d=>!d),className:`flex-1 py-2 px-3 text-sm font-medium ${u?"bg-gray-100 text-gray-900":"text-gray-600 hover:bg-gray-50"}`,title:u?"Hide Tree":"Show Tree",children:["Tree ",u?"▾":"▸"]}),t.jsx("button",{type:"button",onClick:()=>I(!0),className:"p-2 text-gray-600 hover:bg-gray-300",title:"Hide panel",children:"››"})]}),t.jsxs("div",{className:"flex-1 min-h-0 flex flex-col overflow-hidden",children:[o&&t.jsx("div",{className:`overflow-y-auto border-b border-gray-300 bg-gray-100 ${u?"max-h-[50%] min-h-0 shrink-0":"flex-1 min-h-0"}`,children:t.jsx(_n,{tree:b,selected:Be,dataModel:ae,onUpdate:We,onDelete:Za,screenName:se?.name,onScreenNameChange:n?d=>Ua(n,d):void 0},i??"none")}),u&&t.jsxs("div",{className:`flex-1 min-h-0 overflow-y-auto bg-white flex flex-col ${o?"":"min-h-0"}`,children:[t.jsx("div",{className:"py-2 border-b border-gray-200 px-2 font-semibold text-sm text-gray-700 shrink-0",children:"Canvas tree"}),t.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto",children:t.jsx(Jn,{tree:b,selectedId:i,onSelect:d=>c(d!=null&&d.id!=null?d.id:null),onMove:Jt})})]}),!o&&!u&&t.jsx("div",{className:"flex-1 flex items-center justify-center text-sm text-gray-500 p-4",children:"Toggle Inspector or Tree to view"})]})]}),t.jsx(Wn,{tree:b,selectedId:i,dataModel:ae,onDataModelChange:Ie,mockApiJson:R,apiConfigMethod:le,onApiConfigMethodChange:Te,apiUrl:x,onApiUrlChange:ie,apiMethod:H,onApiMethodChange:Xe,loadMorePageParamName:ue,onLoadMorePageParamNameChange:qe,loadMorePageParamInQuery:he,onLoadMorePageParamInQueryChange:Da,loadMoreHasNextPagePath:me,onLoadMoreHasNextPagePathChange:Fa,onUpdateNode:We,collapsed:J,onToggleCollapsed:()=>V(d=>!d),onHighlightNode:Z}),t.jsx(Gn,{tree:b,selectedId:i,dataModel:ae,onDataModelChange:Ie,mockApiJson:R,onMockApiJsonChange:Ae,mockApiBindings:F,onMockApiBindingsChange:w,onUpdateNode:We,onUpdateNodes:Ha,collapsed:y,onToggleCollapsed:()=>C(d=>!d)}),fe&&t.jsx(al,{onImport:$t,onClose:()=>de(!1)})]})]})}export{gl as default};
